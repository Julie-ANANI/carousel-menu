<ng-container *ngIf="modalAnswer">
  <section id="user-answer-component">

    <!-- section class mail REJECTED_GMAIL -->
    <ng-container *ngIf="mailType">
      <span class="label is-draft">{{mailType}}</span>
    </ng-container>

    <div class="column col-xs-12 col-11 col-mx-auto">
      <!-- section save -->
      <ng-container *ngIf="modeAdmin">
        <div class="section-light-pad rm-pad-top text-right" [ngSwitch]="modalAnswer?.localStatus">

          <button class="btn btn-primary" (click)="importAnswer($event)" *ngSwitchCase="'draft'">
            {{ 'COMMON.BUTTON.IMPORT' | translate }}
          </button>

          <!-- cancel reassign button -->
          <button class="btn ghost-primary m-20" *ngIf="modeAdmin && modalAnswer.localStatus !== 'draft' && assignNewPro" (click)="assignNewPro = false">
            {{ 'COMMON.BUTTON.CANCEL' | translate}}
          </button>

          <!-- confirm reassign button -->
          <button
            class="btn btn-primary m-20"
            *ngIf="modeAdmin && modalAnswer.localStatus !== 'draft' && assignNewPro"
            (click)="reassignAnswer($event)"
            [disabled]="!newPro.firstName || !newPro.lastName || !newPro.email">
            {{ 'COMMON.BUTTON.CONFIRM' | translate}}
          </button>

          <button class="btn btn-primary m-20" [disabled]="!editMode" (click)="save($event)" *ngSwitchDefault>
            {{ 'COMMON.BUTTON.SAVE' | translate }}
          </button>

        </div>
      </ng-container>

      <!-- section user details -->
      <div class="section-details">

        <!-- name, flag and rating -->
        <div class="header-wrapper flex-between">

          <div class="title-wrapper d-flex">

            <!-- name -->
            <h4 *ngIf="!assignNewPro">

              <ng-container *ngIf="modalAnswer.professional?.firstName || modalAnswer.professional?.lastName">
                {{ modalAnswer.professional?.firstName | FormatText:true }} {{ modalAnswer.professional?.lastName | FormatText:true }}
              </ng-container>

              <ng-container *ngIf="!modalAnswer.professional?.firstName && !modalAnswer.professional?.lastName">
                {{ 'MARKET_REPORT.ANONYMOUS' | translate }}
              </ng-container>
            </h4>
            <!-- /name -->

            <!-- name edition (when reassigning answer) -->
            <ng-container *ngIf="assignNewPro">
              <div class="form-group">
                <label class="form-label" for="answer-firstName">{{ 'COMMON.LABEL.FIRSTNAME' | translate }}</label>
                <input
                  type="text"
                  [(ngModel)]="newPro.firstName"
                  id="answer-firstName"
                  alt="First name"
                  class="form-input"
                  [attr.placeholder]="'COMMON.LABEL.FIRSTNAME' | translate">
              </div>
            </ng-container>

            <ng-container *ngIf="assignNewPro">
              <div class="form-group">
                <label class="form-label" for="answer-lastName">{{ 'COMMON.LABEL.NAME' | translate }}</label>
                <input
                  type="text"
                  [(ngModel)]="newPro.lastName"
                  id="answer-lastName"
                  alt="Last name"
                  class="form-input"
                  [attr.placeholder]="'COMMON.LABEL.LASTNAME' | translate">
              </div>
            </ng-container>
            <!-- /name edition (when reassigning answer) -->

            <!-- rating -->
            <ng-container *ngIf="editMode">
              <div class="rating-wrapper">
                <app-rating-item
                  [editMode]="modeAdmin"
                  [prop]="'profile'"
                  [rating]="modalAnswer.profileQuality"
                  (ratingChange)="updateProfileQuality($event)">
                </app-rating-item>
              </div>
            </ng-container>

            <!-- country -->
            <ng-container *ngIf="!editCountry && !assignNewPro">
              <div class="country-wrapper flex-between">

                <app-utility-country-flag [country]="modalAnswer.country" [width]="50" [height]="35"></app-utility-country-flag>
                <div
                  (click)="onClickEdit('country')"
                  *ngIf="modeAdmin && editMode"
                  class="icon-container is-sm tooltip"
                  data-tooltip="Modify Country">
                  <i class="fas fa-pencil-alt"></i>
                </div>
              </div>
            </ng-container>

            <!-- language -->
            <ng-container *ngIf="!assignNewPro">
              <div class="language-active"  *ngIf="!modeAdmin || !editMode">
                {{ modalAnswer.professional?.language }}
              </div>
              <div *ngIf="modeAdmin && editMode">
                <div (click)="onClickLanguage('fr')" [class]='"language" + (modalAnswer.professional?.language === "fr" ? "-active": "")'>fr</div>
                <div (click)="onClickLanguage('en')" [class]='"language" + (modalAnswer.professional?.language === "en" ? "-active": "")'>en</div>
              </div>
            </ng-container>

          </div>

          <!-- edit button -->
          <ng-container *ngIf="modeAdmin && modalAnswer.localStatus !== 'draft' && !assignNewPro">
            <div class="button-wrapper">
              <label class="form-switch text-medium" for="answer-editMode">
                <input
                  type="checkbox"
                  name="answer-editMode"
                  id="answer-editMode"
                  (change)="changeMode($event)"
                  [checked]="editMode">
                <i class="form-icon"></i>{{ 'ANSWER.EDIT_ANSWER' | translate}}
              </label>
            </div>
          </ng-container>

          <!-- reassign button -->
          <div class="button-wrapper">
            <a
              class="text-medium"
              *ngIf="modeAdmin && modalAnswer.localStatus !== 'draft' && !assignNewPro"
              (click)="assignNewPro = true">
              {{ 'ANSWER.REASSIGN_ANSWER' | translate}}
            </a>
          </div>

        </div>

        <!-- edit country -->
        <ng-container *ngIf="editCountry || assignNewPro">
          <div class="form-group">
            <label class="form-label">{{ 'COMMON.LABEL.COUNTRY' | translate }}</label>
            <app-auto-complete-input
              (update)="updateCountry($event)"
              [onlyOne]="true"
              [config]="{ placeholder: 'COMMON.PLACEHOLDER.COUNTRY', type: 'countries' }">
            </app-auto-complete-input>
          </div>
        </ng-container>

        <!-- blacklist company -->
        <ng-container *ngIf="modeAdmin && modalAnswer.localStatus !== 'draft' && modalAnswer.blacklistedCompany && !assignNewPro">
          <div class="icon-container text-alert"><i class="fas fa-exclamation-triangle"></i></div>
          <span class="text text-alert text-medium">{{ 'ANSWER.BLACKLISTED_COMPANY' | translate }}</span>
        </ng-container>

        <!-- linkedin -->
        <ng-container *ngIf="modeAdmin && modalAnswer.professional?.profileUrl && !assignNewPro">
          <div class="linkedin-wrapper">
            <span class="icon-container text-secondary picto"><i class="fab fa-linkedin-in"></i></span>
            <a [href]="modalAnswer.professional.profileUrl" target="_blank">
              <span class="text-link">{{ modalAnswer.professional.profileUrl }}</span>
            </a>
          </div>
        </ng-container>

        <!-- job -->
        <ng-container *ngIf="modalAnswer.job || modalAnswer.professional?.jobTitle || editMode">
          <div class="job-wrapper">

            <span class="icon-container text-notify picto"><i class="fas fa-address-card" aria-hidden="true"></i></span>

            <ng-container *ngIf="!editJob && !assignNewPro">
              <span>{{ (modalAnswer.job || modalAnswer.professional?.jobTitle) | FormatText:true }}</span>
              <span
                *ngIf="modeAdmin && editMode"
                class="icon-container is-sm text-notify tooltip"
                data-tooltip="Modify Profession"
                (click)="onClickEdit('job')">
                <i class="fas fa-pencil-alt"></i>
              </span>
            </ng-container>

            <ng-container *ngIf="editJob || assignNewPro">
              <div class="form-group">
                <label class="form-label" for="answer-jobTitle">{{ 'COMMON.LABEL.JOBTITLE' | translate }}</label>
                <input
                  type="text"
                  [(ngModel)]="modalAnswer.job"
                  id="answer-jobTitle"
                  alt="Job title"
                  class="form-input"
                  [attr.placeholder]="'COMMON.PLACEHOLDER.JOBTITLE' | translate">
              </div>
            </ng-container>

          </div>
        </ng-container>

        <!-- company -->
        <ng-container *ngIf="modalAnswer.company.name || modalAnswer.professional?.company || editMode">
          <div class="company-wrapper">

            <span class="icon-container text-notify picto"><i class="fas fa-building" aria-hidden="true"></i></span>

            <ng-container *ngIf="!editCompany && !assignNewPro">

              <span [ngClass]="{'popover': excludedCompanies.length > 0,
              'is-right': excludedCompanies.length > 0 && companyLength <= 30}">
                {{ (modalAnswer.company.name || modalAnswer.professional?.company) | FormatText:true }}
                <div *ngIf="excludedCompanies.length > 0" class="popover-container is-sm">
                  <div
                    [ngStyle]="{ 'max-height': '300px', 'overflow-y': 'auto' }"
                    class="p-top-20 p-left-25 p-bottom-20 p-right-25">
                    <h3 class="text-center text-sm">Companies blacklisted by the client</h3>
                    <ul class="m-no">
                      <li *ngFor="let company of excludedCompanies" class="m-top-h text-xs">
                        {{ company.name }}
                      </li>
                    </ul>
                  </div>
                </div>
              </span>

              <span
                *ngIf="modeAdmin && editMode"
                class="icon-container is-sm text-notify tooltip"
                data-tooltip="Modify Company"
                (click)="onClickEdit('company')">
                <i class="fas fa-pencil-alt"></i>
              </span>

            </ng-container>

            <ng-container *ngIf="editCompany || assignNewPro">
              <div class="form-group">
                <label class="form-label" for="answer-company">{{ 'COMMON.LABEL.COMPANY' | translate }}</label>
                <input
                  type="text"
                  [(ngModel)]="modalAnswer.company.name"
                  id="answer-company"
                  alt="Company"
                  class="form-input"
                  [attr.placeholder]="'COMMON.PLACEHOLDER.COMPANY' | translate">
              </div>
            </ng-container>

          </div>
        </ng-container>

        <!-- email -->
        <ng-container *ngIf="modalAnswer.professional?.email && !assignNewPro">
          <div class="email-wrapper">
            <span class="icon-container text-notify picto"><i class="fas fa-envelope"></i></span>
            <a [href]="'mailto:'+modalAnswer.professional.email">
              <span class="text-link">{{ modalAnswer.professional.email }}</span>
            </a>
          </div>
        </ng-container>

        <!-- second email -->
        <ng-container *ngIf="modeAdmin && modalAnswer.professional?.secondEmail && !assignNewPro">
          <div class="email-wrapper">
            <span class="icon-container text-notify picto"><i class="fas fa-envelope"></i></span>
            <a [href]="'mailto:'+modalAnswer.professional.secondEmail">
              <span class="text-link">{{ modalAnswer.professional.secondEmail }}</span>
            </a>
          </div>
        </ng-container>

        <!-- assign second email -->
        <ng-container *ngIf="modeAdmin && !modalAnswer.professional?.secondEmail && !assignNewPro">
          <ng-container *ngIf="addNewEmail">
            <div class="email-wrapper">
              <span class="icon-container text-notify picto"><i class="fas fa-envelope"></i></span>
              <input type="email" [(ngModel)]="newEmail">
              <button class="btn ghost-primary" (click)="addContactEmail()">{{ 'COMMON.BUTTON.SAVE' | translate }}</button>
            </div>
          </ng-container>
          <ng-container *ngIf="!addNewEmail">
            <a class="text-xs" (click)="addNewEmail = true">{{ 'ANSWER.ADD_NEW_EMAIL' | translate }}</a>
          </ng-container>

        </ng-container>

        <!-- edit email -->
        <ng-container *ngIf="assignNewPro">
          <div class="form-group">
            <label class="form-label" for="answer-email">{{ 'COMMON.LABEL.EMAIL' | translate }}</label>
            <input
              type="text"
              [(ngModel)]="newPro.email"
              id="answer-email"
              alt="Email"
              class="form-input"
              [attr.placeholder]="'COMMON.LABEL.EMAIL' | translate">
          </div>
        </ng-container>

        <!-- section autoTags -->
        <ng-container *ngIf="autoTags?.length > 0">
          <div class="tags-wrapper">
            <div *ngFor="let tag of autoTags" class="label is-tag is-rounded">
              {{ tag }}
            </div>
          </div>
        </ng-container>

        <!-- received date and time, and time spent -->
        <ng-container *ngIf="modalAnswer.created || modalAnswer.time_elapsed">
          <div class="text text-notify text-bold receive-wrapper">
            <span *ngIf="modalAnswer.created">
              {{ 'ANSWER.RECEIVED.A' | translate }}
              {{ createdDate(modalAnswer.created) }}
              {{ 'ANSWER.RECEIVED.B' | translate }}
              {{ createdTime(modalAnswer.created)  }}
            </span>
            <span *ngIf="modeAdmin && modalAnswer.created && modalAnswer.time_elapsed">&nbsp; • &nbsp;</span>
            <span *ngIf="modeAdmin && modalAnswer.time_elapsed">
              {{ 'ANSWER.RECEIVED.C' | translate }} {{ floor(modalAnswer.time_elapsed/60) }} min. {{ floor(modalAnswer.time_elapsed%60) }} sec.
            </span>
          </div>
        </ng-container>

        <!-- ip -->
        <ng-container *ngIf="modalAnswer.ip && editMode">
          <div class="text text-notify text-bold i-wrapper">
            <span>{{ 'ANSWER.IP' | translate }} {{ modalAnswer.ip }}</span>
          </div>
        </ng-container>

      </div>
      <!-- /section user details -->

      <!-- section tags -->
      <ng-container *ngIf="modalAnswer?.tags?.length > 0 || editMode">
        <div class="section-tags">
          <label class="form-label">Tags</label>
          <app-shared-tags
            [tags]="modalAnswer.tags"
            [editMode]="editMode"
            [projectId]="innovationId"
            (addTag)="addTag($event)"
            (createTag)="createTag($event)"
            (removeTag)="removeTag($event)">
          </app-shared-tags>
        </div>
      </ng-container>
      <!-- /section tags -->

      <!-- section status -->
      <ng-container *ngIf="modeAdmin && modalAnswer.status !== 'REJECTED_GMAIL' && modalAnswer.localStatus !== 'draft'">
        <div class="section-status flex-between">

          <!-- to reject -->
          <div class="status-rejected">
            <div class="label is-danger"><span>{{ 'ANSWER.STATUS.REJECTED' | translate }}</span></div>
            <button class="btn btn-radio rejected" [ngClass]="{ 'active': modalAnswer.status === 'REJECTED' }" (click)="updateStatus($event, 'REJECTED')">
              <span>•</span>
            </button>
          </div>

          <!-- submitted -->
          <div class="status-submitted">
            <div class="label is-progress"><span>{{ 'ANSWER.STATUS.SUBMITTED' | translate }}</span></div>
            <button class="btn btn-radio submitted" [ngClass]="{ 'active': modalAnswer.status === 'SUBMITTED' }" (click)="updateStatus($event, 'SUBMITTED')">
              <span>•</span>
            </button>
          </div>

          <!-- validated -->
          <div class="status-validated">
            <div class="label is-success"><span>{{ 'ANSWER.STATUS.VALIDATED' | translate }}</span></div>
            <button
              class="btn btn-radio validated"
              [ngClass]="{ 'active': modalAnswer.status === 'VALIDATED' }"
              (click)="updateStatus($event, 'VALIDATED')">
              <span>•</span>
            </button>
          </div>

        </div>
      </ng-container>
      <!-- /section status -->

      <!-- rejected by gmail -->
      <ng-container *ngIf="modeAdmin && modalAnswer.status === 'REJECTED_GMAIL'">
        <div class="status-gmail">

          <div class="label is-danger">
            <span>{{ 'ANSWER.STATUS.REJECTED_GMAIL' | translate }}</span>
          </div>

          <!-- the original reply message sent to Karine -->
          <ng-container *ngIf="meta && !editMode">
            <p class="text">{{ meta }}</p>
          </ng-container>

        </div>
      </ng-container>
      <!-- /rejected by gmail -->

      <!-- section questions -->
      <ng-container *ngFor="let question of questions">
        <app-answer-question
          [editMode]="editMode"
          [adminMode]="modeAdmin"
          [question]="question"
          [fullAnswer]="modalAnswer"
          [innoid]="innovationId">
        </app-answer-question>
      </ng-container>
      <!-- /section questions -->

    </div>
  </section>
</ng-container>
