<div id="sidebar-filter-answers">

  <!-- selected contacts type === 'FOLLOW_UP' -->
  <div *ngIf="templateType === 'FOLLOW_UP'">

    <!-- contacts -->
    <div [ngClass]="{'text-center': filterNumber}">

      <!-- no contact selected -->
      <h6 *ngIf="!filterNumber" class="m-bottom-30 text-bold">
        Select contacts according to your criteria
      </h6>
      <!-- /no contact selected -->

      <!-- button selected contacts -->
      <button
        (click)="onSelectedContacts($event)"
        *ngIf="filterNumber"
        class="button is-primary"
        id="btn-selected-contacts"
        type="button">
        <i class="fas fa-share icon-left"></i> Selected {{ filterNumber }} contacts
      </button>
      <!-- button selected contacts -->

    </div>
    <!-- /contacts -->

    <div class="divider"></div>

  </div>
  <!-- /selected contacts type === 'FOLLOW_UP -->

  <!-- actions button for admin type === 'MARKET_REPORT' -->
  <div *ngIf="templateType === 'MARKET_REPORT' && isAdmin && isAdminSide">

    <!-- button -->
    <div class="dropdown m-right-auto">

      <a class="button dropdown-toggle is-outlined is-sm is-secondary" tabindex="0">
        Actions <i class="fas fa-caret-down"></i>
      </a>

      <div class="menu">
        <div
          (click)="openModalPreview($event)"
          *ngIf="!innovation.previewMode && innovation.status !== 'DONE'"
          class="menu-item">
          Make project visible to client
        </div>
        <div
          (click)="openModalPreview($event)"
          *ngIf="innovation.previewMode && innovation.status !== 'DONE'"
          class="menu-item">
          Make project invisible to client
        </div>
        <div (click)="openModalEnd($event)" class="menu-item">
          End project
        </div>
      </div>

    </div>
    <!-- button -->

    <div class="divider"></div>

  </div>
  <!-- /actions button for admin type === 'MARKET_REPORT' -->

  <!-- views type === 'MARKET_REPORT' || 'FOLLOW_UP' -->
  <div>

    <h6>{{ 'SIDEBAR_MARKET_REPORT.MY_VIEWS' | translate }}</h6>

    <!-- show views -->
    <div *ngFor="let filter of sharedFiltersList" class="d-flex align-center m-top-1 m-bottom-1">

      <div
        (click)="deleteCustomFilter($event, filter.name)"
        *ngIf="isViewsEditable"
        [attr.data-tooltip]="'COMMON.TOOLTIP.DELETE' | translate"
        class="c-hand m-right-1 tooltip is-right">
        <img
          [ngStyle]="{ 'height': '13px', 'width': '12px'}"
          alt=" "
          src="https://res.cloudinary.com/umi/image/upload/pictos/delete/picto-delete-danger.svg">
      </div>

      <a
        (click)="loadFilter(filter.name)"
        [attr.data-tooltip]="'SIDEBAR_MARKET_REPORT.TOOLTIP_LOAD_VIEW' | translate"
        [ngStyle]="{ 'margin-top': '1px' }"
        class="c-hand tooltip text-medium text-xs text-background">
        {{ filter.name }}
      </a>

    </div>
    <!-- /show views -->

    <!-- form to register view -->
    <form *ngIf="isViewsEditable" (ngSubmit)="registerNewFilter()">

      <div class="form-group p-top-1">
        <label>
          <input
            [(ngModel)]="filterName"
            [ngModelOptions]="{ standalone: true }"
            [placeholder]="'SIDEBAR_MARKET_REPORT.FORM_VIEW_PLACEHOLDER' | translate"
            class="form-input is-sm"
            type="text">
        </label>
      </div>

      <div class="text-center p-top-10">
        <button
          [disabled]="!filterName"
          class="button is-draft is-outlined is-sm"
          id="btn-create-view"
          type="submit">
          {{ 'COMMON.BUTTON.SAVE' | translate }}
        </button>
      </div>

    </form>
    <!-- /form to register view -->

  </div>
  <!-- /views type === 'MARKET_REPORT' || 'FOLLOW_UP' -->

  <div class="divider"></div>

  <!-- view activated type === 'MARKET_REPORT' || 'FOLLOW_UP' -->
  <div *ngIf="activatedCustomFilters.length > 0">

    <h6 class="m-bottom-2">{{ 'SIDEBAR_MARKET_REPORT.ACTIVATED_VIEW' | translate }}</h6>

    <div *ngFor="let filter of activatedCustomFilters" class="m-top-1">
      <div
        (click)="unloadFilter($event, filter)"
        class="d-flex align-center text-background text-medium m-bottom-1 text-xs c-hand">
        <i class="icon text-primary m-right-2 icon-cross"></i>
        {{ filter }}
      </div>
    </div>

    <div class="divider"></div>

  </div>
  <!-- /view activated type === 'MARKET_REPORT' || 'FOLLOW_UP' -->

  <!-- select/unselect all type === 'FOLLOW_UP' -->
  <div *ngIf="templateType === 'FOLLOW_UP'" class="m-bottom-20">
    <label class="form-checkbox">
      <input
        type="checkbox"
        id="select-all"
        (change)="resetFilters(!!filtersCount)"
        [checked]="!filtersCount">
      <i class="form-icon"></i> Select all
    </label>
  </div>
  <!-- /select/unselect all type === 'FOLLOW_UP' -->

  <!-- key-learning type === 'MARKET_REPORT' -->
  <div *ngIf="templateType === 'MARKET_REPORT' && (isKeyLearning || isAdminSide)" class="scroll-wrapper">
    <a [href]="'#key-learnings'" pageScroll>
      <i class="icon icon-arrow-right"></i> {{ 'MARKET_REPORT.KEY_LEARNING' | translate }}
    </a>
  </div>
  <!-- /key-learning type === 'MARKET_REPORT'  -->

  <!-- origin type === 'MARKET_REPORT'  -->
  <div *ngIf="templateType === 'MARKET_REPORT'" class="scroll-wrapper">
    <a [href]="'#origin-responses'" pageScroll>
      <i class="icon icon-arrow-right"></i> {{ 'MARKET_REPORT.ORIGIN' | translate }}
    </a>
  </div>
  <!-- /origin type === 'MARKET_REPORT'  -->

  <!-- map filters type === 'MARKET_REPORT' || 'FOLLOW_UP' -->
  <div *ngIf="continentsList.length" class="scroll-wrapper">

    <!-- type 'MARKET_REPORT' -->
    <a *ngIf="templateType === 'MARKET_REPORT'" [href]="'#map'" pageScroll>
      <span (click)="showSection.map = !showSection.map">
        <i *ngIf="showSection.map" class="icon icon-arrow-down"></i>
        <i *ngIf="!showSection.map" class="icon icon-arrow-up"></i>
      </span>
      {{ 'MARKET_REPORT.MAP.TITLE' | translate }}
    </a>
    <!-- /type 'MARKET_REPORT' -->

    <!-- type 'FOLLOW_UP' -->
    <a *ngIf="templateType === 'FOLLOW_UP'" pageScroll>
      <span (click)="showSection.map = !showSection.map">
        <i *ngIf="showSection.map" class="icon icon-arrow-down"></i>
        <i *ngIf="!showSection.map" class="icon icon-arrow-up"></i>
      </span>
      Map
    </a>
    <!-- /type 'FOLLOW_UP' -->

    <div [hidden]="!showSection.map" class="filter-wrapper animate-fade is-3">

      <label class="form-checkbox">
        <input
          type="checkbox"
          id="select-all-continent"
          (change)="filterEverything($event.target['checked'], continentsList, 'CONTINENT')"
          [checked]="!(filters['worldmap'])">
        <i class="form-icon"></i> {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
      </label>

      <div *ngFor="let continent of continentsList" class="form-group">
        <label class="form-checkbox">
          <input
            type="checkbox"
            [name]="continent"
            (change)="checkCountry($event)"
            [id]="'continent-'+continent"
            [checked]="filteredContinents ? filteredContinents[continent] : true">
          <i class="form-icon"></i> {{ ('CONTINENTS.' + continent) | translate }}
        </label>
      </div>
    </div>

  </div>
  <!-- /map filters type === 'MARKET_REPORT' || 'FOLLOW_UP' -->

  <!-- professional filters type === 'MARKET_REPORT' || 'FOLLOW_UP' -->
  <div *ngIf="professionalsTags.length" class="scroll-wrapper animate-fade is-3">

    <!-- type 'MARKET_REPORT' -->
    <a *ngIf="templateType === 'MARKET_REPORT'" [href]="'#professionals'" pageScroll>
      <span (click)="showSection.professionals = !showSection.professionals">
        <i *ngIf="showSection.professionals" class="icon icon-arrow-down"></i>
        <i *ngIf="!showSection.professionals" class="icon icon-arrow-up"></i>
      </span>
      {{ 'MARKET_REPORT.PROFESSIONAL.TITLE' | translate }}
    </a>
    <!-- /type 'MARKET_REPORT' -->

    <!-- type 'FOLLOW_UP' -->
    <a *ngIf="templateType === 'FOLLOW_UP'" pageScroll>
      <span (click)="showSection.professionals = !showSection.professionals">
        <i *ngIf="showSection.professionals" class="icon icon-arrow-down"></i>
        <i *ngIf="!showSection.professionals" class="icon icon-arrow-up"></i>
      </span>
      Professionals
    </a>
    <!-- /type 'FOLLOW_UP' -->

    <div [hidden]="!showSection.professionals" class="filter-wrapper animate-fade is-3">

      <label class="form-checkbox">
        <input
          type="checkbox"
          id="select-all-professionals"
          (change)="filterEverything($event.target['checked'], professionalsTags, 'TAG')"
          [checked]="!filters['tags']">
        <i class="form-icon"></i> {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
      </label>

      <div
        *ngFor="let tag of (seeMore.professionals ? professionalsTags : (professionalsTags | slice:0:6))"
        class="form-group">
        <label class="form-checkbox">
          <input
            (change)="checkTag($event, tag._id)"
            [checked]="selectedTags[tag._id]"
            [id]="tag.label | multiling:userLang"
            [name]="tag.label | multiling:userLang"
            type="checkbox">
          <i class="form-icon"></i> {{ tag.label | multiling:userLang | FormatText }}
        </label>
      </div>

      <!-- see more -->
      <div *ngIf="professionalsTags.length > 6 && !seeMore.professionals">
        <span (click)="seeMore.professionals = true" class="text-link">
          {{ 'MARKET_REPORT.SEE_MORE' | translate }}
        </span>
      </div>
      <!-- /see more -->

      <!-- see less -->
      <div *ngIf="professionalsTags.length > 6 && seeMore.professionals">
        <span class="text-link" (click)="seeMore.professionals = false">
          {{ 'MARKET_REPORT.SEE_LESS' | translate }}
        </span>
      </div>
      <!-- /see less -->

    </div>

    <div *ngIf="filters['professionals']" class="m-top-10">
      <ng-container *ngFor="let professional of filters['professionals'].value | keyvalue">
        <div
          *ngIf="professional.value['professional']"
          (click)="deleteProfessionalFilter($event, professional.key)"
          class="tooltip prof-hidden-wrapper"
          [attr.data-tooltip]="'MARKET_REPORT.TOOLTIP_UNHIDE_PROFESSIONAL' | translate">
          <i class="fas fa-eye-slash text-alert"></i>
          <ng-container *ngIf="professional.value['professional']['firstName']">
            {{ professional.value['professional']['firstName'] }}
          </ng-container>
          <ng-container *ngIf="professional.value['professional']['lastName']">
            {{ professional.value['professional']['lastName'] }}
          </ng-container>
        </div>
      </ng-container>
    </div>

  </div>
  <!-- /professional filters type === 'MARKET_REPORT' || 'FOLLOW_UP' -->

  <!-- questions filters type === 'MARKET_REPORT' || 'FOLLOW_UP' -->
  <div *ngFor="let question of displayedQuestions" class="scroll-wrapper animate-fade is-3">

    <!-- textarea -->
    <ng-container *ngIf="question.controlType === 'textarea'">

      <!-- type 'MARKET_REPORT' -->
      <a *ngIf="templateType === 'MARKET_REPORT'" [href]="'#'+question.identifier" pageScroll>
        <span (click)="showSection[question.identifier] = !showSection[question.identifier]">
          <ng-container *ngIf="(answersTagsLists[question.identifier] && answersTagsLists[question.identifier].length)">
            <i *ngIf="showSection[question.identifier] " class="icon icon-arrow-down"></i>
            <i *ngIf="!showSection[question.identifier]" class="icon icon-arrow-up"></i>
          </ng-container>
        </span>
        {{ question.title | multiling:userLang | FormatText }}
      </a>
      <!-- /type 'MARKET_REPORT' -->

      <!-- type 'FOLLOW_UP' -->
      <a *ngIf="templateType === 'FOLLOW_UP'" pageScroll>
        <span (click)="showSection[question.identifier] = !showSection[question.identifier]">
          <ng-container *ngIf="(answersTagsLists[question.identifier] && answersTagsLists[question.identifier].length)">
            <i *ngIf="showSection[question.identifier] " class="icon icon-arrow-down"></i>
            <i *ngIf="!showSection[question.identifier]" class="icon icon-arrow-up"></i>
          </ng-container>
        </span>
        {{ question.title | multiling:userLang | FormatText }}
      </a>
      <!-- /type 'FOLLOW_UP' -->

      <div
        *ngIf="(answersTagsLists[question.identifier] && answersTagsLists[question.identifier].length)"
        [hidden]="!showSection[question.identifier]" class="filter-wrapper animate-fade is-3">

        <label class="form-checkbox">
          <input
            type="checkbox"
            [id]="'select-all'+(question.title | multiling:userLang)"
            (change)="filterEverything($event.target['checked'], [question], question.controlType)"
            [checked]="!filters[question.identifier]">
          <i class="form-icon"></i> {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
        </label>

        <div
          *ngFor="let answerTag of (seeMore[question.identifier] ? answersTagsLists[question.identifier]
          : (answersTagsLists[question.identifier] | slice:0:4))"
          class="form-group">
          <label class="form-checkbox">
            <input
              (change)="checkAnswerTag($event, question.identifier)"
              [checked]="selectedAnswersTags[question.identifier][answerTag._id]"
              [id]="answerTag._id"
              [name]="answerTag._id"
              type="checkbox">
            <i class="form-icon"></i> {{ answerTag.label | multiling:userLang | FormatText }}
          </label>
        </div>

        <!-- see more -->
        <div *ngIf="answersTagsLists[question.identifier] && answersTagsLists[question.identifier].length > 4
        && !seeMore[question.identifier]">
          <span (click)="seeMore[question.identifier] = true" class="text-link">
            {{ 'MARKET_REPORT.SEE_MORE' | translate }}
          </span>
        </div>
        <!-- /see more -->

        <!-- see less -->
        <div *ngIf="answersTagsLists[question.identifier] && answersTagsLists[question.identifier].length > 4
        && seeMore[question.identifier]">
          <span class="text-link" (click)="seeMore[question.identifier] = false">
            {{ 'MARKET_REPORT.SEE_LESS' | translate }}
          </span>
        </div>
        <!-- /see less -->

      </div>

    </ng-container>
    <!-- /textarea -->

    <!-- checkbox || radio -->
    <ng-container *ngIf="question.controlType === 'checkbox' || question.controlType === 'radio'">

      <!-- type 'MARKET_REPORT' -->
      <a *ngIf="templateType === 'MARKET_REPORT'" [href]="'#'+question.identifier" pageScroll>
        <span (click)="showSection[question.identifier] = !showSection[question.identifier]">
          <i *ngIf="showSection[question.identifier] " class="icon icon-arrow-down"></i>
          <i *ngIf="!showSection[question.identifier]" class="icon icon-arrow-up"></i>
        </span>
        {{ question.title | multiling:userLang | FormatText }}
      </a>
      <!-- /type 'MARKET_REPORT' -->

      <!-- type 'FOLLOW_UP' -->
      <a *ngIf="templateType === 'FOLLOW_UP'" pageScroll>
        <span (click)="showSection[question.identifier] = !showSection[question.identifier]">
          <i *ngIf="showSection[question.identifier] " class="icon icon-arrow-down"></i>
          <i *ngIf="!showSection[question.identifier]" class="icon icon-arrow-up"></i>
        </span>
        {{ question.title | multiling:userLang | FormatText }}
      </a>
      <!-- /type 'FOLLOW_UP' -->

      <div [hidden]="!showSection[question.identifier]" class="filter-wrapper animate-fade is-3">

        <label class="form-checkbox">
          <input
            type="checkbox"
            [id]="'select-all'+(question.title | multiling:userLang)"
            (change)="filterEverything($event.target['checked'], [question], question.controlType)"
            [checked]="!filters[question.identifier]">
          <i class="form-icon"></i> {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
        </label>

        <div *ngFor="let option of (seeMore[question.identifier] ? question.options
        : (question.options | slice:0:4))" class="form-group">
          <label class="form-checkbox">
            <input
              (change)="checkOption($event, question)"
              [checked]="filters[question.identifier] ? filters[question.identifier].value[option.identifier] : true"
              [id]="option.identifier"
              [name]="option.identifier"
              type="checkbox">
            <i class="form-icon"></i> {{ option.label | multiling:userLang | FormatText }}
          </label>
        </div>

        <!-- see more -->
        <div *ngIf="question.options && question.options.length > 4 && !seeMore[question.identifier]">
          <span (click)="seeMore[question.identifier] = true" class="text-link">
            {{ 'MARKET_REPORT.SEE_MORE' | translate }}
          </span>
        </div>
        <!-- /see more -->

        <!-- see less -->
        <div *ngIf="question.options && question.options.length > 4 && seeMore[question.identifier]">
          <span class="text-link" (click)="seeMore[question.identifier] = false">
            {{ 'MARKET_REPORT.SEE_LESS' | translate }}
          </span>
        </div>
        <!-- /see less -->

      </div>

    </ng-container>
    <!-- /checkbox || radio -->

    <!-- rest types -->
    <div *ngIf="question.controlType !== 'textarea' && question.controlType !== 'checkbox'
    && question.controlType !== 'radio'" class="scroll-wrapper">
      <a [href]="'#' + question.identifier" pageScroll>
        <i class="icon icon-arrow-right"></i> {{ question.title | multiling:userLang | FormatText }}
      </a>
    </div>
    <!-- /rest types -->

  </div>
  <!-- /questions filters -->

  <!-- conclusion filters -->
  <div *ngIf="isFinalConclusion || isAdminSide" class="scroll-wrapper">
    <a [href]="'#conclusion'" pageScroll>
      <i class="icon icon-arrow-right"></i> {{ 'MARKET_REPORT.CONCLUSION' | translate }}
    </a>
  </div>
  <!-- /conclusion filters -->

</div>

<!-- Modal to ask the operator to confirm for the preview of the synthesis at the side of the client -->
<app-utility-modal *ngIf="isAdminSide" [title]="'Confirmation'" [(showModal)]="isModalPreview">

  <section class="modal-body">
    <div>
      <ng-container *ngIf="!innovation.previewMode; else invisible">
        Do you really want to make this partial synthesis visible to the client?
      </ng-container>
      <ng-template #invisible>
        Do you really want to make this partial synthesis invisible to the client?
      </ng-template>
    </div>
  </section>

  <!-- footer -->
  <footer class="modal-footer">
    <button class="button modal-cancel">Cancel</button>
    <button class="button is-primary" (click)="onConfirmVisibility($event)">Confirm</button>
  </footer>
  <!-- /footer -->

</app-utility-modal>
<!-- /Modal to ask the admin to confirm for the preview of the synthesis at the side of the client -->

<!-- Modal to ask the operator to sure about ending the project -->
<app-utility-modal *ngIf="isAdminSide && isAdmin" [(showModal)]="isModalEnd" [title]="'Confirmation'">

  <section class="modal-body">
    <div>
      Do you really want to end this project? Please keep in mind that after this you won't be able to make
      any further changes.
    </div>
  </section>

  <!-- footer -->
  <footer class="modal-footer">
    <button class="button modal-cancel">Cancel</button>
    <button class="button is-primary" (click)="onClickEndInnovationConfirm($event)">Confirm</button>
  </footer>
  <!-- /footer -->

</app-utility-modal>
<!-- /Modal to ask operator to sure about ending the project -->
