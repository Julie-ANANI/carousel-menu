<div id="sidebar-market-report">

  <!-- selected contacts -->
  <div *ngIf="templateType === 'follow-up'">

    <!-- no contact selected -->
    <h6 *ngIf="!filterNumber" [innerText]="'SIDEBAR_MARKET_REPORT.SELECT_CONTACTS_CRITERIA'" class="m-no-bottom text-bold" translate></h6>
    <!-- /no contact selected -->

    <!-- button select contacts -->
    <a *ngIf="filterNumber" (click)="onClickSelect()" class="button is-primary" style="white-space: normal; height: unset">
      <i class="fas fa-share"></i>
      {{ 'SIDEBAR_MARKET_REPORT.SELECT' | translate }} {{ filterNumber }} {{ 'SIDEBAR_MARKET_REPORT.CONTACTS' | translate }}
    </a>

    <!-- button select contacts -->

  </div>
  <!-- /selected contacts -->


  <!-- divider -->
  <div class="divider"></div>
  <!-- /divider -->


  <!-- different actions for admin -->
  <ng-container *ngIf="templateType === 'market-report' && isAdmin && isAdminSide">
    <div class="dropdown">

      <a class="button dropdown-toggle is-outlined is-primary" tabindex="0">
        Actions <i class="fas fa-caret-down"> </i>
      </a>

      <div class="menu">

        <div
          (click)="modalPreviewInnovation = true"
          *ngIf="!innovation.previewMode && innovation.status !== 'DONE'"
          class="menu-item">
          <span>{{ 'MARKET_REPORT.SIDEBAR.MAKE_VISIBLE' | translate }}</span>
        </div>

        <div
          (click)="modalPreviewInnovation = true"
          *ngIf="innovation.previewMode && innovation.status !== 'DONE'"
          class="menu-item">
          <span>{{ 'MARKET_REPORT.SIDEBAR.MAKE_INVISIBLE' | translate }}</span>
        </div>

        <div class="menu-item">
          <a href="#executive-generate" pageScroll>{{ 'MARKET_REPORT.SIDEBAR.GENERATE_REPORT' | translate }}</a>
        </div>

        <div
          (click)="modalResetReport = true"
          *ngIf="innovation.executiveReport.totalSections > 0 && isAdminSide"
          class="menu-item">
          <span>{{ 'MARKET_REPORT.SIDEBAR.RESET_REPORT' | translate }}</span>
        </div>

        <div class="menu-item" (click)="modalEndInnovation = true">
          <span>{{ 'MARKET_REPORT.SIDEBAR.END_PROJECT' | translate }}</span>
        </div>

      </div>

    </div>

    <div class="divider"></div>

  </ng-container>
  <!-- /different actions for admin -->


  <!-- export option -->
  <div *ngIf="isOwner && !isAdminSide && !reportShared" class="text-center">
    <button class="btn btn-primary gtm-export-synthesis" (click)="modalExport = true"
            [textContent]="'MARKET_REPORT.BUTTON_EXPORT'" translate></button>
    <div class="divider"></div>
  </div>
  <!-- /export option -->


  <!-- views wrapper -->
  <div class="view-wrapper">

    <!-- title -->
    <h6 [innerText]="'SIDEBAR_MARKET_REPORT.MY_VIEWS'" translate></h6>
    <!-- /title -->


    <!-- show views -->
    <div *ngFor="let filter of sharedFiltersList" class="d-flex align-center m-top-1 m-bottom-1">

      <div (click)="deleteCustomFilter($event, filter.name)"
           [attr.data-tooltip]="'COMMON.TOOLTIP.DELETE' | translate"
           class="c-hand m-right-1 tooltip is-right">
        <img
          [ngStyle]="{ 'height': '13px', 'width': '12px'}"
          alt=" "
          src="https://res.cloudinary.com/umi/image/upload/v1573650537/pictos/delete/picto-delete-danger.svg">
      </div>

      <a
        (click)="loadFilter(filter.name)"
        [attr.data-tooltip]="'SIDEBAR_MARKET_REPORT.TOOLTIP_LOAD_VIEW' | translate"
        [ngStyle]="{ 'margin-top': '1px' }"
        class="c-hand tooltip text-medium text-xs text-background">
        {{ filter.name }}
      </a>

    </div>
    <!-- /show views -->


    <!-- form to register view -->
    <form (ngSubmit)="registerNewFilter()">

      <div class="form-group p-top-1">
        <label>
          <input
            [(ngModel)]="filterName"
            [ngModelOptions]="{ standalone: true }"
            [placeholder]="'SIDEBAR_MARKET_REPORT.FORM_VIEW_PLACEHOLDER' | translate"
            class="form-input is-sm"
            type="text">
        </label>
      </div>

      <div class="text-center p-top-1">
        <button
          [disabled]="!filterName"
          [ngStyle]="{ 'border-width': '2px', 'opacity': '1' }"
          [textContent]="'COMMON.BUTTON.SAVE'"
          class="button is-draft is-outlined is-sm"
          translate
          type="submit">
        </button>
      </div>

    </form>
    <!-- /form to register view -->

  </div>
  <!-- /views wrapper -->


  <!-- divider -->
  <div class="divider"></div>
  <!-- /divider -->


  <!-- view activated -->
  <div *ngIf="activatedCustomFilters.length > 0">

    <h6 [innerText]="'SIDEBAR_MARKET_REPORT.ACTIVATED_VIEW'" class="m-bottom-2" translate></h6>

    <div *ngFor="let filter of activatedCustomFilters" class="m-top-1">
      <span (click)="unloadFilter($event, filter)"
            class="d-flex align-center text-background text-medium m-bottom-1 text-xs c-hand">
        <i class="icon text-primary m-right-2 icon-cross"></i>
        {{ filter }}
      </span>
    </div>

    <div class="divider"></div>

  </div>
  <!-- /view activated -->

  <!-- select/unselect all -->
  <div *ngIf="templateType === 'follow-up'">
    <label class="form-checkbox p-no-right">
      {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
      <input
        type="checkbox"
        (change)="resetFilters(!!filtersCount)"
        [checked]="!filtersCount">
      <i class="form-icon"></i>
    </label>
  </div>
  <!-- /select/unselect all -->



  <!-- executive report -->
  <div *ngIf="templateType === 'market-report' && innovation.executiveReport.totalSections > 0 && !reportShared"
       class="filter-rest-wrapper"
       [ngStyle]="{ 'padding-bottom': '1rem' }">
    <a href="#executive-report" pageScroll class="text-primary-dark">Executive report</a>
  </div>
  <!-- /executive report -->


  <!-- key-learning -->
  <div *ngIf="templateType === 'market-report' && innovation.marketReport?.keyLearning?.conclusion || isAdminSide"
       class="filter-rest-wrapper"
       [ngStyle]="{ 'padding-bottom': '1rem' }">
    <a href="#key-learnings" pageScroll class="text-primary-dark" [innerText]="'MARKET_REPORT.KEY_LEARNING'" translate>
    </a>
  </div>
  <!-- /key-learning -->


  <!-- origin -->
  <div *ngIf="templateType === 'market-report'" class="filter-rest-wrapper" [ngStyle]="{ 'padding-bottom': '1rem' }">
    <a href="#origin-responses" pageScroll class="text-primary-dark" [innerText]="'MARKET_REPORT.ORIGIN'" translate>
    </a>
  </div>
  <!-- /origin -->


  <!-- map filters -->
  <div class="filter-rest-wrapper">

    <div *ngIf="continentsList.length > 0" class="m-bottom-15">
      <span class="d-flex align-center" (click)="showSection.map = !showSection.map">
        <a *ngIf="templateType === 'market-report'" href="#map" pageScroll
           class="flex-between m-no-bottom">
          <i *ngIf="showSection.map" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
          <i *ngIf="!showSection.map" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
          <span class="text-primary-dark">{{ 'MARKET_REPORT.MAP.TITLE' | translate }}</span>
        </a>
        <span *ngIf="templateType === 'follow-up'">
          <i *ngIf="showSection.map" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
          <i *ngIf="!showSection.map" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
          <span class="text-primary-dark">{{ 'MARKET_REPORT.MAP.TITLE' | translate }}</span>
        </span>
      </span>
    </div>

    <div [hidden]="!showSection.map">
      <label class="form-checkbox p-no-right">
        {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
        <input
          type="checkbox"
          (change)="filterEverything($event.target.checked, continentsList, 'CONTINENT')"
          [checked]="!(filters['worldmap'])">
        <i class="form-icon"></i>
      </label>
      <div *ngFor="let continent of continentsList" class="form-group">
        <label class="form-checkbox">
          <input
            type="checkbox"
            [name]="continent"
            (change)="checkCountry($event)"
            [checked]="filteredContinents ? filteredContinents[continent] : true">
          <i class="form-icon"></i><span>{{ ('CONTINENTS.' + continent) | translate }}</span>
        </label>
      </div>
    </div>
  </div>
  <!-- /map filters -->


  <!-- professional filters -->
  <div class="filter-rest-wrapper filter-professional">
    <div *ngIf="tagsList.length > 0" class="m-bottom-15" (click)="showSection.professionals = !showSection.professionals">
      <a *ngIf="templateType === 'market-report'" href="#professionals" pageScroll
         class="flex-between m-no-bottom">
        <i *ngIf="showSection.professionals" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
        <i *ngIf="!showSection.professionals" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
        <span class="text-primary-dark">{{ 'MARKET_REPORT.PROFESSIONAL.TITLE' | translate }}</span>
      </a>
      <span *ngIf="templateType === 'follow-up'">
        <i *ngIf="showSection.professionals" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
        <i *ngIf="!showSection.professionals" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
        <span class="text-primary-dark">{{ 'MARKET_REPORT.PROFESSIONAL.TITLE' | translate }}</span>
      </span>
    </div>


    <div  [hidden]="!showSection.professionals">
      <label class="form-checkbox p-no-right">
        {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
        <input
          type="checkbox"
          (change)="filterEverything($event.target.checked, tagsList, 'TAG')"
          [checked]="!filters['tags']">
        <i class="form-icon"></i>
      </label>
      <div *ngFor="let tag of (seeMore.professionals ? tagsList : (tagsList | slice:0:6))" class="form-group">
        <label class="form-checkbox">
          <input
            type="checkbox"
            [name]="tag.label | multiling:userLang"
            (change)="checkTag($event, tag._id)"
            [checked]="selectedTags[tag._id]">
          <i class="form-icon"></i><span>{{ tag.label | multiling:userLang | FormatText }}</span>
        </label>
      </div>

      <!-- see more -->
      <div *ngIf="tagsList && tagsList.length > 6 && !seeMore.professionals">
        <span class="text-link" [innerText]="'MARKET_REPORT.SEE_MORE'" translate
              (click)="seeMore.professionals = true"></span>
      </div>

      <!-- see less -->
      <div *ngIf="tagsList && tagsList.length > 6 && seeMore.professionals">
        <span class="text-link" [innerText]="'MARKET_REPORT.SEE_LESS'" translate
              (click)="seeMore.professionals = false"></span>
      </div>
    </div>

    <div *ngIf="filters['professionals']" class="professional-hide-wrapper">
      <div *ngFor="let professional of filters['professionals'].value | keyvalue"
           (click)="deleteProfessionalFilter($event, professional.key)"
           class="tooltip c-hand" [attr.data-tooltip]="'MARKET_REPORT.TOOLTIP_UNHIDE_PROFESSIONAL' | translate">
        <i class="fas fa-eye-slash text-alert" aria-hidden="true"></i>
        <span>{{ professional.value.professional?.firstName }} {{ professional.value.professional?.lastName }}</span>
      </div>
    </div>

  </div>
  <!-- /professional filters -->


  <!-- questions filters -->
  <div *ngFor="let question of displayedQuestions" class="filter-rest-wrapper filter-question">
    <!-- textarea -->
    <ng-container *ngIf="question.controlType === 'textarea'">
      <div class="m-bottom-15">
          <span class="d-flex align-center" (click)="showSection[question.identifier] = !showSection[question.identifier]">
            <a *ngIf="templateType === 'market-report'" [href]="'#' + question.identifier" pageScroll class="flex-between m-no-bottom c-hand">
              <i *ngIf="showSection[question.identifier] && answersTagsLists[question.identifier]?.length > 0" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
              <i *ngIf="!showSection[question.identifier] && answersTagsLists[question.identifier]?.length > 0" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
              <span class="text-primary-dark" [innerText]= "question.title | multiling:userLang | FormatText "></span>
            </a>
            <span *ngIf="templateType === 'follow-up'">
              <i *ngIf="showSection[question.identifier]" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
              <i *ngIf="!showSection[question.identifier]" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
              <span class="text-primary-dark" [innerText]= "question.title | multiling:userLang | FormatText "></span>
            </span>
          </span>
      </div>
      <ng-container *ngIf="answersTagsLists[question.identifier]?.length > 0">
        <label *ngIf="answersTagsLists[question.identifier]?.length > 0" class="form-checkbox p-no-right">
          {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
          <input
            type="checkbox"
            (change)="filterEverything($event.target.checked, [question], question.controlType)"
            [checked]="!filters[question.identifier]">
          <i class="form-icon"></i>
        </label>
        <div
          *ngFor="let answerTag of (seeMore[question.identifier] ? answersTagsLists[question.identifier] : (answersTagsLists[question.identifier] | slice:0:4))"
          class="form-group">
          <label class="form-checkbox">
            <input
              type="checkbox"
              [name]="answerTag._id"
              (change)="checkAnswerTag($event, question.identifier)"
              [checked]="selectedAnswersTags[question.identifier][answerTag._id]">
            <i class="form-icon"></i><span>{{ answerTag.label | multiling:userLang | FormatText }}</span>
          </label>
        </div>
        <!-- see more -->
        <div
          *ngIf="answersTagsLists[question.identifier] && answersTagsLists[question.identifier].length > 6 && !seeMore[question.identifier]">
            <span class="text-link" [innerText]="'MARKET_REPORT.SEE_MORE'" translate
                  (click)="seeMore[question.identifier] = true"></span>
        </div>
        <!-- see less -->
        <div
          *ngIf="answersTagsLists[question.identifier] && answersTagsLists[question.identifier].length > 6 && seeMore[question.identifier]">
            <span class="text-link" [innerText]="'MARKET_REPORT.SEE_LESS'" translate
                  (click)="seeMore[question.identifier] = false"></span>
        </div>
      </ng-container>
    </ng-container>

    <!-- checkbox/radio -->
    <ng-container *ngIf="question.controlType === 'checkbox' || question.controlType === 'radio'">

      <div *ngIf="question.options.length > 0" class="m-bottom-15">
          <span class="d-flex align-center" (click)="showSection[question.identifier] = !showSection[question.identifier]">
            <a *ngIf="templateType === 'market-report'" [href]="'#' + question.identifier" pageScroll class="flex-between m-no-bottom c-hand">
              <i *ngIf="showSection[question.identifier]" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
              <i *ngIf="!showSection[question.identifier]" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
              <span class="text-primary-dark" [innerText]= "question.title | multiling:userLang | FormatText "></span>
            </a>
            <span *ngIf="templateType === 'follow-up'">
              <i *ngIf="showSection[question.identifier]" class="fas fa-angle-up text-notify" aria-hidden="true"></i>
              <i *ngIf="!showSection[question.identifier]" class="fas fa-angle-down text-notify" aria-hidden="true"></i>
              <span class="text-primary-dark" [innerText]= "question.title | multiling:userLang | FormatText "></span>
            </span>
          </span>
      </div>

      <div [hidden]="!showSection[question.identifier]">
        <label class="form-checkbox p-no-right">
          {{ 'COMMON.LABEL.SELECT_ALL' | translate }}
          <input
            type="checkbox"
            (change)="filterEverything($event.target.checked, [question], question.controlType)"
            [checked]="!filters[question.identifier]">
          <i class="form-icon"></i>
        </label>
        <div *ngFor="let option of question.options" class="form-group">
          <label class="form-checkbox">
            <input
              type="checkbox"
              [name]="option.identifier"
              (change)="checkOption($event, question)"
              [checked]="filters[question.identifier] ? filters[question.identifier].value[option.identifier] : true">
            <i class="form-icon"></i><span>{{ option.label | multiling:userLang | FormatText }}</span>
          </label>
        </div>
      </div>
    </ng-container>

    <!-- other types -->
    <ng-container *ngIf="question.controlType !== 'textarea' && question.controlType !== 'checkbox' && question.controlType !== 'radio'">
      <div class="m-bottom-15">
          <span class="d-flex align-center">
            <a [href]="'#' + question.identifier" pageScroll class="flex-between m-no-bottom c-hand">
              <span class="text-primary-dark" [innerText]= "question.title | multiling:userLang | FormatText "></span>
            </a>
          </span>
      </div>
    </ng-container>

  </div>
  <!-- /questions filters -->


  <!-- conclusion filters -->
  <div *ngIf="innovation.marketReport?.finalConclusion?.conclusion.length > 0 || isAdminSide"
       class="filter-rest-wrapper">
    <a href="#conclusion" pageScroll class="text-primary-dark">
      <div class="flex-between">
        <span [innerText]="'MARKET_REPORT.CONCLUSION'" translate></span>
      </div>
    </a>
  </div>
  <!-- /conclusion filters -->


</div>


<!-- Modal to ask the operator to confirm for the preview of the innovation at the side of the client -->
<app-modal [title]="'MARKET_REPORT.SIDEBAR.CONFIRMATION'" [(showModal)]="modalPreviewInnovation">

  <section class="modal-body">
    <ng-container *ngIf="!innovation.previewMode">
      <span>{{ 'MARKET_REPORT.SIDEBAR.REALLY_MAKE_VISIBLE' | translate }}</span>
    </ng-container>

    <ng-container *ngIf="innovation.previewMode">
      <span>{{ 'MARKET_REPORT.SIDEBAR.REALLY_MAKE_INVISIBLE' | translate }}</span>
    </ng-container>
  </section>

  <!-- footer -->
  <footer class="modal-footer">
    <button class="button modal-cancel">{{ 'COMMON.BUTTON.CANCEL' | translate }}</button>
    <button class="button is-primary" (click)="onClickPreviewConfirm($event)">{{ 'COMMON.BUTTON.CONFIRM' | translate }}</button>
  </footer>
  <!-- /footer -->

</app-modal>
<!-- /Modal to ask the admin to confirm for the preview of the innovation at the side of the client -->


<!-- Modal to ask the operator to confirm for the reset of the executive report -->
<app-modal [(showModal)]="modalResetReport" [title]="'MARKET_REPORT.SIDEBAR.CONFIRMATION'">

  <section class="modal-body">
    <span>{{ 'MARKET_REPORT.SIDEBAR.REALLY_RESET_REPORT' | translate }}</span>
  </section>

  <!-- footer -->
  <footer class="modal-footer">
    <button class="button modal-cancel">{{ 'COMMON.BUTTON.CANCEL' | translate }}</button>
    <button class="button is-primary" (click)="onClickResetConfirm($event)">{{ 'COMMON.BUTTON.CONFIRM' | translate }}</button>
  </footer>
  <!-- /footer -->

</app-modal>
<!-- /Modal to ask the operator to confirm for the reset of the executive report -->


<!-- Modal to ask the operator to sure about ending the project -->
<app-modal [(showModal)]="modalEndInnovation" [title]="'MARKET_REPORT.SIDEBAR.CONFIRMATION'">

  <section class="modal-body">
    <span>{{ 'MARKET_REPORT.SIDEBAR.REALLY_END_PROJECT' | translate }}</span>
  </section>

  <!-- footer -->
  <footer class="modal-footer">
    <button class="button modal-cancel">{{ 'COMMON.BUTTON.CANCEL' | translate }}</button>
    <button class="button is-primary" (click)="onClickEndInnovationConfirm($event)">{{ 'COMMON.BUTTON.CONFIRM' | translate }}</button>
  </footer>
  <!-- /footer -->

</app-modal>
<!-- /Modal to ask operator to sure about ending the project -->


<!-- Modal to ask operator and client to export different reports -->
<ng-container *ngIf="isOwner">
  <app-market-report-export-modal [innovation]="innovation"
                                  [(showModal)]="modalExport"></app-market-report-export-modal>
</ng-container>
<!-- /Modal to ask operator and client to export different reports -->
