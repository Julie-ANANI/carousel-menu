<ng-container *ngIf="modalAnswer">
  <section id="user-answer-component">

    <!-- section class mail REJECTED_GMAIL -->
    <ng-container *ngIf="mailType">
      <span class="label label-draft">{{mailType}}</span>
    </ng-container>

    <div class="column col-xs-12 col-11 col-mx-auto">
      <!-- section save -->
      <ng-container *ngIf="modeAdmin">
        <div class="section-light-pad rm-pad-top text-right" [ngSwitch]="modalAnswer?.localStatus">

          <button class="btn btn-primary" (click)="importAnswer($event)" *ngSwitchCase="'draft'">
            {{ 'COMMON.BUTTON.IMPORT' | translate }}
          </button>

          <button class="btn btn-primary" [disabled]="!editMode" (click)="save($event)" *ngSwitchDefault>
            {{ 'COMMON.BUTTON.SAVE' | translate }}
          </button>

        </div>
      </ng-container>

      <!-- section user details -->
      <div class="section-details">

        <!-- name, flag and rating -->
        <div class="header-wrapper flex-between">

          <div class="title-wrapper d-flex">

            <!-- name -->
            <h4>

              <ng-container *ngIf="modalAnswer.professional?.firstName || modalAnswer.professional?.lastName">
                {{ modalAnswer.professional?.firstName }} {{ modalAnswer.professional?.lastName }}
              </ng-container>

              <ng-container *ngIf="!modalAnswer.professional?.firstName && !modalAnswer.professional?.lastName">
                {{ 'MARKET_REPORT.ANONYMOUS' | translate }}
              </ng-container>

            </h4>
            <!-- /name -->

            <!-- rating -->
            <ng-container *ngIf="editMode">
              <div class="rating-wrapper">
                <app-rating-item
                  [editMode]="modeAdmin"
                  [prop]="'profile'"
                  [rating]="modalAnswer.profileQuality"
                  (ratingChange)="updateProfileQuality($event)">
                </app-rating-item>
              </div>
            </ng-container>

            <!-- country -->
            <ng-container *ngIf="!editCountry">
              <div class="country-wrapper flex-between">
                <app-country-flag [country]="modalAnswer.country" [width]="50" [height]="35"></app-country-flag>
                <div *ngIf="modeAdmin && editMode" class="icon icon-meta tooltip" data-tooltip="Modify Country" (click)="onClickEdit('country')">
                  <i class="fas fa-pencil-alt"></i>
                </div>
              </div>
            </ng-container>

          </div>

          <!-- edit button -->
          <ng-container *ngIf="modeAdmin && modalAnswer.localStatus !== 'draft'">
            <div class="button-wrapper">
              <label class="form-switch text-medium" for="answer-editMode">
                <input
                  type="checkbox"
                  name="answer-editMode"
                  id="answer-editMode"
                  (change)="changeMode($event)"
                  [checked]="editMode">
                <i class="form-icon"></i>{{ 'Edit user' }}
              </label>
            </div>
          </ng-container>

        </div>

        <!-- edit country -->
        <ng-container *ngIf="editCountry">
          <div class="form-group">
            <label class="form-label">{{ 'COMMON.LABEL.COUNTRY' | translate }}</label>
            <app-autocomplete-input
              (update)="updateCountry($event)"
              [onlyOne]="true"
              [config]="{ placeholder: 'COMMON.PLACEHOLDER.COUNTRY', type: 'countries' }">
            </app-autocomplete-input>
          </div>
        </ng-container>

        <!-- blacklist company -->
        <ng-container *ngIf="modeAdmin && modalAnswer.localStatus !== 'draft' && modalAnswer.blacklistedCompany">
          <div class="icon icon-delete"><i class="fas fa-exclamation-triangle"></i></div>
          <span class="text text-alert text-medium">Maybe the answer comes from a blacklisted company!</span>
        </ng-container>

        <!-- linkedin -->
        <ng-container *ngIf="modeAdmin && modalAnswer.professional?.profileUrl">
          <div class="linkedin-wrapper">
            <span class="icon icon-secondary picto"><i class="fab fa-linkedin-in"></i></span>
            <a [href]="modalAnswer.professional.profileUrl" target="_blank">
              <span class="text-link">{{ modalAnswer.professional.profileUrl }}</span>
            </a>
          </div>
        </ng-container>

        <!-- job -->
        <ng-container *ngIf="modalAnswer.job || modalAnswer.professional?.jobTitle || editMode">
          <div class="job-wrapper">

            <span class="icon icon-meta picto"><i class="fas fa-address-card" aria-hidden="true"></i></span>

            <ng-container *ngIf="!editJob">
              <span>{{ modalAnswer.job || modalAnswer.professional?.jobTitle }}</span>
              <span *ngIf="modeAdmin && editMode" class="icon icon-meta tooltip" data-tooltip="Modify Profession" (click)="onClickEdit('job')">
                <i class="fas fa-pencil-alt"></i>
              </span>
            </ng-container>

            <ng-container *ngIf="editJob">
              <div class="form-group">
                <label class="form-label" for="answer-jobTitle">{{ 'COMMON.LABEL.JOBTITLE' | translate }}</label>
                <input
                  type="text"
                  [(ngModel)]="modalAnswer.job"
                  id="answer-jobTitle"
                  alt="Job title"
                  class="form-input"
                  [attr.placeholder]="'COMMON.PLACEHOLDER.JOBTITLE' | translate">
              </div>
            </ng-container>

          </div>
        </ng-container>

        <!-- company -->
        <ng-container *ngIf="modalAnswer.company.name || modalAnswer.professional?.company || editMode">
          <div class="company-wrapper">

            <span class="icon icon-meta picto"><i class="fas fa-building" aria-hidden="true"></i></span>

            <ng-container *ngIf="!editCompany">
              <span>{{ modalAnswer.company.name || modalAnswer.professional?.company }}</span>
              <span *ngIf="modeAdmin && editMode" class="icon icon-meta tooltip" data-tooltip="Modify Company" (click)="onClickEdit('company')">
                <i class="fas fa-pencil-alt"></i>
              </span>
            </ng-container>

            <ng-container *ngIf="editCompany">
              <div class="form-group">
                <label class="form-label" for="answer-company">{{ 'COMMON.LABEL.COMPANY' | translate }}</label>
                <input
                  type="text"
                  [(ngModel)]="modalAnswer.company.name"
                  id="answer-company"
                  alt="Company"
                  class="form-input"
                  [attr.placeholder]="'COMMON.PLACEHOLDER.COMPANY' | translate">
              </div>
            </ng-container>

          </div>
        </ng-container>

        <!-- email -->
        <ng-container *ngIf="modalAnswer.professional?.email">
          <div class="email-wrapper">
            <span class="icon icon-meta picto"><i class="fas fa-envelope"></i></span>
            <a [href]="'mailto:'+modalAnswer.professional.email">
              <span class="text-link">{{ modalAnswer.professional.email }}</span>
            </a>
          </div>
        </ng-container>

        <!-- section autoTags -->
        <ng-container *ngIf="autoTags?.length > 0">
          <div class="tags-wrapper">
            <div *ngFor="let tag of autoTags" class="label label-autoTags label-rounded">
              {{ tag }}
            </div>
          </div>
        </ng-container>

        <!-- received date and time, and time spent -->
        <ng-container *ngIf="modalAnswer.created || modalAnswer.time_elapsed">
          <div class="text text-notify text-bold receive-wrapper">
            <span *ngIf="modalAnswer.created">
              {{ 'ANSWER.RECEIVED.A' | translate }} {{ modalAnswer.created | date }} {{ 'ANSWER.RECEIVED.B' | translate }} {{ modalAnswer.created | slice: 11 : 16  }}
            </span>
            <span *ngIf="modeAdmin && modalAnswer.created && modalAnswer.time_elapsed">&nbsp; • &nbsp;</span>
            <span *ngIf="modeAdmin && modalAnswer.time_elapsed">
              {{ 'ANSWER.RECEIVED.C' | translate }} {{ floor(modalAnswer.time_elapsed/60) }} min. {{ floor(modalAnswer.time_elapsed%60) }} sec.
            </span>
          </div>
        </ng-container>

        <!-- ip -->
        <ng-container *ngIf="modalAnswer.ip && editMode">
          <div class="text text-notify text-bold i-wrapper">
            <span>{{ 'ANSWER.IP' | translate }} {{ modalAnswer.ip }}</span>
          </div>
        </ng-container>

      </div>
      <!-- /section user details -->

      <!-- section tags -->
      <ng-container *ngIf="modalAnswer?.tags.length > 0 || editMode">
        <div class="section-tags">
          <label class="form-label">Tags</label>
          <app-shared-tag-item
            [tags]="modalAnswer.tags"
            [editMode]="editMode"
            [projectId]="innovationId"
            (addTag)="addTag($event)"
            (createTag)="createTag($event)"
            (removeTag)="removeTag($event)">
          </app-shared-tag-item>
        </div>
      </ng-container>
      <!-- /section tags -->

      <!-- section status -->
      <ng-container *ngIf="modeAdmin && modalAnswer.status !== 'REJECTED_GMAIL' && modalAnswer.localStatus !== 'draft'">
        <div class="section-status flex-between">

          <!-- to reject -->
          <div class="status-rejected">
            <div class="label label-alert"><span>{{ 'ANSWER.STATUS.REJECTED' | translate }}</span></div>
            <button class="btn btn-radio rejected" [ngClass]="{ 'active': modalAnswer.status === 'REJECTED' }" (click)="updateStatus($event, 'REJECTED')">
              <span>•</span>
            </button>
          </div>

          <!-- submitted -->
          <div class="status-submitted">
            <div class="label label-progress"><span>{{ 'ANSWER.STATUS.SUBMITTED' | translate }}</span></div>
            <button class="btn btn-radio submitted" [ngClass]="{ 'active': modalAnswer.status === 'SUBMITTED' }" (click)="updateStatus($event, 'SUBMITTED')">
              <span>•</span>
            </button>
          </div>

          <!-- validated -->
          <div class="status-validated">
            <div class="label label-success"><span>{{ 'ANSWER.STATUS.VALIDATED' | translate }}</span></div>
            <button
              class="btn btn-radio validated"
              [ngClass]="{ 'active': modalAnswer.status === 'VALIDATED' || modalAnswer.status === 'VALIDATED_NO_MAIL' }"
              (click)="updateStatus($event, 'VALIDATED_NO_MAIL')">
              <span>•</span>
            </button>
          </div>

          <!-- email -->
          <ng-container *ngIf="modalAnswer.status === 'VALIDATED' || modalAnswer.status === 'VALIDATED_NO_MAIL'">
            <div class="status-email">
              <label class="form-switch text-medium" for="answer-email">
                <input
                  type="checkbox"
                  name="answer-email"
                  id="answer-email"
                  (change)="sendEmail($event, 'VALIDATED')"
                  [disabled]="!editMode"
                  [checked]="modalAnswer.status === 'VALIDATED'">
                <i class="form-icon"></i>{{ 'ANSWER.STATUS.EMAIL' | translate }}
              </label>
            </div>
          </ng-container>

        </div>
      </ng-container>
      <!-- /section status -->

      <!-- rejected by gmail -->
      <ng-container *ngIf="modeAdmin && modalAnswer.status === 'REJECTED_GMAIL'">
        <div class="status-gmail">

          <div class="label label-alert">
            <span>{{ 'ANSWER.STATUS.REJECTED_GMAIL' | translate }}</span>
          </div>

          <!-- the original reply message sent to Karine -->
          <ng-container *ngIf="meta && !editMode">
            <p class="text">{{ meta }}</p>
          </ng-container>

        </div>
      </ng-container>
      <!-- /rejected by gmail -->

      <!-- section questions -->
      <ng-container *ngFor="let question of questions">
        <app-answer-question
          [editMode]="editMode"
          [adminMode]="modeAdmin"
          [question]="question"
          [fullAnswer]="modalAnswer"
          [innoid]="innovationId">
        </app-answer-question>
      </ng-container>
      <!-- /section questions -->

    </div>
  </section>
</ng-container>
