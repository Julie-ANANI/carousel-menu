<div *ngIf="modalAnswer" class="user-answer-component">
  <div class="column col-xs-12 col-11 col-mx-auto">

    <!-- section save -->
    <div *ngIf="adminMode" class="section-save" [ngSwitch]="modalAnswer?.localStatus">

      <button class="btn btn-primary" (click)="importAnswer($event)" *ngSwitchCase="'draft'">
        {{'COMMON.IMPORT' | translate}}
      </button>

      <button class="btn btn-primary" [disabled]="!editMode" (click)="save($event)" *ngSwitchDefault>
        {{'COMMON.SAVE' | translate}}
      </button>

    </div>

    <!-- section user details -->
    <div class="section-details">

      <!-- Name, flag and rating -->
      <div class="title">
        <h6>
          <span *ngIf="modalAnswer.professional?.firstName">{{ modalAnswer.professional?.firstName }} {{ modalAnswer.professional?.lastName }}</span>
          <span *ngIf="!modalAnswer.professional?.firstName">{{ 'MARKET_REPORT.ANONYMOUS' | translate }}</span>
        </h6>
        <div *ngIf="editMode" class="app-rating">
          <app-rating-item
            [editMode]="adminMode"
            [prop]="profile"
            [rating]="modalAnswer.profileQuality"
            (ratingChange)="updateProfileQuality($event)">
          </app-rating-item>
        </div>
        <div class="country">
          <div *ngIf="!editCountry" [ngStyle]="{ 'display': 'inline-flex' }">
            <app-country-flag [country]="modalAnswer.country" [width]="50" [height]="35"></app-country-flag>
            <i *ngIf="adminMode && editMode" class="fas fa-pencil-alt" (click)="editCountry = true;" [ngStyle]="{ 'margin-left': '5px', 'margin-top': '22px' }"></i>
          </div>
        </div>
        <div *ngIf="adminMode && modalAnswer.localStatus !== 'draft'" class="editMode">
          <label class="form-switch" for="answer-editMode">
            <input
              type="checkbox"
              name="answer-editMode"
              id="answer-editMode"
              (change)="changeMode($event)"
              [checked]="editMode">
            <i class="form-icon"></i>
            {{ 'Edit user' }}
          </label>
          <p *ngIf="modalAnswer.blacklistedCompany" class="text-error">
            <i class="fas fa-exclamation-triangle"></i>
            La réponse vient peut-être d'une entreprise blacklistée !
          </p>
        </div>
      </div>

      <!-- Edit country -->
      <div *ngIf="editCountry" class="form-group">
        <app-autocomplete-input
          (update)="updateCountry($event)"
          [onlyOne]="true"
          [config]="{ placeholder: 'COMMON.COUNTRY_PLACEHOLDER', type: 'countries' }">
        </app-autocomplete-input>
      </div>

      <!-- Linkedin -->
      <div *ngIf="adminMode && modalAnswer.professional?.profileUrl" class="profile">
        <p>
          <i class="fas fa-linkedin-in"></i>
          <a [href]="modalAnswer.professional.profileUrl" target="_blank">
            <span class="text-link">{{ modalAnswer.professional.profileUrl }}</span>
          </a>
        </p>
      </div>

      <!-- Job -->
      <div class="job" *ngIf="modalAnswer.job || modalAnswer.professional?.jobTitle || editMode">
        <p><i class="fas fa-address-card" aria-hidden="true"></i></p>
        <p *ngIf="!editJob">
          {{ modalAnswer.job || modalAnswer.professional?.jobTitle }}
          <i *ngIf="adminMode && editMode" class="fas fa-pencil-alt" (click)="editJob = true;"></i>
        </p>
        <div *ngIf="editJob" class="form-group">
          <input
            type="text"
            [(ngModel)]="modalAnswer.job"
            id="answer-jobTitle"
            alt="Job title"
            class="form-default"
            [attr.placeholder]="'COMMON.JOBTITLE_PLACEHOLDER' | translate">
        </div>
      </div>

      <!-- Company -->
      <div class="company" *ngIf="modalAnswer.company.name || modalAnswer.professional?.company || editMode">
        <p><i class="fas fa-building" aria-hidden="true"></i></p>
        <p *ngIf="!editCompany">
          {{ modalAnswer.company.name || modalAnswer.professional?.company }}
          <i *ngIf="adminMode && editMode" class="fas fa-pencil-alt" (click)="editCompany = true;"></i>
        </p>
        <div *ngIf="editCompany" class="form-group">
          <input
            type="text"
            [(ngModel)]="modalAnswer.company.name"
            id="answer-company"
            alt="Company"
            class="form-default"
            [attr.placeholder]="'COMMON.COMPANY_PLACEHOLDER' | translate">
        </div>
      </div>

      <!-- Email -->
      <div *ngIf="modalAnswer.professional?.email" class="email">
        <p>
          <i class="far fa-envelope"></i>
          <a [href]="'mailto:'+modalAnswer.professional.email">
            {{ modalAnswer.professional.email }}
          </a>
        </p>
      </div>

      <!-- Received date and time, and time spent -->
      <div *ngIf="modalAnswer.created || modalAnswer.time_elapsed" class="time">
        <p>
          <strong>
            <span *ngIf="modalAnswer.created">
              {{ 'ANSWER.RECEIVED.A' | translate }} {{ modalAnswer.created | date }} {{ 'ANSWER.RECEIVED.B' | translate }} {{ modalAnswer.created | slice: 11 : 16  }}
            </span>
            <span *ngIf="adminMode && modalAnswer.created && modalAnswer.time_elapsed">&nbsp; • &nbsp;</span>
            <span *ngIf="adminMode && modalAnswer.time_elapsed">
              {{ 'ANSWER.RECEIVED.C' | translate }} {{ floor(modalAnswer.time_elapsed/60) }} min. {{ floor(modalAnswer.time_elapsed%60) }} sec.
            </span>
          </strong>
        </p>
      </div>

      <!-- IP -->
      <div *ngIf="modalAnswer.ip && editMode" class="ip">
        <p><strong>{{ 'ANSWER.IP' | translate }} {{ modalAnswer.ip }}</strong></p>
      </div>

    </div>

    <!-- section tags -->
    <div *ngIf="modalAnswer?.tags.length > 0" class="section-tags">
      <label class="form-label">Tags</label>
      <app-shared-tag-item
        [tags]="modalAnswer.tags"
        [editMode]="editMode"
        [projectId]="innovationId"
        (addTag)="addTag($event)"
        (createTag)="createTag($event)"
        (removeTag)="removeTag($event)">
      </app-shared-tag-item>
    </div>

    <!-- section status -->
    <div *ngIf="adminMode && modalAnswer.localStatus !== 'draft'" class="section-status">

      <!-- Rejected -->
      <div class="status-rejected">
        <span class="label-alert">{{ 'ANSWER.STATUS.REJECTED' | translate }}</span>
        <div
          class="radio-button rejected"
          [ngClass]="{ 'active': modalAnswer.status === 'REJECTED' }"
          (click)="updateStatus($event, 'REJECTED')">
          <span>•</span>
        </div>
      </div>

      <!-- Submitted -->
      <div class="status-submitted">
        <span class="label-progress">{{ 'ANSWER.STATUS.SUBMITTED' | translate }}</span>
        <div
          class="radio-button submitted"
          [ngClass]="{ 'active': modalAnswer.status === 'SUBMITTED' }"
          (click)="updateStatus($event, 'SUBMITTED')">
          <span>•</span>
        </div>
      </div>

      <!-- Validated -->
      <div class="status-validated">
        <span class="label-validate">{{ 'ANSWER.STATUS.VALIDATED' | translate }}</span>
        <div
          class="radio-button validated"
          [ngClass]="{ 'active': modalAnswer.status === 'VALIDATED' || modalAnswer.status === 'VALIDATED_NO_MAIL' }"
          (click)="updateStatus($event, 'VALIDATED_NO_MAIL')">
          <span>•</span>
        </div>
      </div>

      <!-- Email -->
      <div *ngIf="modalAnswer.status === 'VALIDATED' || modalAnswer.status === 'VALIDATED_NO_MAIL'" class="status-email">
        <label class="form-switch" for="answer-email">
          <input
            type="checkbox"
            name="answer-email"
            id="answer-email"
            (change)="sendEmail($event, 'VALIDATED')"
            [checked]="modalAnswer.status === 'VALIDATED'">
          <i class="form-icon"></i>
          {{ 'ANSWER.STATUS.EMAIL' | translate }}
        </label>
      </div>

    </div>

    <!-- section questions -->
    <div class="section-questions">
      <div *ngFor="let question of questions">
        <app-answer-question
          [editMode]="editMode"
          [adminMode]="adminMode"
          [question]="question"
          [fullAnswer]="modalAnswer"
          [innoid]="innovationId">
        </app-answer-question>
      </div>
    </div>

  </div>
</div>
