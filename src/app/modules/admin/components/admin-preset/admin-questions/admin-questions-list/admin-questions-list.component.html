<h1>{{total}} {{ 'PRESETS.QUESTIONS' | translate }}</h1>

<div class="text-right">
  <button [routerLink]="'/admin/presets/questions/new'" class="btn btn-primary" (click)="$event.preventDefault()">
    {{ 'PRESETS.QUESTION.ADD' | translate }}
  </button>
</div>

<label>{{ 'PRESETS.QUESTION.FILTER' | translate }} : <sqFilter [config]="config" (configChange)="loadQuestions($event)" [prop]="'identifier'"></sqFilter>

<div class="empty" *ngIf="questions && !questions.length">
  <p class="empty-title h5">{{ 'PRESETS.QUESTION.NONE.TITLE' | translate }}</p>
  <p class="empty-subtitle">{{ 'PRESETS.QUESTION.NONE.CONTENT' | translate }}</p>
  <div class="empty-action">
    <button [routerLink]="'/admin/presets/questions/new'" class="btn btn-lg btn-primary" (click)="$event.preventDefault()">
      {{ 'PRESETS.QUESTION.ADD' | translate }} <i class="icon icon-arrow-right"></i>
    </button>
  </div>
</div>

<div class="columns" *ngIf="questions && questions.length">

  <table class="table questions" wt-responsive-table>
    <thead>
      <tr>
        <th><sq-sort [config]="config" (configChange)="loadQuestions($event)" [prop]="'name'">{{ 'COMMON.NAME' | translate }}</sq-sort></th>
        <th><sq-sort [config]="config" (configChange)="loadQuestions($event)" [prop]="'controlType'">{{ 'COMMON.TYPE' | translate }}</sq-sort></th>
        <th><sq-sort [config]="config" (configChange)="loadQuestions($event)" [prop]="'updated'">{{ 'COMMON.UPDATED' | translate }}</sq-sort></th>
        <th><sq-sort [config]="config" (configChange)="loadQuestions($event)" [prop]="'created'">{{ 'COMMON.CREATED' | translate }}</sq-sort></th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let question of questions">
        <td><a [routerLink]="['/admin/presets/questions/' + question._id]">{{question.identifier}}</a></td>
        <td>{{question.controlType}}</td>
        <td>{{question.created | date : dateFormat}}</td>
        <td>{{question.updated | date : dateFormat}}</td>
        <td>
          <button class="btn btn-xs ghost-edit" (click)="(selectedQuestionToBeCloned = question) && $event.preventDefault()">
            <i class="far fa-copy"></i> {{ 'COMMON.CLONE' | translate }}
          </button>
        </td>
        <td><a class="delete c-hand" aria-label="Close" role="button" (click)="(selectedQuestionIdToBeDeleted = question._id) && $event.preventDefault()">
          <i class="icon icon-delete"></i>
        </a></td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="12">
          <sqPagination [config]="config" (configChange)="loadQuestions($event)" [total]="total" [propertyName]="'admin-questions'"></sqPagination>
        </td>
      </tr>
    </tfoot>
  </table>
</div>

<!-- MODAL : Are you sure you want to delete this question ? -->
<div class="modal" [ngClass]="{'active': selectedQuestionIdToBeDeleted}">
  <div class="modal-overlay" (click)="(selectedQuestionIdToBeDeleted = null) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(selectedQuestionIdToBeDeleted = null) && $event.preventDefault()"></button>
      <div class="modal-title h5">{{ 'PRESETS.QUESTION.DELETE_MODAL.TITLE' | translate }}</div>
    </div>
    <div class="modal-body">
      <div class="content">{{ 'PRESETS.QUESTION.DELETE_MODAL.CONTENT' | translate }}</div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-link" (click)="removeQuestion($event, selectedQuestionIdToBeDeleted)">
        {{ 'COMMON.DELETE' | translate }}
      </button>
      <button class="btn btn-primary" (click)="(selectedQuestionIdToBeDeleted = null) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL : Nouveau nom de la question clônée ? -->
<div class="modal" [ngClass]="{'active': selectedQuestionToBeCloned}">
  <div class="modal-overlay" (click)="(selectedQuestionToBeCloned = null) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(selectedQuestionToBeCloned = null) && $event.preventDefault()"></button>
      <div class="modal-title h5">{{ 'PRESETS.QUESTION.CLONE_MODAL.TITLE' | translate }}</div>
    </div>
    <div class="modal-body">
      <div class="content" *ngIf="selectedQuestionToBeCloned">
        {{ 'PRESETS.QUESTION.CLONE_MODAL.CONTENT' | translate }}
        <input class="form-input" type="text" [(ngModel)]="selectedQuestionToBeCloned.identifier"/>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-link" [disabled]="!selectedQuestionToBeCloned || !selectedQuestionToBeCloned.identifier"
              (click)="cloneQuestion($event, selectedQuestionToBeCloned)">{{ 'COMMON.CLONE' | translate }}</button>
      <button class="btn btn-primary" (click)="(selectedQuestionToBeCloned = null) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>
