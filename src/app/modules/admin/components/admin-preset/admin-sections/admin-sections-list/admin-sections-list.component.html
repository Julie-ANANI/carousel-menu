<h1>{{total}} {{ 'PRESETS.SECTIONS' | translate }}</h1>

<button [routerLink]="'/admin/sections/new'" class="btn btn-lg btn-primary" (click)="$event.preventDefault()">
  {{ 'PRESETS.SECTION.ADD' | translate }} <i class="icon icon-arrow-right"></i>
</button>

<label>{{ 'PRESETS.SECTION.FILTER' | translate }} : <sqFilter [config]="config" (configChange)="loadSections($event)" [prop]="'name'"></sqFilter></label>

<div class="empty" *ngIf="sections && !sections.length">
  <p class="empty-title h5">{{ 'PRESETS.SECTION.NONE.TITLE' | translate }}</p>
  <p class="empty-subtitle">{{ 'PRESETS.SECTION.NONE.CONTENT' | translate }}</p>
  <div class="empty-action">
    <button [routerLink]="'/admin/sections/new'" class="btn btn-lg btn-primary" (click)="$event.preventDefault()">
      {{ 'PRESETS.SECTION.ADD' | translate }} <i class="icon icon-arrow-right"></i>
    </button>
  </div>
</div>

<div class="columns" *ngIf="sections && sections.length">

  <table class="table sections" wt-responsive-table>
    <thead>
    <tr>
      <th><sq-sort [config]="config" (configChange)="loadSections($event)" [prop]="'name'">{{ 'COMMON.NAME' | translate }}</sq-sort></th>
      <th>Questions</th>
      <th><sq-sort [config]="config" (configChange)="loadSections($event)" [prop]="'domain'">{{ 'COMMON.DOMAIN' | translate }}</sq-sort></th>
      <th><sq-sort [config]="config" (configChange)="loadSections($event)" [prop]="'updated'">{{ 'COMMON.UPDATED' | translate }}</sq-sort></th>
      <th><sq-sort [config]="config" (configChange)="loadSections($event)" [prop]="'created'">{{ 'COMMON.CREATED' | translate }}</sq-sort></th>
      <th></th>
      <th></th>
    </tr>
    </thead>
    <tbody>

    <tr *ngFor="let section of sections">
      <td><a [routerLink]="['/admin/sections/' + section._id]">{{section.name}}</a></td>
      <td>{{section.questions ? section.questions.length : 0}}</td>
      <td>{{section.domain}}</td>
      <td>{{section.created | date : dateFormat}}</td>
      <td>{{section.updated | date : dateFormat}}</td>
      <td>
        <button class="btn btn-primary" (click)="(selectedSectionToBeCloned = section) && $event.preventDefault()">
          <i class="far fa-copy"></i> {{ 'COMMON.CLONE' | translate }}
        </button>
      </td>
      <td><a class="delete c-hand" aria-label="Close" role="button"
             (click)="(selectedSectionIdToBeDeleted = section._id) && $event.preventDefault()">
        <i class="icon icon-delete"></i>
      </a></td>
    </tr>
    </tbody>
    <tfoot>
    <tr>
      <td colspan="12">
        <sqPagination [config]="config" (configChange)="loadSections($event)" [total]="total" [propertyName]="'admin-sections'"></sqPagination>
      </td>
    </tr>
    </tfoot>
  </table>
</div>

<!-- MODAL : Are you sure you want to delete this section ? -->
<div class="modal" [ngClass]="{'active': selectedSectionIdToBeDeleted}">
  <div class="modal-overlay" (click)="(selectedSectionIdToBeDeleted = null) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(selectedSectionIdToBeDeleted = null) && $event.preventDefault()"></button>
      <div class="modal-title h5">{{ 'PRESETS.SECTION.DELETE_MODAL.TITLE' | translate }}</div>
    </div>
    <div class="modal-body">
      <div class="content">{{ 'PRESETS.SECTION.DELETE_MODAL.CONTENT' | translate }}</div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-link" (click)="removeSection($event, selectedSectionIdToBeDeleted)">{{ 'COMMON.DELETE' | translate }}</button>
      <button class="btn btn-primary" (click)="(selectedSectionIdToBeDeleted = null) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>

<!-- MODAL : Nouveau nom de la section clônée ? -->
<div class="modal" [ngClass]="{'active': selectedSectionToBeCloned}">
  <div class="modal-overlay" (click)="(selectedSectionToBeCloned = null) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(selectedSectionToBeCloned = null) && $event.preventDefault()"></button>
      <div class="modal-title h5">{{ 'PRESETS.SECTION.CLONE_MODAL.TITLE' | translate }}</div>
    </div>
    <div class="modal-body">
      <div class="content" *ngIf="selectedSectionToBeCloned">
        {{ 'PRESETS.SECTION.CLONE_MODAL.CONTENT' | translate }}
        <input class="form-input" type="text" [(ngModel)]="selectedSectionToBeCloned.name"/>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-link" [disabled]="!selectedSectionToBeCloned || !selectedSectionToBeCloned.name"
              (click)="cloneSection($event, selectedSectionToBeCloned)">
        {{ 'COMMON.CLONE' | translate }}
      </button>
      <button class="btn btn-primary" (click)="(selectedSectionToBeCloned = null) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>
