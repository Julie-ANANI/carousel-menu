<div class="container grid-2xl fluid p-top-30 p-bottom-30" id="admin-campaign-workflows">
  <div class="column col-sm-12 col-11 col-mx-auto">

    <!-- select / import / test workflow -->
    <div
      *ngIf="canAccess(['import']) || canAccess(['test'])"
      class="p-bottom-10 form-group flex-centered flex-wrap-wrap">

      <label
        *ngIf="canAccess(['import'])"
        class="form-label text-sm m-bottom-20 m-right-10"
        for="workflows">
        Select the workflow
      </label>

      <select
        *ngIf="canAccess(['import'])"
        class="form-select is-sm mxw-350 m-right-25 m-bottom-20"
        id="workflows"
        [ngModel]="templates ? templates[0] : null"
        (ngModelChange)="onClickSelect($event)"
        [ngModelOptions]="{ standalone: true }">
        <option *ngIf="templates.length === 0" [ngValue]="null">Select</option>
        <option *ngFor="let template of templates" [ngValue]="template">{{ template.name }}</option>
      </select>

      <!-- import button -->
      <button
        (click)="onClickImport()"
        *ngIf="canAccess(['import'])"
        [disabled]="isImporting"
        class="button is-sm is-primary m-right-25 m-bottom-20"
        type="button">
        <i class="fas fa-file-upload icon-left"></i>
        <ng-container *ngIf="isImporting; else textImport">
          importing the workflow...
        </ng-container>
        <ng-template #textImport>
          Import
        </ng-template>
      </button>
      <!-- /import button -->

      <!-- test button -->
      <button
        (click)="onClickTestWorkflow()"
        *ngIf="availableScenarios && availableScenarios.length && canAccess(['test'])"
        [disabled]="isTesting"
        class="button is-sm is-outlined is-primary m-bottom-20"
        type="button">
        <i class="fas fa-paper-plane icon-left"></i>
        <ng-container *ngIf="isTesting; else textTest">
          testing the workflow...
        </ng-container>
        <ng-template #textTest>
          Test workflow
        </ng-template>
      </button>
      <!-- /test button -->

    </div>
    <!-- /select / import / test workflow -->

    <!-- no campaign -->
    <div *ngIf="!availableScenarios.length" class="p-top-20">
      <app-message-template widthMax="354px">
        Don't have any workflow?
        <span *ngIf="canAccess(['import'])">
          <br>
          Try to add a one by clicking on "Import" button.
        </span>
      </app-message-template>
    </div>
    <!-- /no campaign -->

    <!-- campaign -->
    <ng-container *ngIf="availableScenarios.length">

      <div *ngIf="modifiedScenarios.length === 0" class="text-sm text-alert text-medium">
        You must have at least one workflow with all the modified emails.
      </div>

      <div
        *ngFor="let scenario of availableScenarios; let i=index;"
        [ngStyle]="{ 'animation-duration': ((i+1) * 200) + 'ms' }"
        class="p-bottom-30 animate-slide slide-down">
        <app-admin-edit-workflow
          (defaultScenarioChange)="setDefaultScenario($event)"
          (deletedScenario)="removeScenario($event)"
          (scenarioChange)="updateAvailableScenario($event)"
          [isEditable]="canAccess(['edit'])"
          [defaultScenario]="campaign.settings && campaign.settings.defaultWorkflow"
          [isDeletable]="canDelete(scenario)"
          [scenario]="scenario"
          [campaignId]="campaign._id"
          [innovationCardLanguages]="innovationCardLanguages"
          [signatures]="signatures">
        </app-admin-edit-workflow>
      </div>

    </ng-container>
    <!-- /campaign -->

  </div>
</div>


<!-- modal to ask for the confirmation if importing the same template -->
<umius-modal *ngIf="canAccess(['import'])" [(showModal)]="modalImport" title="Import Board">

  <section class="modal-body">{{ modalContent | translate }}</section>

  <footer class="modal-footer">
    <button (click)="closeModal()" [disabled]="isImporting" class="button modal-cancel" type="button">Cancel</button>
    <button
      (click)="onClickConfirm()"
      [disabled]="isImporting"
      class="button is-primary"
      type="button">
      <ng-container *ngIf="isImporting; else textImport">
        importing the workflow...
      </ng-container>
      <ng-template #textImport>
        Confirm
      </ng-template>
    </button>
  </footer>

</umius-modal>
<!-- /modal to ask for the confirmation if importing the same template -->
