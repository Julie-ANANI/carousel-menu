<div *ngIf="canAccess()" class="container grid-2xl fluid animate-fade is-7" id="admin-campaign-workflows">

  <!-- stats -->
  <app-admin-campaign-stats [config]="statsConfig()"></app-admin-campaign-stats>
  <!-- /stats -->

  <!-- content -->
  <div class="column col-sm-12 col-11 col-mx-auto p-top-30 p-bottom-30">

    <!-- select / import / test workflow -->
    <div
      *ngIf="canAccess(['import']) || canAccess(['test']) || canAccess(['select'])"
      class="p-bottom-10 form-group flex-centered flex-wrap">

      <label
        *ngIf="canAccess(['select'])"
        class="form-label m-bottom-20 m-right-10"
        for="workflows">
        Select the workflow
      </label>

      <select
        *ngIf="canAccess(['select'])"
        class="form-select is-sm mxw-350 m-right-25 m-bottom-20"
        id="workflows"
        [ngModel]="templates ? templates[0] : null"
        (ngModelChange)="onClickSelect($event)"
        [ngModelOptions]="{ standalone: true }">
        <option *ngIf="templates.length === 0" [ngValue]="null">Select</option>
        <option *ngFor="let template of templates" [ngValue]="template">{{ template.name }}</option>
      </select>

      <!-- import button -->
      <button
        (click)="onClickImport()"
        *ngIf="canAccess(['import'])"
        [disabled]="isImporting"
        class="button is-sm is-primary m-right-25 m-bottom-20"
        type="button">
        <ng-container *ngIf="isImporting; else textImport">
          importing the workflow...
        </ng-container>
        <ng-template #textImport>
          Import
        </ng-template>
      </button>
      <!-- /import button -->

      <!-- test button -->
      <button
        (click)="onClickTestWorkflow()"
        *ngIf="availableScenarios && availableScenarios.length && canAccess(['test'])"
        [disabled]="isTesting"
        class="button is-sm is-outlined is-primary m-bottom-20"
        type="button">
        <ng-container *ngIf="isTesting; else textTest">
          testing the workflow...
        </ng-container>
        <ng-template #textTest>
          Test workflow
        </ng-template>
      </button>
      <!-- /test button -->

    </div>
    <!-- /select / import / test workflow -->

    <!-- no campaign -->
    <div *ngIf="!availableScenarios.length && (canAccess(['edit']) || canAccess(['view']))" class="p-top-20">
      <message-template-1 [widthMax]="'354px'">
        Don't have any workflow?
        <br>
        Try to add a one by clicking on "Import" button.
      </message-template-1>
    </div>
    <!-- /no campaign -->

    <!-- campaign -->
    <div *ngIf="availableScenarios.length && (canAccess(['edit']) || canAccess(['view']))">

      <div *ngIf="modifiedScenarios.length === 0" class="text-sm text-alert text-medium">
        You must have at least one workflow with all the modified emails.
      </div>

      <div *ngFor="let scenario of availableScenarios" class="p-top-30">
        <app-admin-edit-workflow
          (defaultScenarioChange)="setDefaultScenario($event)"
          (deletedScenario)="removeScenario($event)"
          (scenarioChange)="updateAvailableScenario($event)"
          [defaultScenario]="campaign.settings && campaign.settings.defaultWorkflow"
          [isDeletable]="canDelete(scenario)"
          [isEditable]="canAccess(['edit'])"
          [scenario]="scenario"
          [signatures]="signatures">
        </app-admin-edit-workflow>
      </div>

    </div>
    <!-- /campaign -->

  </div>
  <!-- /content -->

</div>


<!-- modal to ask for the confirmation if importing the same template -->
<app-utility-modal *ngIf="canAccess(['import'])" [(showModal)]="modalImport" [title]="'Import Board'">

  <section class="modal-body">{{ modalContent | translate }}</section>

  <footer class="modal-footer">
    <button [disabled]="isImporting" class="button modal-cancel" type="button">Cancel</button>
    <button
      (click)="onClickConfirm()"
      [disabled]="isImporting"
      class="button is-primary"
      type="button">
      <ng-container *ngIf="isImporting; else textImport">
        importing the workflow...
      </ng-container>
      <ng-template #textImport>
        Confirm
      </ng-template>
    </button>
  </footer>

</app-utility-modal>
<!-- /modal to ask for the confirmation if importing the same template -->
