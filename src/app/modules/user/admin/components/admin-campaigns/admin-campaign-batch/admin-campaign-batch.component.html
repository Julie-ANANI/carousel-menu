<div id="admin-campaign-batch-component">

  <!-- section stats -->
  <div class="campaign-stats-wrapper">

    <!-- stat col 1 -->
    <div class="stat1">
      <div class="container">
        <h5 class="heading">{{ 'CAMPAIGNS.STATS.HEADING.RECEPTION' | translate }}</h5>
        <div class="content">
          <h4 class="title">{{ 'CAMPAIGNS.STATS.TITLE.GOOD_EMAILS' | translate }}</h4>
          <h3 class="value">{{ getCampaignStat('good_emails') }}</h3>
        </div>
        <div class="content">
          <h4 class="title">{{ 'CAMPAIGNS.STATS.TITLE.RECEIVED' | translate }}</h4>
          <h3 class="value">{{ getCampaignStat('received') }}</h3>
        </div>
        <div class="content">
          <h4 class="title">{{ 'CAMPAIGNS.STATS.TITLE.BOUNCES' | translate }}</h4>
          <h3 class="value">{{ getCampaignStat('bounces') }}</h3>
        </div>
      </div>
    </div>

    <!-- stat col 2 -->
    <div class="stat2">
      <div class="container">
        <h5 class="heading">{{ 'CAMPAIGNS.STATS.HEADING.INTERACTION' | translate }}</h5>
        <div class="content">
          <h4 class="title">{{ 'CAMPAIGNS.STATS.TITLE.OPENED' | translate }}</h4>
          <h3 class="value">{{ getCampaignStat('opened') }}%</h3>
        </div>
        <div class="content">
          <h4 class="title">{{ 'CAMPAIGNS.STATS.TITLE.CLICKED' | translate }}</h4>
          <h3 class="value">{{ getCampaignStat('clicked') }}%</h3>
        </div>
      </div>
    </div>

    <!-- stat col 3 -->
    <div class="stat3">
      <div class="container">
        <h5 class="heading">{{ 'CAMPAIGNS.STATS.HEADING.DISPLAY' | translate }}</h5>
        <div class="content">
          <h4 class="title">{{ 'CAMPAIGNS.STATS.TITLE.EMAIL' | translate }}</h4>
          <h3 class="value">{{ getCampaignStat('email') }}</h3>
        </div>
        <div class="content">
          <h4 class="title">{{ 'CAMPAIGNS.STATS.TITLE.QUESTIONNAIRE' | translate }}</h4>
          <h3 class="value">{{ getCampaignStat('questionnaire') }}</h3>
        </div>
      </div>
    </div>

  </div>

  <div class="column col-xs-12 col-11 col-mx-auto">

    <!--<button (click)="createPro()" class="btn btn-primary">CreerDesPros Alea + Autobatch si actif</button>-->

    <!-- section no batches -->
    <div *ngIf="noResult" class="section-light-container remove-bottom">

      <!-- note -->
      <div *ngIf="!autoBatchStatus" class="text-alert section-light-container remove-top">
        {{ 'CAMPAIGNS.BATCH_PAGE.NOTE' | translate }}
        <span *ngIf="!innovationStatus">{{ 'CAMPAIGNS.BATCH_PAGE.INNOVATION' | translate }}</span>
        <span *ngIf="!defaultWorkflow">{{ 'CAMPAIGNS.BATCH_PAGE.WORKFLOW' | translate }}</span>
        <span *ngIf="!templatesStatus">{{ 'CAMPAIGNS.BATCH_PAGE.EMAILS' | translate }}</span>
        <span *ngIf="!quiz">{{ 'CAMPAIGNS.BATCH_PAGE.QUIZ' | translate }}</span>
      </div>

      <!-- bot -->
      <app-message-space [widthMax]="'354px'">
        {{ 'CAMPAIGNS.BATCH_PAGE.BOT' | translate  }}
        <div class="form-group bot-group">
          <label class="form-switch" for="auto-batch">
            <input type="checkbox" id="auto-batch" [disabled]="!autoBatchStatus" (change)="onFirstAutoBatch($event);" [ngModel]="campaign?.autoBatch">
            <i class="form-icon"></i>
          </label>
        </div>
        <div [ngStyle]="{ 'visibility': autoBatchStatus ? 'visible' : 'visible' }" class="icons icons-meta" (click)="activateSidebar('newBatch')"><i class="fas fa-cog"></i></div>
      </app-message-space>

    </div>

    <!-- section batches -->
    <div *ngIf="!noResult" class="section-light-container remove-bottom">

      <!-- section status -->
      <div class="section-status">
        <div class="form-group">
          <label class="form-switch" for="result-auto-batch">
            <input type="checkbox" id="result-auto-batch" (change)="onSwitchAutoBatch($event)" [ngModel]="campaign?.autoBatch">
            <i class="form-icon"></i>{{ 'CAMPAIGNS.BATCH_PAGE.AUTO_BATCH_LABEL' | translate }}
          </label>
        </div>
        <div class="form-group">
          <label class="form-switch" for="result-nuggets">
            <input type="checkbox" id="result-nuggets" (change)="OnSwitchNuggets($event)"  [ngModel]="campaign?.nuggets">
            <i class="form-icon"></i>{{ 'CAMPAIGNS.BATCH_PAGE.NUGGETS' | translate }}
          </label>
        </div>
      </div>

    </div>

  </div>

</div>


<!-- sidebars -->
<app-sidebar [(template)]="sidebarValue">
  <app-batch-form
    [sidebarState]="sidebarValue.animate_state"
    [type]="sidebarValue.type">
  </app-batch-form>
</app-sidebar>
<!-- /sidebars -->




<!--
<div>
  <div class="emailsStats">
    <div>
      <span class="number">{{ mailsToSend }}
        <span class="badge" data-badge="0"><i class="far fa-envelope"></i></span>
      </span>
      professionnels non contactés
    </div>
    <div>
      <span class="number">{{ firstMail }}
        <span class="badge" data-badge="1"><i class="far fa-envelope"></i></span>
      </span>
      premiers mails envoyés
    </div>
    <div>
      <span class="number">{{ secondMail }}
        <span class="badge" data-badge="2"><i class="far fa-envelope"></i></span>
      </span>
      mails de relance envoyés
    </div>
    <div>
      <span class="number">{{ lastMail }}
        <span class="badge" data-badge="3"><i class="far fa-envelope"></i></span>
      </span>
      derniers mails envoyés
    </div>
  </div>
  <div *ngIf="!stats.batches || !stats.batches.length">
    Pas de batch d'emails programmé pour l'instant...
  </div>
  <p *ngIf="!quizGenerated" class="text-center text-error">
    La quiz n'a pas été généré pour cette innovation, il doit y avoir un quiz avant de faire un envoi d'emails !
  </p>
  <div class="centered-buttons">
    <button (click)="testModal=true" class="btn btn-primary" [disabled] = "!defaultWorkflow">
      Envoyer les mails de test
    </button>
    <button (click)="batchModal=true" class="btn btn-primary" [disabled] = "!readyAutoBatch" >
      Programmer un nouveau batch de mails
    </button>
    <label class="form-switch">
      <input type="checkbox" (change)="AutoBatch()" [ngModel]="campaign.autoBatch" [disabled] = "!readyAutoBatch" >
      <i class="form-icon"></i> Autobatch
    </label>
    <label class="form-switch">
      <input type="checkbox" (change)="setNuggets()" [ngModel]="campaign.nuggets" [disabled] = "!readyAutoBatch" >
      <i class="form-icon"></i>Méthode nuggets
    </label>
    <ul>
      <li *ngIf="!quizGenerated"> Quizz manquant </li>
      <li *ngIf="!innoReady"> Fiche manquante </li>
      <li *ngIf="!defaultWorkflow"> SidebarInterface par défaut manquant</li>
      <li *ngIf="statusAB == '0'"> Vous n'avez pas utilisé le super A/B testing</li>
      <li *ngIf="statusAB == '1'"> Vous ne pouvez pas commencer si A/B testing non validé</li>
    </ul>
    &lt;!&ndash;
    <button (click)="creerpro()" class="btn btn-primary">
      CreerDesPros Alea + Autobatch si actif
    </button>
    &ndash;&gt;
  </div>
  <div class="card" *ngFor="let batch of stats.batches; let batchIndex = index">
    <div class="card-header">
      <div class="card-title h5">
        Batch de {{batch.size}} pros
          <span *ngIf="this.poubelle(batch)">
            <a class="c-hand" role="button" (click)="(removeOK(batch)) && $event.preventDefault()">
              <i class="fas fa-trash"></i>
            </a>
          </span>
          <span *ngIf="batch.nuggets">
            <i class="fas fa-crow"></i>
          </span>
          <span *ngIf="!batch.nuggets && batch.status === 0">
            <a class="c-hand" role="button" (click)="nuggetsBatch = batch">
              <i class="fas fa-plus-circle"></i>
            </a>
          </span>
        <label class="form-switch" style="float:right">
          <input type="checkbox" (change)="freezeStatus(batch)" [ngModel]="batch.active" >
          <i class="form-icon"></i>
        </label>
      </div>
      <div class="card-subtitle text-gray">créé {{ batch.created | date: dateformat }}</div>
      <div class="card-body-batch">
        <app-shared-table
          [data]="this.tableBatch(batchIndex)"
          [config]="config"
          (editRow)="editBatch($event, batch)">
        </app-shared-table>
      </div>
    </div>
  </div>
</div>

&lt;!&ndash; MODAL : Création de batch de mails &ndash;&gt;
<div class="modal" [ngClass]="{'active': batchModal}">
  <div class="modal-overlay" (click)="(batchModal = false) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(batchModal = false) && $event.preventDefault()"></button>
      <div class="modal-title h5">Programmer un nouveau batch de mails</div>
      <p>Le batch doit être programmé dans plus de 7 minutes, ou être envoyé immédiatement</p>
    </div>
    <div class="modal-body">
      <div class="form-group">
        Nombre de pros à contacter :
        <input type="number" [(ngModel)]="newBatch.size"/>
      </div>
      <div class="form-group">
        Jour d'envoi du premier mail :
        <input type="date" [(ngModel)]="dateMail"/>
      </div>
      <div class="form-group">
        Heure d'envoi du premier mail :
        <input type="time" [(ngModel)]="timeMail"/>
      </div>
    </div>
    <div class="modal-footer">
      <button (click)="batchModal = false; createNewBatch(true)" class="btn btn-primary"
              [disabled]="!newBatch.size || (!!dateMail && !!timeMail)">
        Envoyer le batch immédiatement
      </button>
      <button class="btn btn-primary" (click)="batchModal = false; createNewBatch(false)"
              [disabled]="!newBatch.size || !dateMail || !timeMail">Créer</button>
      <button class="btn btn-link" (click)="(batchModal = false) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>

&lt;!&ndash; MODAL : Suppression du batch &ndash;&gt;
<div class="modal" [ngClass]="{'active': selectedBatchToBeDeleted}"  >
  <div class="modal-overlay" (click)="(selectedBatchToBeDeleted = null) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(selectedBatchToBeDeleted = null) && $event.preventDefault()"></button>
      <div class="modal-title h5">Suppression d'un batch</div>
    </div>
    <div class="modal-body">
      <div class="content">Etes-vous bien sûr de vouloir supprimer ce magnifique batch ??</div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-link" (click)="deleteBatch(selectedBatchToBeDeleted._id)">{{ 'COMMON.DELETE' | translate }}</button>
      <button class="btn btn-primary" (click)="(selectedBatchToBeDeleted = null) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>


<div class="modal" [ngClass]="{'active': testModal}">
  <div class="modal-overlay" (click)="(testModal = null) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(testModal = null) && $event.preventDefault()"></button>
      <div class="modal-title h5">Envoi des emails de test</div>
    </div>
    <div class="modal-body email-buttons">
      <button (click)="sendTestEmails(1)" class="btn btn-primary">
        Envoyer le premier mail à Karine
      </button>
      <button (click)="sendTestEmails(2)" class="btn btn-primary">
        Envoyer la première relance à Karine
      </button>
      <button (click)="sendTestEmails(3)" class="btn btn-primary">
        Envoyer la deuxième relance à Karine
      </button>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" (click)="(testModal = null) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>

&lt;!&ndash; MODAL : ajout de nuggets &ndash;&gt;
<div class="modal" [ngClass]="{'active': nuggetsBatch}">
  <div class="modal-overlay" (click)="(nuggetsBatch = null) && $event.preventDefault()"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="(nuggetsBatch = null) && $event.preventDefault()"></button>
      <div class="modal-title h5">Ajout de pros 'nuggets'</div>
    </div>
    <div class="modal-body">
      <p *ngIf="nuggetsBatch">Êtes-vous sûr de vouloir ajouter {{this.Math.round(nuggetsBatch.size / 10)}} pros à 80% dans ce batch ?</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" (click)="addNuggetsToBatch(nuggetsBatch._id)">Ajouter</button>
      <button class="btn btn-link" (click)="(nuggetsBatch = null) && $event.preventDefault()">
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>
</div>

  <app-sidebar
    [template]="templateSidebar" (closeSidebar)="closeSidebar($event)">
    <app-batch-form
      [rowBatch]="currentRow"
      [content]="content"
      (batchChange)="onSubmitEditBatch($event)"
    >
    </app-batch-form>
  </app-sidebar>

-->
