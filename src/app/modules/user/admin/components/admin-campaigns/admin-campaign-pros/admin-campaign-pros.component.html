<div class="m-bottom-2">
  <app-admin-stats-banner [updateBtn]="true" (updateStats)="loadStats()"
    [config]="prosStatsConfig"></app-admin-stats-banner>
</div>

<div class="container grid-2xl fluid p-top-30 p-bottom-30" id="admin-campaign-pros">
  <div class="column col-sm-12 col-11 col-mx-auto">

    <!-- buttons -->
    <section
      *ngIf="canAccess(['import']) || canAccess(['export']) || canAccess(['updateConfidence']) || canAccess(['user', 'add'])"
      class="text-right p-bottom-10 flex-wrap-wrap animate-fade is-7">

      <!-- add -->
      <button
        (click)="onClickAdd()"
        *ngIf="canAccess(['user', 'add'])"
        [disabled]="isCreating"
        [ngClass]="{'m-right-20': canAccess(['import']) || canAccess(['export']) || canAccess(['updateConfidence'])}"
        class="button is-primary is-outlined is-sm m-bottom-20"
        type="button">
        <ng-container *ngIf="isCreating; else textAdd">
          adding the professional...
        </ng-container>
        <ng-template #textAdd>
          Add
        </ng-template>
      </button>
      <!-- /add -->

      <!-- import -->
      <button
        (click)="onClickImport()"
        *ngIf="canAccess(['import'])"
        [disabled]="isImporting"
        [ngClass]="{'m-right-20': canAccess(['export']) || canAccess(['updateConfidence'])}"
        class="button is-primary is-outlined is-sm m-bottom-20"
        type="button">
        <ng-container *ngIf="isImporting; else textImport">
          importing the professionals...
        </ng-container>
        <ng-template #textImport>
          Import
        </ng-template>
      </button>
      <!-- /import -->

      <!-- update email confidence -->
      <button
        *ngIf="canAccess(['updateConfidence'])"
        (click)="onClickUpdate()"
        [ngClass]="{'m-right-20': canAccess(['export'])}"
        class="button is-primary is-outlined is-sm m-bottom-20"
        type="button">
        Update Email Confidence
      </button>
      <!-- /update email confidence -->

      <!-- export -->
      <button
        (click)="onClickExport()"
        *ngIf="canAccess(['export'])"
        [disabled]="isExporting"
        class="button is-primary is-sm m-bottom-20"
        type="button">
        <ng-container *ngIf="isExporting; else textExport">
          exporting the professionals...
        </ng-container>
        <ng-template #textExport>
          Export
        </ng-template>
      </button>
      <!-- /export -->

    </section>
    <!-- /buttons -->

    <!-- professionals -->
    <section class="p-top-20">
      <app-shared-professionals-list
        (selectedProfessionalChange)="selectedProsEvent($event)"
        [(config)]="config"
        [accessPath]="accessPath"
        [campaign]="campaign"
        [total]="total"
        [tableSelector]="'admin-campaign-pros-limit'"
        [professionals]="professionals">
      </app-shared-professionals-list>
    </section>
    <!-- /professionals -->
  </div>
</div>


<!-- sidebar -->
<umius-sidebar-full *ngIf="canAccess(['user', 'add'])" [(template)]="sidebarValue">
  <app-user-form
    (finalProfessionalData)="onClickSave($event)"
    [isEditable]="true"
    [sidebarState]="sidebarValue.animate_state"
    [type]="sidebarValue.type">
  </app-user-form>
</umius-sidebar-full>
<!-- /sidebar -->


<!-- modal to export -->
<umius-modal *ngIf="canAccess(['export'])" [(showModal)]="modalExport" [title]="'Export Board'">

  <section class="modal-body">

    <div class="text-center p-top-25">
      <div class="form-group">
        <label class="form-label" for="exportConfidence">Indice de confiance minimum</label>
        <input
          [(ngModel)]="exportConfidence"
          class="form-input"
          id="exportConfidence"
          type="number"
          placeholder="80">
      </div>
      <div class="form-group">
        <label class="form-label" for="exportCountries">Pays (codes ISO séparés par des virgules)</label>
        <input
          [(ngModel)]="exportCountries"
          class="form-input"
          id="exportCountries"
          type="text"
          placeholder="FR,US,IN">
      </div>
    </div>

  </section>

  <footer class="modal-footer">
    <button class="button modal-cancel" type="button">Cancel</button>
    <button
      (click)="onConfirmExport()"
      class="button is-primary"
      type="button">
      Confirm
    </button>
  </footer>

</umius-modal>
<!-- /modal to export -->


<!-- modal to import -->
<umius-modal *ngIf="canAccess(['import'])" [(showModal)]="modalImport" [title]="'Import Board'">

  <section class="modal-body">

    <label class="form-label">Import professionals from campaign (only one campaign at a time)</label>

    <app-utility-auto-complete-input
      (update)="updateCampaign($event)"
      [onlyOne]="true"
      [config]="{ placeholder: 'Enter the campaign name', initialData: originCampaign, type: 'campaign' }">
    </app-utility-auto-complete-input>

    <div data-content="or" class="divider mxw-250 m-left-auto m-right-auto m-top-40"></div>

    <div class="text-center p-top-25">
      <label [ngClass]="{'disabled': isImporting}" class="button is-sm is-primary is-outlined">
        <input #fileupload type="file" [hidden]="true" (change)="onClickImportCsv(fileupload.files[0])"/>
        <ng-container *ngIf="isImporting; else importCSV">
          importing the csv...
        </ng-container>
        <ng-template #importCSV>
          Import file
        </ng-template>
      </label>

      <p class="text-center text-sm m-top-10">The file must use these <b>exact names</b> for the columns:
        <b>First Name UMI, Last Name UMI, Company UMI, Country UMI&#42;, Language&#42;&#42;</b>, Email UMI, emailConfidence, Linkedin,
        Company Site, Job UMI</p>

      <p class="text-center text-sm">Bold columns are mandatory, other columns are optional. The order of the columns does
        not matter</p>
      <p class="text-center text-sm">&#42;Can be a country name in French, Italian, English, Spanish or German.</p>
      <p class="text-center text-sm">&#42;&#42;You must choose among following: Arabic, Chinese, Danish, Dutch, English, Finnish, French, German, Italian, Japanese, Korean, Modern Greek, Norwegian, Polish, Portuguese, Russian, Spanish, Swedish, Turkish, Ukrainian. (not case sensitive).</p>

    </div>

  </section>

  <footer class="modal-footer">
    <div [hidden]="!csvImportError">
      <div class="w-full d-flex align-center m-top-20">
        <span class="text-error text-15 text-bold">Import errors</span>
      </div>
      <ng-container *ngIf="slicedErrors.length;else string_error_message">
        <div class="flex-d-column d-flex errors-box">
          <span class="text-error text-sm"> {{ slicedErrors.length }} error(s) </span>
          <ul>
            <app-shared-csv-error *ngFor="let err of slicedErrors" [error]="err" [htmlTag]="'li'"></app-shared-csv-error>
          </ul>
        </div>
      </ng-container>

      <ng-template #string_error_message>
        <div class="text-center p-top-25 error-msg">
        Error: {{csvImportError}}
        </div>
      </ng-template>
    </div>

    <div [hidden]="!!csvImportError">
      <button [disabled]="isImporting" class="button modal-cancel" type="button">Cancel</button>
      <button
        (click)="onClickConfirm()"
        [disabled]="!originCampaign.length || isImporting"
        class="button is-primary"
        type="button">
        <ng-container *ngIf="isImporting; else textImport">
          importing the professionals...
        </ng-container>
        <ng-template #textImport>
          Confirm
        </ng-template>
      </button>
    </div>
  </footer>

</umius-modal>
<!-- /modal to import -->


<!-- modal to update email confidence -->
<umius-modal *ngIf="canAccess(['updateConfidence'])" [(showModal)]="modalUpdate" [title]="'Update Email Confidence'">

  <section class="modal-body">

    <label class="form-label">Update the email confidence of many pros</label>

    <div class="text-center p-top-25">
      <label [ngClass]="{'disabled': isImporting}" class="button is-sm is-primary is-outlined">
        <input #fileupload2 type="file" [hidden]="true" (change)="onClickUpdateConfidence(fileupload2.files[0])"/>
        <ng-container *ngIf="isImporting; else importCSV">
          importing the csv...
        </ng-container>
        <ng-template #importCSV>
          Import file
        </ng-template>
      </label>

      <p *ngIf="!updatePreview || !updatePreview.total" class="text-center text-sm m-top-10">The file must use these <b>exact names</b> for the columns:
        <b>email, emailConfidence</b>. Both columns are mandatory. The order of the columns does not matter.
      </p>
      <p *ngIf="updatePreview && updatePreview.total" class="text-center text-sm m-top-10">
        These pros will be updated:
        <ul>
          <li *ngFor="let item of updatePreview | keyvalue">
            {{ item.key }}: {{ item.value }} pros
          </li>
        </ul>
    </div>

  </section>

  <footer class="modal-footer">
    <div [hidden]="!csvImportError" class="text-center p-top-25 error-msg">Error: {{csvImportError}}</div>

    <div [hidden]="!!csvImportError">
      <button [disabled]="isImporting" class="button modal-cancel" type="button" (click)="onClickCancelConfidence()">Cancel</button>
      <button
        (click)="onClickConfirmConfidence()"
        [disabled]="isImporting || !updatePreview || !updatePreview.total"
        class="button is-primary"
        type="button">
        <ng-container *ngIf="isImporting; else textImport">
          importing the file...
        </ng-container>
        <ng-template #textImport>
          Confirm
        </ng-template>
      </button>
    </div>
  </footer>

</umius-modal>
<!-- /modal to import -->






