<div class="section-light-pad" id="admin-followed">

  <h6>Setup</h6>

  <div class="project-preparation">
    <div class="project-section">

      <!-- Project operator -->
      <div class="project-line" [ngClass]="{disabled: authService.adminLevel < 3}">

        <label class="form-switch" for="seeDomain">
          <input
            type="checkbox"
            name="seeDomain"
            id="seeDomain"
            checked>
          <i class="form-icon"></i>
          {{ 'COMMON.DOMAIN' | translate}}
        </label>

        <select class="form-select"
                name="setDomain"
                id="setDomain"
                [ngModel]="project && project.domain ? project.domain : ''"
                (ngModelChange)="changeProjectDomain($event)"
                [ngModelOptions]="{standalone: true}">
          <option *ngFor="let d of projectDomains" [ngValue]="d.name">{{d.name}}</option>
        </select>
        <div>
        </div>
      </div>

      <!-- Project operator -->
      <div class="project-line" [ngClass]="{disabled: authService.adminLevel < 3}">

        <label class="form-switch" for="seeOperator">
          <input
            type="checkbox"
            name="seeOperator"
            id="seeOperator"
            [checked]="project.operator !== undefined">
          <i class="form-icon"></i>
          Operator
        </label>

        <select class="form-select"
                name="setOperator"
                id="setOperator"
                [ngModel]="operatorId"
                (ngModelChange)="changeProjectOperator($event)"
                [ngModelOptions]="{standalone: true}">
          <option [ngValue]="undefined" selected>{{'COMMON.NO' | translate}}</option>
          <option *ngFor="let op of operators" [ngValue]="op['_id']">
            {{op.firstName + ' ' + op.lastName}}
          </option>
        </select>
        <div></div>
      </div>

      <!-- Project owner -->
      <div class="project-line"> <!-- [ngClass]="{disabled: authService.userId !== operatorId}" -->
        <label class="form-switch" for="editOwner">
          <input
            type="checkbox"
            name="editOwner"
            id="editOwner"
            checked>
          <i class="form-icon"></i>
          {{ 'COMMON.PROJECT.OWNER' | translate }}
        </label>
        <label *ngIf="!edit.owner" class="form-label">{{project.owner.name}}</label>

        <!-- if we click on update we show an autoComplete of all users -->
        <div [formGroup]="formData" class="form-group" style="position: relative" *ngIf="edit.owner">
          <input
            class="form-input"
            formControlName="owner"
            id="user"
            type="text"
            [attr.placeholder]="'USERS.SEARCH' | translate"
            (click)="onSuggestUsers()">
          <ul
            *ngIf="formData.get('owner').value"
            class="input-suggestion"
            [ngStyle]="{ 'display': displayUserSuggestion ? 'flex' : 'none', 'width': '220px' }">
            <li *ngFor="let suggestion of usersSuggestion" (click)="onValueSelect(suggestion)">
              <a><span>{{ suggestion.name }}</span></a>
            </li>
          </ul>
          <div class="form-error" *ngIf="formData.get('owner').touched && formData.get('owner').invalid">
            <span *ngIf="formData.get('owner').hasError('required')">{{ 'COMMON.REQUIRED.COUNTRY' | translate }}</span>
          </div>
        </div>

        <button class="btn btn-xs ghost-edit"
                [ngClass]="{'showOnHover': !edit.owner}"
                (click)="edit.owner ? ownerEditionFinished() : edit.owner = true">
          {{(edit.owner ? 'COMMON.SAVE' : 'COMMON.CHANGE') | translate}}
        </button>

      </div>

      <!-- Mission -->
      <div class="project-line">
        <label class="form-switch" for="editMission">
          <input
            type="checkbox"
            name="editMission"
            id="editMission"
            [checked]="!!project.mission"
            disabled>
          <i class="form-icon"></i>
          {{ 'COMMON.PROJECT.MISSION' | translate }}
        </label>
        <label *ngIf="!edit.mission" class="form-label">{{project.mission?.name}}</label>

        <!-- if we click on update we show an autoComplete of all users -->
        <div class="form-group" [formGroup]="formData" *ngIf="edit.mission">
          <label class="form-label" for="project-mission"></label>
          <input
            auto-complete
            class="form-input"
            formControlName="mission"
            id="project-mission"
            type="text"
            [min-chars]="2"
            [list-formatter]="autocompleteMissionListFormatter"
            [source]="missionsSuggestions"
            [accept-user-input]="false"
            (valueChanged)="selectMission($event)"
            [attr.placeholder]="'COMMON.PROJECT.MISSION' | translate">
        </div>

        <button class="btn btn-xs ghost-edit"
                [ngClass]="{'showOnHover': !edit.mission}"
                (click)="edit.mission = !edit.mission">
          {{(edit.mission ? 'COMMON.BUTTON.CANCEL' : 'COMMON.CHANGE') | translate}}
        </button>

      </div>

      <!-- Roadmap -->
      <div class="project-line">
        <label class="form-switch" for="editRoadmap">
          <input
            type="checkbox"
            name="editRoadmap"
            id="editRoadmap"
            [checked]="mission && mission.type">
          <i class="form-icon"></i>
          Roadmap
        </label>

        <button class="showOnHover btn btn-xs ghost-edit" (click)="editRoadmap()" [disabled]="!mission">
          {{'COMMON.EDIT' | translate}}
        </button>
      </div>

      <!--/ Roadmap -->

      <!-- mission type -->
      <div *ngIf="project.mission" class="project-line">

        <label class="form-switch" for="editMissionType">
          <input
            type="checkbox"
            name="editMissionType"
            id="editMissionType"
            [checked]="mission.type">
          <i class="form-icon"></i>
          Market test type
        </label>

        <select
          class="form-select"
          name="setMissionType"
          id="setMissionType"
          [ngModel]="mission.type"
          (ngModelChange)="changeMissionType($event)"
          [ngModelOptions]="{standalone: true}">
          <option [ngValue]="''" selected>Not assigned</option>
          <option *ngFor="let type of missionType" [ngValue]="type">{{ type | titlecase }}</option>
        </select>

        <div></div>

      </div>
      <!-- /mission type -->

      <!-- mission objective -->
      <div *ngIf="project.mission" class="project-line">

        <label class="form-switch" for="editMissionObjective">
          <input
            type="checkbox"
            name="editMissionObjective"
            id="editMissionObjective"
            [checked]="mission.objective && mission.objective.principal[currentLang]">
          <i class="form-icon"></i>
          Main objective
        </label>

        <select
          class="form-select"
          name="setMissionObjective"
          id="setMissionObjective"
          [ngModel]="mission.objective.principal[currentLang]"
          (ngModelChange)="changeMissionObjective($event)"
          [ngModelOptions]="{standalone: true}">
          <option [ngValue]="''" selected>Not assigned</option>
          <option *ngFor="let objective of missionObjectives" [ngValue]="objective[currentLang].label">
            {{ objective[currentLang].label }}
          </option>
        </select>

        <div></div>

      </div>
      <!-- /mission objective -->

      <!-- commercial -->
      <div *ngIf="project.clientProject" class="project-line">

        <label class="form-switch" for="editCommercial">
          <input
            type="checkbox"
            name="editCommercial"
            id="editCommercial"
            [checked]="clientProject.commercial">
          <i class="form-icon"></i>
          Commercial
        </label>

        <select
          class="form-select"
          name="setCommercial"
          id="setCommercial"
          [ngModel]="clientProject.commercial && clientProject.commercial.id"
          (ngModelChange)="changeCommercial($event)"
          [ngModelOptions]="{standalone: true}">
          <option [ngValue]="undefined" selected>Not assigned</option>
          <option *ngFor="let commercial of commercials | async" [ngValue]="commercial['_id']">
            {{ commercial.firstName }} {{ commercial.lastName }}
          </option>
        </select>

        <div></div>

      </div>
      <!-- /commercial -->

      <!-- Project description edition -->
      <div class="project-line">
        <label class="form-switch" for="editProjectDescription">
          <input
            type="checkbox"
            name="editProjectDescription"
            id="editProjectDescription"
            [checked]="getMetadata('preparation', 'description')"
            (change)="setMetadata('preparation', 'description', $event)">
          <i class="form-icon"></i>
          {{ 'PROJECT.PREPARATION.EDIT_DESCRIPTION' | translate }}
        </label>

        <button class="showOnHover btn btn-xs ghost-edit" (click)="editProjectDescription()">
          {{'COMMON.EDIT' | translate}}
        </button>

      </div>

      <!-- Project translation -->
      <div class="project-line">
        <label class="form-switch" for="seeTranslation">
          <input
            type="checkbox"
            name="seeTranslation"
            id="seeTranslation"
            [checked]="getMetadata('preparation', 'translations')"
            (change)="setMetadata('preparation', 'translations', $event)">
          <i class="form-icon"></i>
          {{ 'PROJECT.PREPARATION.DESCRIPTION_TRANSLATION' | translate }}
        </label>
        <div *ngFor="let lang of innovCards">
          <label class="form-label">
            {{lang?.lang == 'fr' ? ('COMMON.LANG.FR' | translate) : ('COMMON.LANG.EN' | translate) }}
            <span>{{lang?.completion?.toFixed(0)}} %</span>
          </label>
        </div>
        <div></div>
      </div>

      <!-- Project targeting edition -->
      <div class="project-line">
        <label class="form-switch" for="editMarketTargeting">
          <input
            type="checkbox"
            name="editMarketTargeting"
            id="editMarketTargeting"
            [checked]="getMetadata('preparation', 'target')"
            (change)="setMetadata('preparation', 'target', $event)">
          <i class="form-icon"></i>
          {{ 'PROJECT.PREPARATION.EDIT_MARKET_TARGETING' | translate }}
        </label>

        <button class="showOnHover btn btn-xs ghost-edit" (click)="editProjectTargeting()">
          {{'COMMON.EDIT' | translate}}
        </button>

      </div>

      <!-- add emails / domains to blacklist -->
      <div class="project-line">
        <label class="form-switch" for="blacklistDomainsAndEmails">
          <input
            type="checkbox"
            name="blacklistDomainsAndEmails"
            id="blacklistDomainsAndEmails"
            [checked]="getMetadata('preparation', 'blacklist')"
            (change)="setMetadata('preparation', 'blacklist', $event)">
          <i class="form-icon"></i>
          {{ 'PROJECT.PREPARATION.BLACKLIST_DOMAINS_EMAILS' | translate }}
        </label>

        <label class="form-label">
          {{project.settings.blacklist.domains.length.toString()}} {{'COMMON.DOMAIN' | translate}}(s) -
          {{project.settings.blacklist.emails.length.toString()}} Email(s)
        </label>

        <button class="showOnHover btn btn-xs ghost-edit" (click)="editBlacklist()">
          {{'COMMON.EDIT' | translate}}
        </button>

      </div>

      <!-- update status -->
      <div class="project-line">
        <label class="form-switch" for="updateStatus">
          <input
            type="checkbox"
            name="updateStatus"
            id="updateStatus"
            [checked]="getMetadata('preparation', 'statusupdate')"
            (change)="setMetadata('preparation', 'statusupdate', $event)">
          <i class="form-icon"></i>
          {{ 'PROJECT.PREPARATION.UPDATE_STATUS' | translate }}
        </label>

        <label class="form-label">
          {{ formatText(project?.status) }} - {{project?.updated | date:dateFormat}}
        </label>

        <button class="showOnHover btn btn-xs ghost-edit"
                (click)="editStatus()"
                [ngStyle]="{'visibility' : project.status === 'DONE' ? 'hidden' : ''}">
          {{'COMMON.EDIT' | translate}}
        </button>

      </div>

    </div>


    <div class="project-summary">

      <div class="completion">
        <h6>{{'PROJECT.STATS.COMPLETION' | translate}}</h6>
        <span *ngFor="let innov of project.innovationCards" class="text-center">
          <label class="form-label">{{innov?.lang == 'fr' ? ('COMMON.LANG.FR' | translate) : ('COMMON.LANG.EN' | translate) }}</label>
          <label>{{innov?.completion?.toFixed(0) || 0}} %</label>
        </span>
      </div>
      <div class="emails">
        <h6>Emails</h6>
        <span class="text-center">
          <label class="form-label">{{'PROJECT.STATS.TO_SEND' | translate}}</label>
          <label>{{project?.stats?.emailsOK || '?'}}</label>
        </span>
        <span class="text-center">
          <label class="form-label">{{'PROJECT.STATS.DELIVERED' | translate}}</label>
          <label>{{project?.stats?.received || '?'}}</label>
        </span>
        <span class="text-center">
          <label class="form-label">{{'PROJECT.STATS.OPEN_RATE' | translate}}</label>
          <label>{{getRate(project?.stats?.opened, project?.stats?.received)}}</label>
        </span>
        <span class="text-center">
          <label class="form-label">{{'PROJECT.STATS.CLICK_RATE' | translate}}</label>
          <label>{{getRate(project?.stats?.clicked, project?.stats?.opened)}}</label>
        </span>
      </div>
      <div class="answers">
        <h6>{{'PROJECT.STATS.ANSWERS' | translate}}</h6>
        <span class="text-center">
          <label class="form-label">{{'PROJECT.STATS.QUESTIONNAIRE_QUALITY' | translate}}</label>
          <label>{{getRate(project?.stats?.answers, project?.stats?.clicked)}}</label>
        </span>
        <span class="text-center">
          <label class="form-label">{{'CAMPAIGNS.VALIDATED' | translate}}</label>
          <label>{{project?.stats?.validatedAnswers || '?'}}</label>
        </span>
        <span class="text-center">
          <label class="form-label">{{'PROJECT.STATS.ANSWER_RATE' | translate}}</label>
          <label>{{getRate(project?.stats?.validatedAnswers, project?.stats?.received)}}</label>
        </span>
      </div>
      <div class="update">
        <span *ngIf="project.updatedStats">
          {{'PROJECT.STATS.UPDATED' | translate}} : {{ project.updatedStats | date }}
        </span>
        <a (click)="updateStats()">
          {{'PROJECT.STATS.UPDATE' | translate}}
        </a>
      </div>

      <div class="p-top-25 p-no-left">

        <button
          *ngIf="project && project.status === 'SUBMITTED'"
          (click)="onValidateProject($event)"
          class="button is-primary is-sm m-right-20 m-bottom-15"
          id="btn-validate-project">
          Validate project
        </button>

        <button
          *ngIf="project && project.status === 'SUBMITTED'"
          (click)="onRevisionProject($event)"
          class="button is-danger is-sm m-bottom-15"
          id="btn-revision-project">
          Ask for project revision
        </button>

      </div>

    </div>

  </div>

  <h6>Campaigns</h6>

  <div class="project-campaigns">
    <div class="project-section">

      <!-- Project tags -->
      <div class="project-line">

        <label class="form-switch" for="seeProjectTags">
          <input
            type="checkbox"
            name="seeProjectTags"
            id="seeProjectTags"
            [checked]="project.tags.length > 0">
          <i class="form-icon"></i>
          {{'PROJECT.PROJECT_TAGS' | translate}}
        </label>
        <label class="form-label">{{project.tags.length}} tags</label>
        <button class="showOnHover btn btn-xs ghost-edit" (click)="editProjectTags()">
          {{'COMMON.EDIT' | translate}}
        </button>
      </div>

      <!-- Answer tags-->
      <div class="project-line">

        <label class="form-switch" for="seeAnswerTags">
          <input
            type="checkbox"
            name="seeAnswerTags"
            id="seeAnswerTags"
            [checked]="getMetadata('campaign', 'tags')"
            (change)="setMetadata('campaign', 'tags', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.CAMPAIGN.EDIT_ANSWER_TAGS' | translate}}
        </label>
        <label class="form-label">{{answerTags}} tags</label>
        <button class="showOnHover btn btn-xs ghost-edit" (click)="goToAnswerTagsEdition()">
          {{'COMMON.EDIT' | translate}}
        </button>
      </div>

      <!-- Answer anonymization-->
      <div class="project-line">

        <label class="form-switch" for="anonymizeAnswers">
          <input
              type="checkbox"
              name="anonymizeAnswers"
              id="anonymizeAnswers"
              [checked]="getMetadata('campaign', 'anonymous_answers')"
              (change)="setMetadata('campaign', 'anonymous_answers', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.CAMPAIGN.ANONYMIZE_ANSWER' | translate}}
        </label>
        <label class="form-label">This will affect all the campaigns!</label>
      </div>

      <!-- If no campaigns is created, we show an info bot to ask us to create a campaign -->
      <div *ngIf="currentCampaign === null">
        <div class="bot-wrapper text-center">
          <span class="bot-rect">{{'PROJECT.CAMPAIGN.CREATE_CAMPAIGN' | translate}}</span>
          <br>
          <img src="https://res.cloudinary.com/umi/image/upload/v1528795403/app/default-images/bot-triangle.svg"
               class="bot-trian">
          <div><img src="https://res.cloudinary.com/umi/image/upload/v1533567512/app/default-images/info-bot.svg"
                    alt="Bot" class="bot-image"></div>
        </div>
      </div>

      <!-- Else, we show the other informations -->
      <div *ngIf="currentCampaign !== null">

        <!-- Campaign professionnals -->
        <div class="project-line" [ngClass]="{disabled: answerTags === 0}">

          <label class="form-switch" for="seeProfessionnals">
            <input
              type="checkbox"
              name="seeProfessionnals"
              id="seeProfessionnals"
              [checked]="getMetadata('campaign', 'pros')"
              (change)="setMetadata('campaign', 'pros', $event)">
            <i class="form-icon"></i>
            {{'PROJECT.CAMPAIGN.FIND_PROFESSIONALS' | translate}}
          </label>
          <label class="form-label">{{currentCampaign?.stats?.campaign.nbProfessionals}} {{'COMMON.PROFESSIONALS' |
            translate}}</label>
          <button class="showOnHover btn btn-xs ghost-edit"
                  (click)="goToProfessionalsList()">
            {{'COMMON.MORE' | translate}}
          </button>
        </div>

        <!-- AB Testing -->
        <!-- TODO
        Ask Adrien about this task
        -->
        <div class="project-line" [ngClass]="{disabled: currentCampaign?.stats?.campaign.nbProfessionals === 0}">

          <label class="form-switch" for="activateABTesting">
            <input
              type="checkbox"
              name="activateABTesting"
              id="activateABTesting"
              [checked]="getMetadata('campaign', 'abtesting')"
              (change)="setMetadata('campaign', 'abtesting', $event)">
            <i class="form-icon"></i>
            {{'PROJECT.CAMPAIGN.ACTIVATE_AB_TESTING' | translate}}
          </label>
          <button class="showOnHover btn btn-xs ghost-edit"
                  (click)="goToTemplates()">
            {{'COMMON.MORE' | translate}}
          </button>
        </div>

        <!-- Mails edition -->
        <div class="project-line">

          <label class="form-switch" for="editWorkflowMails">
            <input
              type="checkbox"
              name="editWorkflowMails"
              id="editWorkflowMails"
              [checked]="getMetadata('campaign', 'workflow')"
              (change)="setMetadata('campaign', 'workflow', $event)">
            <i class="form-icon"></i>
            {{'PROJECT.CAMPAIGN.EDIT_WORKFLOW' | translate}}
          </label>
          <button class="showOnHover btn btn-xs ghost-edit"
                  (click)="goToTemplates()">
            {{'COMMON.MORE' | translate}}
          </button>
        </div>

        <!-- Choose default Workflow -->
        <div class="project-line" [ngClass]="{disabled: modifiedScenarios.length === 0}">

          <label class="form-switch" for="seeWorkflows">
            <input
              type="checkbox"
              name="seeWorkflows"
              id="seeWorkflows"
              [checked]="currentCampaign?.settings?.defaultWorkflow !== '' && currentCampaign?.settings?.defaultWorkflow !== undefined">
            <i class="form-icon"></i>
            {{'PROJECT.CAMPAIGN.CHOOSE_DEFAULT_WORKFLOW' | translate}}
          </label>

          <select class="form-select"
                  name="setWorkflow"
                  id="setWorkflow"
                  [ngModel]="currentCampaign.settings.defaultWorkflow || ''"
                  (ngModelChange)="updateDefaultWorkflow($event)"
                  [ngModelOptions]="{standalone: true}">
            <option [ngValue]="''" selected>{{'COMMON.NO' | translate}}</option>
            <option *ngFor="let w of modifiedScenarios" [ngValue]="w.name">
              {{w.name}}
            </option>
          </select>
          <div></div>
        </div>

        <!-- Launch Auto Batch -->
        <div class="project-line" [ngClass]="{disabled: modifiedScenarios.length === 0}">

          <label class="form-switch" for="lauchAutoBatch">
            <input
              type="checkbox"
              name="lauchAutoBatch"
              id="lauchAutoBatch"
              [checked]="getMetadata('campaign', 'autobatch')"
              (change)="setMetadata('campaign', 'autobatch', $event)">
            <i class="form-icon"></i>
            {{'PROJECT.CAMPAIGN.LAUNCH_AUTO_BATCH' | translate}}
          </label>
          <button class="showOnHover btn btn-xs ghost-edit"
                  (click)="goToAutoBatch()">
            {{'COMMON.MORE' | translate}}
          </button>
        </div>

        <!-- Validate insights -->
        <div class="project-line">

          <label class="form-switch" for="validateInsights">
            <input
              type="checkbox"
              name="validateInsights"
              id="validateInsights"
              [checked]="getMetadata('campaign', 'insights')"
              (change)="setMetadata('campaign', 'insights', $event)">
            <i class="form-icon"></i>
            {{'PROJECT.CAMPAIGN.VALIDATE_INSIGHTS' | translate}}
          </label>
          <label class="label is-danger">{{currentCampaign?.stats?.campaign.nbToValidateResp}}
            {{'PROJECT.CAMPAIGN.INSIGHTS_TO_VALIDATE' | translate}}</label>
          <button class="showOnHover btn btn-xs ghost-edit"
                  (click)="goToInsights()">
            {{'COMMON.MORE' | translate}}
          </button>
        </div>

      </div>

    </div>

    <div class="tags">
      <label class="form-label">{{'PROJECT.PROJECT_TAGS' | translate}}</label>
      <app-shared-tag [tags]="project.tags">
      </app-shared-tag>
    </div>
  </div>

  <!-- Delivery part -->

  <h6>Delivery</h6>

  <div class="project-delivery">

    <!-- Delivery section -->
    <div class="project-section">

      <!-- Public project -->
      <div class="project-line">

        <label class="form-switch" for="publicProject">
          <input
            type="checkbox"
            name="publicProject"
            id="publicProject"
            [checked]="project.isPublic === true"
            (change)="changeExternalDiffusion()">
          <i class="form-icon"></i>
          {{'PROJECT.DELIVERY.PUBLIC' | translate}}
        </label>

        <label class="label is-danger">{{publishedNote()}}</label>
        <button class="btn btn-xs ghost-edit"
                [ngClass]="{disabled: !project.isPublic || hasBeenPublished()}"
                (click)="publish()">
          Publish
        </button>
      </div>

      <!-- Update answer tags -->
      <div class="project-line" [ngClass]="{disabled: answerTags === 0}">

        <label class="form-switch" for="updateTags">
          <input
            type="checkbox"
            name="updateTags"
            id="updateTags"
            [checked]="getMetadata('delivery', 'answertags')"
            (change)="setMetadata('delivery', 'answertags', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.DELIVERY.UPDATE_ANSWER_TAGS' | translate}}
        </label>
        <label class="form-label">{{answerTags}} tags</label>
        <button class="showOnHover btn btn-xs ghost-edit" (click)="goToAnswerTagsEdition()">
          {{'COMMON.UPDATE' | translate}}
        </button>
      </div>

      <!-- Write conclusion -->
      <div class="project-line">

        <label class="form-switch" for="writeConclusions">
          <input
            type="checkbox"
            name="writeConclusions"
            id="writeConclusions"
            [checked]="getMetadata('delivery', 'conclusions')"
            (change)="setMetadata('delivery', 'conclusions', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.DELIVERY.WRITE_CONCLUSIONS' | translate}}
        </label>
        <button class="showOnHover btn btn-xs ghost-edit" (click)="goToSynthesis()">
          {{'COMMON.MORE' | translate}}
        </button>
      </div>

      <!-- Send Ending mail -->
      <div class="project-line">

        <label class="form-switch" for="writeEndingMail">
          <input
            type="checkbox"
            name="writeEndingMail"
            id="writeEndingMail"
            [checked]="getMetadata('delivery', 'endingmail')"
            (change)="setMetadata('delivery', 'endingmail', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.DELIVERY.WRITE_ENDING_MAIL' | translate}}
        </label>
        <button class="showOnHover btn btn-xs ghost-edit" (click)="editEndingMail()"
                *ngIf="getMetadata('delivery', 'endingmail') === false">
          {{'COMMON.EDIT' | translate}}
        </button>
      </div>

      <!-- Restitution -->
      <div class="project-line">

        <label class="form-switch" for="projectRestitution">
          <input
            type="checkbox"
            name="projectRestitution"
            id="projectRestitution"
            [checked]="getMetadata('delivery', 'restitution')"
            (change)="setMetadata('delivery', 'restitution', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.DELIVERY.RESTITUTION' | translate}}
        </label>
      </div>

      <!-- Client satisfaction -->
      <div class="project-line">

        <label class="form-switch" for="editClientSatisfaction">
          <input
            type="checkbox"
            name="editClientSatisfaction"
            id="editClientSatisfaction"
            [checked]="getMetadata('delivery', 'clientsatisfaction')"
            (change)="setMetadata('delivery', 'clientsatisfaction', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.DELIVERY.CLIENT_SATISFACTION' | translate}}
        </label>
        <div [ngSwitch]="project.clientSatisfaction?.satisfaction"
             class="satisfaction">
          <div *ngSwitchDefault></div>
          <div *ngSwitchCase="'VERY_HAPPY'" class="happy">
            <i class="far fa-2x fa-grin-hearts"></i>
            <label>{{'PROJECT.DELIVERY.SATISFACTIONS.VERY_HAPPY' | translate}}</label>
          </div>
          <div *ngSwitchCase="'HAPPY'" class="happy">
            <i class="far fa-2x fa-smile"></i>
            <label>{{'PROJECT.DELIVERY.SATISFACTIONS.HAPPY' | translate}}</label>
          </div>
          <div *ngSwitchCase="'NORMAL'" class="normal">
            <i class="far fa-2x fa-meh"></i>
            <label>{{'PROJECT.DELIVERY.SATISFACTIONS.NORMAL' | translate}}</label>
          </div>
          <div *ngSwitchCase="'BAD'" class="bad">
            <i class="far fa-2x fa-frown"></i>
            <label>{{'PROJECT.DELIVERY.SATISFACTIONS.BAD' | translate}}</label>
          </div>
          <div *ngSwitchCase="'VERY_BAD'" class="bad">
            <i class="far fa-2x fa-angry"></i>
            <label>{{'PROJECT.DELIVERY.SATISFACTIONS.VERY_BAD' | translate}}</label>
          </div>
        </div>
        <button class="showOnHover btn btn-xs ghost-edit" (click)="editClientSatisfaction()">
          {{'COMMON.EDIT' | translate}}
        </button>
      </div>

      <!-- Operator feedback -->
      <div class="project-line">

        <label class="form-switch" for="review">
          <input
            type="checkbox"
            name="review"
            id="review"
            [checked]="getMetadata('delivery', 'feedback')"
            (change)="setMetadata('delivery', 'feedback', $event)">
          <i class="form-icon"></i>
          {{'PROJECT.DELIVERY.OPERATOR_FEEDBACK' | translate}}
        </label>
        <button class="showOnHover btn btn-xs ghost-edit" (click)="editFeedback()">
          {{'COMMON.EDIT' | translate}}
        </button>
      </div>

    </div>

    <div class="project-commentaries">
      <div class="user-message"
           *ngIf="project.clientSatisfaction.message">
        <label class="form-label">{{'PROJECT.DELIVERY.CLIENT_SATISFACTION' | translate}}</label>
        <span>
          {{project.clientSatisfaction?.message}}
      </span>
      </div>

      <div class="operator-feedback" *ngIf="project.feedback">
        <label class="form-label">{{'PROJECT.DELIVERY.OPERATOR_FEEDBACK' | translate}}</label>
        <span>
          {{project.feedback}}
        </span>
      </div>

    </div>

  </div>

  <!--<button class="btn btn-sm ghost-delete" (click)="deleteProjectModal()">{{ 'PROJECT_MODULE.SETUP.DELETE_BUTTON' |
    translate }}
  </button>-->

</div>

<!-- Sidebars -->
<app-sidebar
  [template]="more" (closeSidebar)="closeSidebar($event)">
  <app-innovation-form
    *ngIf="isInnovationSidebar"
    [sidebarState]="sidebarState"
    [type]="more.type"
    [initialProject]="project"
    [setProject]="projectSubject"
    (projectChange)="changeProject($event)"
    (ownerLanguageChange)="updateOwnerLanguage($event)">
  </app-innovation-form>
  <app-emails-form
    *ngIf="isEmailsDomainsSidebar"
    [sidebarState]="sidebarState"
    [type]="more.type"
    [initialDomains]="project.settings.blacklist.domains"
    [initialEmails]="project.settings.blacklist.emails"
    (emailsToBlacklists)="addBlacklists($event)">
  </app-emails-form>
  <app-tags [sidebarState]="sidebarState"
                 *ngIf="isTagsSidebar"
                 [type]="more.type"
                 [tags]="project.tags"
                 [tagType]="tagTypes"
                 (newTags)="addTags($event)">
  </app-tags>
  <app-mission-form *ngIf="more && more.type && more.type === 'mission'" [(mission)]="mission"></app-mission-form>
</app-sidebar>


<!-- Modal to ask admin to sure about deleting the project
<div class="modal" [ngClass]="{ 'active': showDeleteModal }">
  <div class="modal-overlay" (click)="closeModal($event)"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="closeModal($event)"></button>
      <div class="modal-title">{{ 'PROJECT_MODULE.SETUP.DELETE_BUTTON' | translate }}</div>
    </div>
    <div class="modal-body">
      <div class="content">
        {{ 'PROJECT_MODULE.SETUP.DELETE_PROJECT_MODAL.CONTENT' | translate }}
        <ul>
          &lt;!&ndash; Property 'usersToRemove' does not exist on type 'AdminProjectManagementComponent'.
            <li *ngFor="let user of usersToRemove">{{user.firstName}} {{user.lastName}}</li>
          &ndash;&gt;
        </ul>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-sm ghost-delete" (click)="removeProject()">
        {{ 'COMMON.DELETE' | translate }}
      </button>
    </div>
  </div>
</div>-->
