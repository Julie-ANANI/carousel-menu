<div id="admin-project-preparation">

  <!-- section header -->
  <section class="bg-white sticky header-wrapper">
    <div class="container fluid">
      <div class="column col-sm-12 col-11 p-top-1 col-mx-auto relative">

        <!-- tabs -->
        <ul class="tab">
          <ng-container *ngFor="let tab of showCampaignTabs ? campaignTabs : defaultTabs">
            <li *ngIf="canAccessTab(tab)" class="tab-item m-right-10">
              <a
                (click)="navigateTo(tab)"
                [routerLink]="routeToNavigate(tab)"
                routerLinkActive="active">
                {{ tab | titlecase }}
              </a>
            </li>
          </ng-container>
        </ul>
        <!-- /tabs -->

        <!-- actions buttons -->
        <div class="header-btn-action-wrapper">

          <!-- list of campaigns -->
          <div *ngIf="showCampaignTabs" class="d-flex align-center animate-fade is-3">

            <!-- back -->
            <a (click)="backToCampaigns()" class="button is-link is-sm m-right-10">
              Back to campaigns
            </a>
            <!-- /back -->

            <!-- show campaigns -->
            <div class="dropdown is-right">
              <a
                style="padding: 6px 5px 6px 10px;"
                class="button is-sm is-info is-outlined dropdown-toggle" tabindex="0">
                <span
                  style="padding-bottom: 1px"
                  class="text-ellipsis w-200">
                  {{ selectedCampaign.title }}
                </span>
                <i class="fas fa-caret-down"></i>
              </a>
              <ul class="menu is-lg">
                <li *ngFor="let campaign of allCampaigns" (click)="setCampaign(campaign)" class="menu-item">
                  {{ campaign.title }}
                </li>
              </ul>
            </div>
            <!-- /show campaigns -->

          </div>
          <!-- /list of campaigns  -->

          <!-- Description || Targeting || Questionnaire -->
          <div
            *ngIf="activeTab === 'description' || activeTab === 'targeting' || activeTab === 'questionnaire'"
            class="d-flex align-center animate-fade is-3" style="max-height: 40px">

            <!-- quiz preview -->
            <ng-container *ngIf="activeTab === 'questionnaire' || activeTab === 'description'">
              <a
                *ngIf="project.quizId"
                [href]="quizPreviewLink"
                [id]="'admin-btn-preview-quiz'"
                class="button is-link is-sm m-right-10 d-flex"
                target="_blank">
                <i class="fa fa-eye m-right-2"></i>
                Preview quiz
              </a>
            </ng-container>
            <!-- /quiz preview -->

            <!-- ask validation -->
            <ng-container *ngIf="activeTab === 'description' && project.status === 'EDITING'">
              <div
                [ngClass]="{'tooltip is-multiline': triggerAsk()}"
                data-tooltip="This notification has been already sent.">
                <button
                  (click)="openModal($event, 'ASK_VALIDATION')"
                  [disabled]="isSendingNotification || triggerAsk()"
                  style="padding-top: 9px; padding-bottom: 9px"
                  [ngClass]="{'is-info': triggerAsk(), 'is-primary': !triggerAsk()}"
                  class="button is-outlined is-sm m-right-10"
                  id="btn-ask-final-validation">
                  Ask for final validation
                </button>
              </div>
            </ng-container>
            <!-- /ask validation -->

            <!-- save -->
            <button
              *ngIf="canEditDescription || canEditTargeting || activeTab === 'questionnaire'"
              (click)="onSave($event)"
              [disabled]="isSaving || !toBeSaved && !toBeSavedComment"
              style="min-width: 110px; padding-top: 9px; padding-bottom: 9px"
              [ngClass]="{'is-saved': toBeSaved || toBeSavedComment}"
              class="button is-sm is-primary"
              id="btn-save"
              type="button">
              {{ isSaving ? 'saving the project...' : 'Save' }}
              <span *ngIf="!isSaving && (toBeSaved || toBeSavedComment)" class="shape is-circled">
                <i class="fas fa-save"></i>
              </span>
            </button>
            <!-- /save -->

          </div>
          <!-- /Description || Targeting || Questionnaire -->

        </div>
        <!-- /actions buttons -->

      </div>

      <!-- languages section -->
      <section class="lang-menu column col-sm-12 col-11 col-mx-auto p-2 relative m-top-30"
               *ngIf="activeTab === 'description'">
        <div class="d-flex align-center">

          <div
            class="kebab-menu">
            <app-utility-carousel-menu
              (menuItemClicked)="getMenuClicked($event)"
              [config]="{
                   quatity: 8,
                   initQuantity: 8,
                   identifier: 'alias',
                   type : 'type',
                   sources: innoCardLanguages}">
            </app-utility-carousel-menu>
          </div>

          <!-- languages menu -->
<!--          <div class="d-flex flex-wrap-wrap text-medium">-->
<!--            <ng-container *ngFor="let language of innoCardLanguages; let i = index">-->
<!--              <button class="button is-link m-left-10"-->
<!--                      [ngClass]="{'text-underline': language?.type === languageSelected}"-->
<!--                      (click)="setCardLang($event, language.type)">-->
<!--                {{('COMMON.LANG.' + language?.type.toUpperCase()) | translate}}</button>-->
<!--            </ng-container>-->
<!--          </div>-->
          <!-- /languages menu -->

          <!-- add languages button -->
          <button class="button is-link text-highlight is-sm text-no-underline"
                  type="button"
                  *ngIf="innoCardLanguages.length !== 20"
                  (click)="openModal($event, 'ADD_LANG')">
            <ng-container>
              <i class="fas fa-plus-circle icon-left"></i>
              <span class="text-draft text-bold">Add languages</span>
            </ng-container>
          </button>
          <!-- /add languages button -->

        </div>

      </section>
      <!-- /languages section -->

    </div>
  </section>
  <!-- /section header -->

  <!-- different pages -->
  <div>
    <div *ngIf="isLoadingCampaign" class="loading is-primary is-lg"></div>
    <div [hidden]="isLoadingCampaign">
      <router-outlet></router-outlet>
    </div>
  </div>
  <!-- /different pages -->

</div>

<!-- modal -->
<umius-modal [(showModal)]="showModal">

  <section class="modal-body">

    <h2 [ngSwitch]="{ 'color': '4C4C4C' }" class="title is-4 text-center text-bold m-bottom-30">
      <ng-container *ngIf="modelType === 'ASK_VALIDATION'">Ask for final validation</ng-container>
    </h2>

    <div [ngSwitch]="modelType">

      <!-- ask validation -->
      <div *ngSwitchCase="'ASK_VALIDATION'">
        You are about to send an email to the Market Test project team. This email can only be sent once. Continue?
      </div>
      <!-- /ask validation -->

    </div>

  </section>

  <footer [ngSwitch]="modelType" class="modal-footer justify-center">

    <button
      (click)="closeModal()"
      [id]="'btn-cancel'"
      class="button modal-cancel"
      type="button">
      Cancel
    </button>

    <!-- ask validation -->
    <button
      (click)="onAskValidation($event)"
      *ngSwitchCase="'ASK_VALIDATION'"
      [disabled]="isSendingNotification"
      class="button"
      id="btn-modal-confirm-ask-final-validation"
      type="button">
      Confirm
    </button>
    <!-- /ask validation -->

  </footer>

</umius-modal>
<!-- /modal -->

<!-- modal to innovation card add / delete lang -->
<umius-modal *ngIf="canEditDescription" [(showModal)]="showCardModal">

  <!-- body -->
  <section class="modal-body p-bottom-40">
    <h2 style="color: #4C4C4C" class="title is-4 text-center text-bold m-bottom-50">
      <ng-container *ngIf="modelType === 'ADD_LANG'">Add project language
      </ng-container>
      <ng-container *ngIf="modelType === 'DELETE_LANG'">Delete project language</ng-container>
    </h2>

    <div class="d-flex justify-center mxw-550 m-right-auto m-left-auto">
      <ng-container *ngIf="modelType === 'ADD_LANG'">
        <div class="d-flex flex-wrap-wrap">
          <ng-container *ngFor="let language of languagesToAdd">

            <!-- the whole check box body -->
            <div class="form-group m-left-10" style="width: 31%; background-color: #e6e6e6">
              <label class="form-checkbox d-flex justify-around">

                <!-- check box -->
                <input type="checkbox"
                       [(ngModel)]="language['checked']">
                <!-- /check box  -->
                <i class="form-icon m-left-2"></i>

                <!-- language content -->
                <span class="m-left-15">{{language.alias}}</span>
                <!-- /language content -->

                <!-- bleu eye icon: visibility on client side -->
                <ng-container *ngIf="!language['hidden']; else hiddenEye">
                  <button class="button is-circled is-xs m-left-auto tooltip"
                          (click)="setVisibilityOnClientSide($event, language, false)"
                          [attr.data-tooltip]="'This language is \n visible on client side'">
                    <i class="fa fa-eye"></i>
                  </button>
                </ng-container>
                <ng-template #hiddenEye>
                  <button class="button is-circled is-xs m-left-auto tooltip"
                          (click)="setVisibilityOnClientSide($event, language, true)"
                          [attr.data-tooltip]="'This language is \n hidden on client side'">
                    <i class="fa fa-eye-slash"></i>
                  </button>
                </ng-template>
                <!-- /bleu eye icon: visibility on client side -->

              </label>
            </div>
            <!-- /the whole check box body -->

          </ng-container>
        </div>
      </ng-container>
      <ng-container *ngIf="modelType === 'DELETE_LANG'">
        Do you really want to delete the project in {{ cardToDelete.lang === 'fr' ? 'French' : 'English' }} language?
      </ng-container>
    </div>
  </section>
  <!-- body -->

  <!-- footer -->
  <footer [ngSwitch]="modelType" class="modal-footer justify-center">

    <!-- Add Lang -->
    <ng-container *ngSwitchCase="'ADD_LANG'">

      <button
        (click)="closeModal()"
        [id]="'btn-cancel'"
        class="button modal-cancel">
        Cancel
      </button>

      <button
        (click)="addInnovationCard($event)"
        [id]="'btn-confirm-card'"
        class="button ">
        Confirm your selection
      </button>

    </ng-container>
    <!-- /Add Lang -->

    <!-- Add Lang -->
    <ng-container *ngSwitchCase="'DELETE_LANG'">

      <button
        (click)="closeModal()"
        [disabled]="isDeletingCard"
        [id]="'btn-cancel'"
        class="button modal-cancel">
        Cancel
      </button>

      <button
        (click)="deleteInnovationCard($event)"
        [disabled]="isDeletingCard"
        [id]="'btn-confirm-card'"
        class="button ">
        {{ isDeletingCard ? 'deleting the language...' : 'Confirm' }}
      </button>

    </ng-container>
    <!-- /Add Lang -->

  </footer>
  <!-- /footer -->

</umius-modal>
<!-- modal to innovation card add / delete lang -->
