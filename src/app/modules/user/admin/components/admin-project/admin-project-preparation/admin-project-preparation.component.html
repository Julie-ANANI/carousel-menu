<div id="admin-project-preparation">

  <!-- section header -->
  <section class="bg-white sticky header-wrapper">
    <div class="container fluid">
      <div class="column col-sm-12 col-11 p-top-1 col-mx-auto relative">

        <!-- tabs -->
        <ul class="tab">
          <ng-container *ngFor="let tab of showCampaignTabs ? campaignTabs : defaultTabs">
            <li *ngIf="canAccessTab(tab)" class="tab-item m-right-10">
              <a
                (click)="navigateTo(tab)"
                [routerLink]="routeToNavigate(tab)"
                routerLinkActive="active">
                {{ tab | titlecase }}
              </a>
            </li>
          </ng-container>
        </ul>
        <!-- /tabs -->

        <!-- actions buttons -->
        <div class="header-btn-action-wrapper">

          <!-- list of campaigns -->
          <div *ngIf="showCampaignTabs" class="d-flex align-center animate-fade is-3">

            <!-- back -->
            <a (click)="backToCampaigns()" class="button is-link is-sm m-right-10">
              Back to campaigns
            </a>
            <!-- /back -->

            <!-- show campaigns -->
            <div class="dropdown is-right">
              <a
                style="padding: 6px 5px 6px 10px;"
                class="button is-sm is-info is-outlined dropdown-toggle" tabindex="0">
                <span
                  style="padding-bottom: 1px"
                  class="text-ellipsis w-200">
                  {{ selectedCampaign.title }}
                </span>
                <i class="fas fa-caret-down"></i>
              </a>
              <ul class="menu is-lg">
                <li *ngFor="let campaign of allCampaigns" (click)="setCampaign(campaign)" class="menu-item">
                  {{ campaign.title }}
                </li>
              </ul>
            </div>
            <!-- /show campaigns -->

          </div>
          <!-- /list of campaigns  -->

          <!-- Description || Targeting || Questionnaire -->
          <div
            *ngIf="activeTab === 'description' || activeTab === 'targeting' || activeTab === 'questionnaire'"
            class="d-flex align-center animate-fade is-3" style="max-height: 40px">

            <!-- add lang -->
            <button
              (click)="openModal($event, 'ADD_LANG')"
              *ngIf="canAddCard && activeTab === 'description' && canEditDescription"
              [disabled]="isAddingCard"
              class="button is-link is-sm m-right-10"
              id="btn-add-card">
              <i class="fas fa-plus-circle m-right-2"></i>
              {{ activeCard.lang === 'fr' ? 'Add english' : 'Add french' }}
            </button>
            <!-- /add lang -->

<!--            TODO: delete this-->

            <app-menu-kebab></app-menu-kebab>


            <!-- lang change -->
            <div *ngIf="showLangDrop && activeTab === 'description'" class="dropdown is-right m-right-10">
              <a class="button is-sm is-link dropdown-toggle" tabindex="0">
                {{ activeCard.lang === 'fr' ? 'French' : 'English' }}<i class="fas fa-caret-down m-right-2"></i>
              </a>

              <ul class="menu">
                <li
                  (click)="setCardLang(card.lang)"
                  *ngFor="let card of project.innovationCards"
                  class="menu-item flex-between">
                  {{ card.lang === 'fr' ? 'French' : 'English' }}
                  <div
                    *ngIf="canEditDescription"
                    (click)="openModal($event, 'DELETE_LANG', card)"
                    [ngClass]="{'disabled': isDeletingCard}"
                    class="icon-container is-sm is-overlay">
                    <i class="icon text-alert icon-delete"></i>
                  </div>
                </li>
              </ul>
            </div>
            <!-- /lang change -->

            <!-- quiz preview -->
            <ng-container *ngIf="activeTab === 'questionnaire' || activeTab === 'description'">
              <a
                *ngIf="project.quizId"
                [href]="quizPreviewLink"
                [id]="'admin-btn-preview-quiz'"
                class="button is-link is-sm m-right-10 d-flex"
                target="_blank">
                <i class="fa fa-eye m-right-2"></i>
                Preview quiz
              </a>
            </ng-container>
            <!-- /quiz preview -->

            <!-- ask validation -->
            <ng-container *ngIf="activeTab === 'description' && project.status === 'EDITING'">
              <div
                [ngClass]="{'tooltip is-multiline': triggerAsk()}"
                data-tooltip="This notification has been already sent.">
                <button
                  (click)="openModal($event, 'ASK_VALIDATION')"
                  [disabled]="isSendingNotification || triggerAsk()"
                  style="padding-top: 9px; padding-bottom: 9px"
                  [ngClass]="{'is-info': triggerAsk(), 'is-primary': !triggerAsk()}"
                  class="button is-outlined is-sm m-right-10"
                  id="btn-ask-final-validation">
                  Ask for final validation
                </button>
              </div>
            </ng-container>
            <!-- /ask validation -->

            <!-- save -->
            <button
              *ngIf="canEditDescription || canEditTargeting || activeTab === 'questionnaire'"
              (click)="onSave($event)"
              [disabled]="isSaving || !toBeSaved && !toBeSavedComment"
              style="min-width: 110px; padding-top: 9px; padding-bottom: 9px"
              [ngClass]="{'is-saved': toBeSaved || toBeSavedComment}"
              class="button is-sm is-primary"
              id="btn-save"
              type="button">
              {{ isSaving ? 'saving the project...' : 'Save' }}
              <span *ngIf="!isSaving && (toBeSaved || toBeSavedComment)" class="shape is-circled">
                <i class="fas fa-save"></i>
              </span>
            </button>
            <!-- /save -->

          </div>
          <!-- /Description || Targeting || Questionnaire -->

        </div>
        <!-- /actions buttons -->

      </div>
    </div>
  </section>
  <!-- /section header -->

  <!-- different pages -->
  <div>
    <div *ngIf="isLoadingCampaign" class="loading is-primary is-lg"></div>
    <div [hidden]="isLoadingCampaign">
      <router-outlet></router-outlet>
    </div>
  </div>
  <!-- /different pages -->

</div>

<!-- modal -->
<umius-modal [(showModal)]="showModal">

  <section class="modal-body">

    <h2 [ngSwitch]="{ 'color': '4C4C4C' }" class="title is-4 text-center text-bold m-bottom-30">
      <ng-container *ngIf="modelType === 'ASK_VALIDATION'">Ask for final validation</ng-container>
    </h2>

    <div [ngSwitch]="modelType">

      <!-- ask validation -->
      <div *ngSwitchCase="'ASK_VALIDATION'">
        You are about to send an email to the Market Test project team. This email can only be sent once. Continue?
      </div>
      <!-- /ask validation -->

    </div>

  </section>

  <footer [ngSwitch]="modelType" class="modal-footer justify-center">

    <button
      (click)="closeModal()"
      [id]="'btn-cancel'"
      class="button modal-cancel"
      type="button">
      Cancel
    </button>

    <!-- ask validation -->
    <button
      (click)="onAskValidation($event)"
      *ngSwitchCase="'ASK_VALIDATION'"
      [disabled]="isSendingNotification"
      class="button"
      id="btn-modal-confirm-ask-final-validation"
      type="button">
      Confirm
    </button>
    <!-- /ask validation -->

  </footer>

</umius-modal>
<!-- /modal -->

<!-- modal to innovation card add / delete lang -->
<umius-modal *ngIf="canEditDescription" [(showModal)]="showCardModal">

  <!-- body -->
  <section class="modal-body p-bottom-40">
    <h2 style="color: #4C4C4C" class="title is-4 text-center text-bold m-bottom-50">
      <ng-container *ngIf="modelType === 'ADD_LANG'">Add project language</ng-container>
      <ng-container *ngIf="modelType === 'DELETE_LANG'">Delete project language</ng-container>
    </h2>
    <div class="mxw-550 m-right-auto m-left-auto">
      <ng-container *ngIf="modelType === 'ADD_LANG'">
        Do you really want to add the project in {{ activeCard.lang === 'fr' ? 'English' : 'French' }} language?
      </ng-container>
      <ng-container *ngIf="modelType === 'DELETE_LANG'">
        Do you really want to delete the project in {{ cardToDelete.lang === 'fr' ? 'French' : 'English' }} language?
      </ng-container>
    </div>
  </section>
  <!-- body -->

  <!-- footer -->
  <footer [ngSwitch]="modelType" class="modal-footer justify-center">

    <!-- Add Lang -->
    <ng-container *ngSwitchCase="'ADD_LANG'">

      <button
        (click)="closeModal()"
        [disabled]="isAddingCard"
        [id]="'btn-cancel'"
        class="button modal-cancel">
        Cancel
      </button>

      <button
        (click)="addInnovationCard($event)"
        [disabled]="isAddingCard"
        [id]="'btn-confirm-card'"
        class="button ">
        {{ isAddingCard ? 'adding the language...' : 'Confirm' }}
      </button>

    </ng-container>
    <!-- /Add Lang -->

    <!-- Add Lang -->
    <ng-container *ngSwitchCase="'DELETE_LANG'">

      <button
        (click)="closeModal()"
        [disabled]="isDeletingCard"
        [id]="'btn-cancel'"
        class="button modal-cancel">
        Cancel
      </button>

      <button
        (click)="deleteInnovationCard($event)"
        [disabled]="isDeletingCard"
        [id]="'btn-confirm-card'"
        class="button ">
        {{ isDeletingCard ? 'deleting the language...' : 'Confirm' }}
      </button>

    </ng-container>
    <!-- /Add Lang -->

  </footer>
  <!-- /footer -->

</umius-modal>
<!-- modal to innovation card add / delete lang -->
