<div [hidden]="!canAccess()" class="container fluid grid-2xl" id="admin-project-campaigns">
  <div class="column col-sm-12 col-11 col-mx-auto">

    <!-- error message while fetching -->
    <app-utility-message-error *ngIf="!isLoading && fetchingError"></app-utility-message-error>
    <!-- /error message while fetching -->

    <!-- no fetching error -->
    <div [hidden]="fetchingError && !isLoading" class="p-top-30 p-bottom-30">

      <!-- section add campaign -->
      <section *ngIf="canAccess(['add'])" class="text-right p-bottom-50">
        <button
          (click)="onAddCampaign($event)"
          [disabled]="isAddingCampaign"
          class="button is-primary is-shadowed is-sm"
          id="btn-add-campaign"
          type="button">
          {{ isAddingCampaign ? 'is adding...' : 'Add Campaign' }}
        </button>
      </section>
      <!-- /section add campaign -->

      <!-- section campaigns -->
      <section [@listAnimation]="campaigns.length" [ngStyle]="{'margin-bottom': '-30px'}">
        <div *ngFor="let campaign of campaigns; let i = index" class="card-wrapper">
          <div class="card-content">

            <div class="d-flex align-center">
              <a
                (click)="onNavigation(campaign)"
                [routerLink]="route(campaign._id)"
                routerLinkActive="active">
                {{ campaign.title }}
              </a>
              <div *ngIf="campaign.type === 'COMMUNITY'" class="label is-sm text-bold is-success m-left-10">
                {{ campaign.type }}
              </div>
              <div *ngIf="!!campaign.rgpd" class="label is-sm text-bold is-success m-left-10">
                GDPR MODE ON
              </div>
              <div
                *ngIf="canAccess(['edit'])"
                class="text-link text-sm m-left-20 m-top-1"
                (click)="onEditCampaign($event, campaign)">
                {{ 'CAMPAIGNS.EDIT_BUTTON' | translate }}
              </div>
            </div>

            <div class="d-flex text-notify text-medium text-sm m-top-2 align-center">

              <span>{{ stats(campaign, 'nbFirstTierMails') }} Good email(s)</span>

              <ng-container *ngIf="canAccess(['campaign', 'batch', 'quiz'])">
                <ng-container *ngIf="!!quizURL('fr', campaign)">
                  |
                  <span (click)="copyQuizLink('fr', campaign)" class="text-link text-secondary m-left-h m-right-h">
                  Copy FR quiz link
                </span>
                </ng-container>
                <ng-container *ngIf="!!quizURL('en', campaign)">
                  |
                  <span (click)="copyQuizLink('en', campaign)" class="text-link text-secondary m-left-h m-right-h">
                  Copy EN quiz link
                </span>
                </ng-container>
              </ng-container>

              <ng-container *ngIf="canAccess(['updateStatistics'])">
                |
                <span class="text-link m-left-h text-secondary m-right-h" (click)="onUpdateStats($event, campaign, i)">
                  Update stats
                </span>
              </ng-container>

              <ng-container *ngIf="canAccess(['delete'])">
                |
                <span (click)="onDelete($event, campaign)" class="text-link text-alert m-left-h">
                  Delete
                </span>
              </ng-container>

            </div>

          </div>
        </div>
      </section>
      <!-- /section campaigns -->

    </div>
    <!-- /no fetching error -->

  </div>
</div>


<!-- modal to ask the admin to delete the campaign -->
<app-utility-modal
  *ngIf="canAccess(['delete'])"
  [(showModal)]="activateModal"
  [title]="'Delete Board'">

  <section class="modal-body">
    Do you really want to delete this campaign?
  </section>

  <footer class="modal-footer">
    <button class="button modal-cancel">Cancel</button>
    <button (click)="onConfirmDelete()" class="button is-primary">Confirm</button>
  </footer>

</app-utility-modal>
<!-- /modal to ask the admin to delete the campaign -->


<!-- sidebar to edit campaign -->
<app-sidebar *ngIf="canAccess(['edit'])" [(template)]="sidebarValue">
  <app-sidebar-campaign
    (campaignOutput)="updateCampaign($event)"
    [campaign]="selectCampaign"
    [isEditable]="canAccess(['edit'])"
    [sidebarState]="sidebarValue.animate_state"
    [type]="sidebarValue.type">
  </app-sidebar-campaign>
</app-sidebar>
<!-- /sidebar to edit campaign -->
