<div id="showcase">
  <div class="column col-xs-12 col-11 col-mx-auto">

    <!-- when fetching error -->
    <ng-container *ngIf="fetchingError">
      <div class="d-flex s-error-wrapper align-center">
        <app-utility-error-template-1
          style="width: 100%"
          [errorMessage]="'ERROR.ERRORS.FETCHING'">
        </app-utility-error-template-1>
      </div>
    </ng-container>
    <!-- /when fetching error -->

    <!-- isLoading -->
    <ng-container *ngIf="isLoading">
      <div class="m-top-20">
        <div class="loading is-primary is-md"></div>
      </div>
    </ng-container>
    <!-- /isLoading -->

    <!-- section statistics -->
    <div *ngIf="!fetchingError && !isLoading" class="p-top-30 p-bottom-30 d-flex flex-d-column">

      <div class="d-flex align-self-end">

        <!-- years -->
        <div class="dropdown is-year animate-fade is-5 m-10">
          <a class="button is-sm is-outlined is-draft dropdown-toggle" tabindex="0">
            {{ selectedYear ? selectedYear : 'Year' }}
            <i class="fas m-left-10 fa-caret-down"></i>
          </a>
          <ul class="menu">
            <li (click)="onChangeDate('YEAR','')" *ngIf="'' !== selectedYear" class="menu-item"
                id="btn-dropdown-all-year">
              All years
            </li>
            <ng-container *ngFor="let year of dropdownYears">
              <li (click)="onChangeDate('YEAR',year)" *ngIf="year !== selectedYear" [id]="'btn-dropdown-'+year+'year'"
                  class="menu-item">
                {{ year }}
              </li>
            </ng-container>
          </ul>
        </div>
        <!-- /years -->

        <!-- months -->
        <div class="dropdown is-year animate-fade is-5 m-10">
          <a class="button is-sm is-outlined is-draft dropdown-toggle" tabindex="0">
            {{ selectedMonth ? selectedMonth : 'Month' }}
            <i class="fas m-left-10 fa-caret-down"></i>
          </a>
          <ul class="menu">
            <li (click)="onChangeDate('MONTH','')" *ngIf="'' !== selectedMonth" class="menu-item"
                id="btn-dropdown-all-month">
              All months
            </li>
            <ng-container *ngFor="let month of dropdownMonths">
              <li (click)="onChangeDate('MONTH', month)" *ngIf="month !== selectedMonth"
                  [id]="'btn-dropdown-'+month+'month'"
                  class="menu-item">
                {{ month }}
              </li>
            </ng-container>
          </ul>
        </div>
        <!-- /months -->

        <!-- week -->
        <div *ngIf="!!selectedYear && !!selectedMonth" class="dropdown is-year animate-fade is-5 m-10">
          <a class="button is-sm is-outlined is-draft dropdown-toggle" tabindex="0">
            {{ selectedWeek ? selectedWeek + ' week' : 'Week' }}
            <i class="fas m-left-10 fa-caret-down"></i>
          </a>
          <ul class="menu">
            <li (click)="onChangeDate('WEEK','')" *ngIf="'' !== selectedWeek" class="menu-item"
                id="btn-dropdown-all-weeks">
              All weeks
            </li>
            <ng-container *ngFor="let week of dropdownWeeks">
              <li (click)="onChangeDate('WEEK', week)" *ngIf="week !== selectedWeek"
                  [id]="'btn-dropdown-'+week+'week'"
                  class="menu-item">
                {{ week }}
              </li>
            </ng-container>
          </ul>
        </div>
        <!-- /months -->
      </div>
      <div *ngIf="jobsClassification" class="d-flex align-self-end">
        <p class="text-sm m-10">Last updated : {{ jobsClassification.timestamp | date }}</p>
      </div>

      <div class="d-flex m-bottom-4 m-top-4 align-self-center">
        <label class="form-checkbox bg-draft mxw-450 email-confidence-option m-right-3 m-right-auto m-bottom-15 text-white text-medium">
          Total : {{ classified }}
        </label>
        <label [ngClass]="{'checked': selectedEmailConfidenceType === 'RISKY'}"
          class="form-checkbox mxw-450 email-confidence-option m-right-3 m-right-auto m-bottom-15 c-hand text-white text-medium">
          <input (change)="selectEmailConfidenceType('RISKY')" [checked]="selectedEmailConfidenceType === 'RISKY'"
            type="checkbox">
          Risky emails : {{ numberFormatter(nbRiskyEmailsClassified, 0) }} ({{(nbRiskyEmailsClassified / classified * 100) | number: '1.0-0' }}%)
        </label>
        <label [ngClass]="{'checked': selectedEmailConfidenceType === 'GOOD'}"
          class="form-checkbox mxw-450 email-confidence-option m-left-auto m-right-auto m-bottom-15 c-hand text-white text-medium">
          <input (change)="selectEmailConfidenceType('GOOD')" [checked]="selectedEmailConfidenceType === 'GOOD'"
            type="checkbox">
          Good emails : {{ numberFormatter(nbGoodEmailsClassified, 0) }} ({{((nbGoodEmailsClassified) / classified * 100) | number: '1.0-0' }}%)
        </label>
      </div>

      <!-- section seniority levels -->
      <section
        class="d-flex flex-d-column align-start m-bottom-10">
        <h2> Seniority levels </h2>

        <ng-container
          *ngIf="seniorityLevelsClassification && seniorityLevelsClassification.seniorityLevels.length; else noSeniorityData">
          <div class="responsive-scroll d-flex justify-evenly m-10">
            <div class="table-responsive p-top-10 d-flex">
              <table
                class="table" style="width: fit-content;margin: auto; max-width: 100%;">
                <thead>
                <tr class="text-center">
                  <ng-container *ngFor="let seniorityLevel of seniorityLevelsClassification.seniorityLevels">
                    <th *ngIf="seniorityLevel.name"
                        style="min-width: 40px">
                      <div style="width: fit-content">
                        {{ seniorityLevel.name }}
                      </div>
                    </th>
                  </ng-container>
                </tr>
                </thead>
                <tbody>
                <tr class="text-center">
                   <ng-container *ngFor="let seniorityLevel of seniorityLevelsClassification.seniorityLevels">
                    <td *ngIf="seniorityLevel.name"
                        style="min-width: 40px">
                      {{ numberFormatter(seniorityLevel.count, 0) }}
                    </td>
                  </ng-container>
                </tr>
                <tr class="text-center">
                  <ng-container *ngFor="let seniorityLevel of seniorityLevelsClassification.seniorityLevels">
                    <td *ngIf="seniorityLevel.name"
                        style="min-width: 40px" class="text-center">
                      {{ (seniorityLevel.count / repartitionStats.classified * 100) | number: '1.0-0' }}%
                    </td>
                  </ng-container>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </ng-container>
        <ng-template #noSeniorityData>No classification found for those dates</ng-template>
      </section>
      <!-- /section seniority levels -->

      <!-- section jobs -->
      <section class="d-flex flex-d-column align-start">
        <div class="d-flex align-center">
          <h2> Typology of jobs </h2>
          <div
            class="label is-rounded is-info is-sm m-no m-10">{{ jobsClassification && jobsClassification.categories.length }}</div>
        </div>
        <ng-container *ngIf="jobsClassification && jobsClassification.categories; else noJobsData">
          <div *ngFor="let category of jobsClassification.categories"
               class="responsive-scroll d-flex justify-evenly m-10">
            <div class="table-responsive p-top-10 d-flex">
              <table *ngIf="category.jobs.length" class="table"
                     style="width: fit-content;margin: auto; max-width: 100%;">
                <thead>
                <tr class="text-center">
                  <th class="bg-draft" style="min-width: 40px">
                    <!--{{ (category.label || {en: 'Not classified yet'}).en }}-->
                    {{ (category.entry | langEntry:'label':'en') || 'Not classified yet' }}
                  </th>
                  <th *ngFor="let job of category.jobs" style="min-width: 40px">
                    <div style="width: fit-content">
                      <!--{{ (job.label || {en: 'Not classified yet'}).en }}-->
                      {{ (job.entry | langEntry:'label':'en') || 'Not classified yet' }}
                    </div>
                  </th>
                </tr>
                </thead>
                <tbody>
                <tr class="text-center">
                  <td class="text-bold">{{ numberFormatter(category.count, 0) }}</td>
                  <td *ngFor="let job of category.jobs"
                      style="min-width: 40px">
                    {{ numberFormatter(job.count, 0) }}
                  </td>
                </tr>
                <tr class="text-center">
                  <td class="text-bold">{{ (category.count / repartitionStats.classified * 100) | number: '1.0-0'}}%</td>
                  <td *ngFor="let job of category.jobs"
                      style="min-width: 40px">
                    {{ (job.count / category.count * 100) | number: '1.0-0' }}%
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </ng-container>
        <ng-template #noJobsData>No classification found for those dates</ng-template>

      </section>
      <!-- /section jobs -->
    </div>
  </div>
</div>

