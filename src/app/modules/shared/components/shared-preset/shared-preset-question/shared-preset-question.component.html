<div [id]="'question-' + questionIndex" class="shared-preset-question">

  <!-- header -->
  <div [ngClass]="{'is-edit-mode': editMode}" class="header-wrapper flex-between">

    <!-- move / select / type / label-->
    <div class="d-flex align-center">

      <div *ngIf="isEditable" data-tooltip="Move" class="move-arrows tooltip">
        <i (click)="upQuestion($event)" class="icon icon-arrow-up"></i>
        <i (click)="downQuestion($event)" class="icon icon-arrow-down"></i>
      </div>

      <ng-container *ngIf="!editMode || isTaggedQuestion">
        <label class="m-right-20">
          <select class="form-select is-sm" disabled>
            <option>{{ 'PRESETS.QUESTION.TYPE.' + question.controlType | translate }}</option>
          </select>
        </label>
        <span *ngIf="!editMode || !isEditable" class="m-right-20">{{ questionLabel }}</span>
      </ng-container>

      <ng-container *ngIf="isEditable && editMode && !isTaggedQuestion">
        <label class="m-right-20">
          <select
            (ngModelChange)="onChangeQuestionType($event)"
            [(ngModel)]="question.controlType"
            class="form-select is-sm">
            <option value="radio">{{ 'PRESETS.QUESTION.TYPE.radio' | translate }}</option>
            <option value="checkbox">{{ 'PRESETS.QUESTION.TYPE.checkbox' | translate }}</option>
            <option value="textarea">{{ 'PRESETS.QUESTION.TYPE.textarea' | translate }}</option>
            <option value="scale">{{ 'PRESETS.QUESTION.TYPE.scale' | translate }}</option>
            <option value="stars">{{ 'PRESETS.QUESTION.TYPE.stars' | translate }}</option>
            <option value="ranking">{{ 'PRESETS.QUESTION.TYPE.ranking' | translate }}</option>
          </select>
        </label>
      </ng-container>

      <ng-container *ngIf="editMode && isEditable">
        <label class="m-right-20">
          <select
            (ngModelChange)="changeIdentifier($event)"
            [(ngModel)]="question.identifier"
            class="form-select is-sm">
            <option *ngIf="isTaggedQuestion" [value]="question.identifier">#{{question.identifier}}</option>
            <option *ngFor="let question of getNonUsedQuestions()" [value]="question">#{{question}}</option>
            <option [value]="customId">{{ 'COMMON.LABEL.CUSTOM' | translate }}</option>
          </select>
        </label>
      </ng-container>

      <ng-container *ngIf="isTaggedQuestion && (!editMode || !isEditable)">
        <div class="label is-rounded is-tag is-sm m-no m-right-20">
          #{{question.identifier}}
        </div>
      </ng-container>

    </div>
    <!-- /move / select / type / label -->

    <!-- buttons -->
    <div class="buttons-wrapper">

      <!-- delete -->
      <div
        (click)="removeQuestion($event)"
        *ngIf="editMode && isEditable"
        [id]="'sharedPresetQuestion-btn-delete-question'"
        class="icon-container is-overlay m-right-15">
        <span data-tooltip="Delete" class="tooltip">
          <i class="icon icon-delete text-white"></i>
        </span>
      </div>
      <!-- /delete -->

      <!-- clone -->
      <div
        (click)="cloneQuestion($event)"
        *ngIf="editMode && isEditable"
        [id]="'sharedPresetQuestion-btn-clone-question'"
        class="icon-container is-overlay m-right-15">
        <span data-tooltip="Clone" class="tooltip">
          <i class="icon icon-copy text-white"></i>
        </span>
      </div>
      <!-- /clone -->

      <!-- edit -->
      <div
        (click)="editMode = !editMode"
        [id]="'sharedPresetSection-btn-edit-section'"
        class="icon-container is-overlay">
        <span [attr.data-tooltip]="isEditable ? editMode ? 'Stop editing' : 'Edit' : 'View'" class="tooltip">
          <img [src]="picto.edit.white" alt=" " class="img-responsive">
        </span>
      </div>
      <!-- /edit -->

    </div>
    <!-- /buttons -->

  </div>
  <!-- /header -->

  <!-- question edition -->
  <div *ngIf="editMode" class="question-body">

    <!-- toolbar -->
    <div class="question-toolbar m-bottom-10">

      <div class="d-flex align-center">

        <!-- add comment -->
        <label *ngIf="question.controlType !== 'textarea'" class="form-switch text-sm m-right-50">
          <input
            (ngModelChange)="updateValue($event, 'COMMENT')"
            [ngModel]="question.canComment"
            [disabled]="!isEditable"
            type="checkbox">
          <i class="form-icon"></i> Allow to add comment
        </label>
        <!-- /add comment -->

        <!-- add comment -->
        <label *ngIf="question.controlType === 'ranking'" class="form-switch text-sm m-right-50">
          <input
            (ngModelChange)="updateValue($event, 'RANDOMIZATION')"
            [ngModel]="question.randomization"
            [disabled]="!isEditable"
            type="checkbox">
          <i class="form-icon"></i> Randomization
        </label>
        <!-- /add comment -->

        <!-- is sensitive data -->
        <span
          *ngIf="question.controlType === 'textarea'"
          [attr.data-tooltip]="'For anonymous shared link. To \n hide answers that may contain \n phone numbers, mails...'"
          class="tooltip is-multiline">
          <label class="form-switch text-sm m-right-50">
          <input
            (ngModelChange)="updateValue($event, 'SENSITIVE_DATA')"
            [ngModel]="question.sensitiveAnswerData"
            [disabled]="!isEditable"
            type="checkbox">
            <i class="form-icon"></i> Visibility of sensitive answer
          </label>
        </span>
        <!-- /is sensitive data -->

        <!-- max options select -->
        <ng-container *ngIf="question.controlType === 'checkbox'">
          <div class="d-flex align-center">
            <label class="form-label m-no-bottom m-right-2 text-normal" [for]="'question-maxOption'">
              Maximum options to select:
            </label>
            <p *ngIf="!isEditable" class="text-sm">{{ question.maxOptionsSelect || 'NA' }}</p>
            <input
              (ngModelChange)="onChangeMaxOptions($event)"
              *ngIf="isEditable"
              [(ngModel)]="question.maxOptionsSelect"
              [attr.placeholder]="question.options.length"
              [id]="'question-maxOption'"
              [max]="question.options.length"
              [ngStyle]="{'max-width': '40px'}"
              class="form-input is-sm text-center"
              min="1"
              type="number">
          </div>
        </ng-container>
        <!-- /max options select -->

      </div>

    </div>
    <!-- /toolbar -->

    <!-- question content -->
    <div class="d-flex">
      <div
        *ngFor="let lang of presetLanguages; let i = index;"
        [ngClass]="{'has-border': presetLanguages.length > 1 && i > 0, 'has-more-content': presetLanguages.length > 1}"
        class="question-content">

        <!-- language -->
        <div [ngClass]="presetLanguages.length === 1 ? 'text-center' : 'text-left'" class="m-bottom-20">
          <div class="label m-no lang-label relative">
            {{ 'COMMON.LANG.' + lang | uppercase | translate }}
          </div>
        </div>
        <!-- /language -->

        <!-- label -->
        <div class="m-bottom-15">
          <label class="form-label">Question</label>
          <p *ngIf="!isEditable" class="text-sm">{{ question.label[lang] || 'NA' }}</p>
          <textarea
            #textAreaElement
            (ngModelChange)="notifyChanges()"
            *ngIf="isEditable"
            [(ngModel)]="question.label[lang]"
            [id]="'question-label-'+lang"
            [ngStyle]="{'minHeight': textAreaElement.scrollHeight + 'px'}"
            class="form-input auto-expand"
            type="text">
          </textarea>
        </div>
        <!-- /label -->

        <!-- instruction -->
        <div class="m-bottom-15">
          <label class="form-label">{{ lang === 'fr' ? 'Consigne' : 'Instruction' }}</label>
          <p *ngIf="!isEditable" class="text-sm">
            {{ (question.instruction && question.instruction[lang]) || 'NA' }}
          </p>
          <textarea
            #textAreaElement
            (ngModelChange)="onChangeInstruction($event, lang)"
            *ngIf="isEditable"
            [id]="'question-instruction-'+lang"
            [ngModel]="(question.instruction && question.instruction[lang]) ? question.instruction[lang] : ''"
            [ngStyle]="{'minHeight': textAreaElement.scrollHeight + 'px'}"
            class="form-input"
            type="text">
          </textarea>
        </div>
        <!-- /instruction -->

        <!-- question types -->
        <ng-container *ngIf="question.controlType === 'radio' || question.controlType === 'checkbox'
          || question.controlType === 'stars'|| question.controlType === 'ranking'">

          <!-- options -->
          <div [ngClass]="{'has-single-option': presetLanguages.length === 1}" class="options-wrapper">
            <div
              *ngFor="let option of question.options; let i = index;"
              [ngClass]="{'is-editable': isEditable}"
              class="card">

              <ng-container *ngIf="!isEditable">{{ option.label[lang] || 'NA' }}</ng-container>

              <!-- move option -->
              <div *ngIf="isEditable" class="flex-centered m-top-10 m-bottom-10">
                <div
                  [ngClass]="{'is-horizontal': presetLanguages.length === 1}"
                  data-tooltip="Move"
                  class="move-arrows m-no-right tooltip is-bottom">
                  <i
                    (click)="moveQuestionOption($event, i, -1)"
                    [ngClass]="{'disabled': i == 0, 'icon-arrow-up': presetLanguages.length > 1,
                    'icon-arrow-left': presetLanguages.length === 1}"
                    class="icon">
                  </i>
                  <i
                    (click)="moveQuestionOption($event, i, 1)"
                    [ngClass]="{'disabled': (i + 1) == question.options.length,
                    'icon-arrow-down': presetLanguages.length > 1, 'icon-arrow-right':
                    presetLanguages.length === 1}"
                    class="icon">
                  </i>
                </div>
              </div>
              <!-- /move option -->

              <!-- input -->
              <textarea
                #textAreaElement
                (ngModelChange)="notifyChanges()"
                *ngIf="isEditable"
                [(ngModel)]="option.label[lang]"
                [id]="'option-label-'+lang"
                [ngStyle]="{'minHeight': textAreaElement.scrollHeight + 'px'}"
                class="form-input"
                type="text">
              </textarea>
              <!-- /input -->

              <!-- delete icon -->
              <div class="text-center m-top-10">
                <div
                  (click)="deleteOption($event, i)"
                  *ngIf="isEditable"
                  [id]="'sharedPresetQuestion-btn-delete-option-' + i"
                  class="icon-container is-overlay">
                  <span data-tooltip="Delete option" class="tooltip">
                    <i class="icon icon-delete text-alert"></i>
                  </span>
                </div>
              </div>
              <!-- /delete icon -->

            </div>
          </div>
          <!-- /options -->

        </ng-container>
        <!-- /question types -->

      </div>
    </div>
    <!-- /question content -->

    <!-- add item -->
    <ng-container *ngIf="isEditable && (question.controlType === 'radio' || question.controlType === 'checkbox'
     || question.controlType === 'stars') || question.controlType === 'ranking'">
      <div [ngClass]="presetLanguages.length === 1 ? 'm-top-15' : 'm-top-30'" class="text-center  m-bottom-15">
        <button
          (click)="addNewOption($event)"
          [id]="'sharedPresetQuestion-btn-add-item'"
          class="button is-outlined is-info text-bold is-xs"
          type="button">
          <span class="icon-container is-overlay is-sm active m-right-10">
            <i class="icon icon-plus text-xs"></i>
          </span>
          Add item
        </button>
      </div>
    </ng-container>
    <!-- /add item -->

  </div>
  <!-- /question edition -->

</div>

