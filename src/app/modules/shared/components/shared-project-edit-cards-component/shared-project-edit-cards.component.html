<section class="main-container" id="pitch-card" *ngIf="project">
  <form novalidate>
    <div class="column col-xs-12 col-11 col-mx-auto">

      <!--Language choice -->
      <div class="lang-wrapper">
        <div class="ques">{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.LANGUAGE.HEADING' | translate }}</div>
        <div class="lang-option-wrapper">
          <ul>
            <li
              *ngFor="let innovationCard of project.innovationCards; let i = index;"
              [ngClass]="{'active': innovationCardEditingIndex === i }"
              (click)="onLangSelect($event, i)">
              <div class="radio-button"><span>â€¢</span></div>
              <span [ngStyle]="{ 'padding-left': '.3rem' }">{{ 'COMMON.LANG.'+ innovationCard.lang | uppercase | translate }}</span>
            </li>
            <p *ngIf="project.innovationCards?.length < 2 && canEdit">
              {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.LANGUAGE.ADD_PROJECT_LANGUAGE' | translate }}
              <span class="text-link">
                <span *ngIf="!containsLanguage('fr')" (click)="createInnovationCard($event, 'fr')">
                  {{ 'COMMON.LANG.FR' | translate }}
                </span>
                <span *ngIf="!containsLanguage('en')" (click)="createInnovationCard($event, 'en')">
                  {{ 'COMMON.LANG.EN' | translate }}
                </span>
              </span>
            </p>
          </ul>
        </div>
      </div>

      <!-- Ques and help section -->
      <div class="columns">

        <!-- Ques -->
        <div class="column col-md-12 col-mx-auto" [ngClass]="adminSide ? 'col-12' : 'col-6' ">

          <div *ngFor="let innovationCards of project.innovationCards; let i = index">
            <div *ngIf="innovationCardEditingIndex === i">

              <!-- Project title -->
              <div [ngStyle]="{ 'padding-top': '2.5rem' }">
                <span class="num-rect">1</span>
                <span class="ques">{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.TITLE.LABEL' | translate }}</span>

                <div *ngIf="!canEdit" class="pd-input">
                  <p>{{ innovationCards.title }}</p>
                </div>

                <div *ngIf="adminSide && project.innovationCards?.length > 1" class="pd-input">
                  <button
                    class="btn btn-sm ghost-primary"
                    [ngClass]="{'disabled': innovationCards.title}"
                    [disabled]="innovationCards.title"
                    (click)="importTranslation($event, 'title')">
                    {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.IMPORT_TRANSLATION' | translate }}
                  </button>
                </div>

                <div *ngIf="canEdit" class="form-group pd-input">
                  <input
                    type="text"
                    id="innovation-title"
                    class="form-default"
                    name="title"
                    #title="ngModel"
                    [(ngModel)]="innovationCards.title"
                    [attr.placeholder]="'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.TITLE.PLACEHOLDER' | translate"
                    (ngModelChange)="notifyModelChanges()"
                    required
                    [ngClass]="{'borderRed': showTitleError}"
                    (keyup)="showTitleError = false">
                  <div class="form-error" *ngIf="title.touched && title.invalid || showTitleError">
                    <span>{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.TITLE.ERROR' | translate }}</span>
                  </div>
                </div>

              </div>

              <!-- Summary -->
              <div class="project-data">
                <span class="num-rect">2</span>
                <span class="ques">{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.SUMMARY.LABEL' | translate }}</span>

                <div *ngIf="!canEdit" class="pd-input">
                  <div [innerHtml]="innovationCards.summary"></div>
                </div>

                <div *ngIf="adminSide && project.innovationCards?.length > 1" class="pd-input">
                  <button
                    class="btn btn-sm ghost-primary"
                    [ngClass]="{'disabled': innovationCards.summary}"
                    [disabled]="innovationCards.summary"
                    (click)="importTranslation($event, 'summary')">
                    {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.IMPORT_TRANSLATION' | translate }}
                  </button>
                </div>

                <div *ngIf="canEdit" class="form-group pd-input">
                  <app-text-zone
                    [data]="innovationCards.summary"
                    [elementId]="'summary' + innovationCards.lang"
                    (onTextChange)="updateData($event)">
                  </app-text-zone>
                  <!-- todo: add placeholders
                    [attr.placeholder]="'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.PROBLEM.PLACEHOLDER' | translate"
                  -->
                  <div class="charRemaining">
                  <span [ngStyle]="{'color': getColor(innovationCards.summary?.length | characterCountdown:500)}">
                    {{ innovationCards.summary?.length | characterCountdown:500 }}</span>
                  </div>
                  <div class="form-error" *ngIf="showSummaryError">
                    <span>{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.SUMMARY.ERROR' | translate }}</span>
                  </div>
                </div>

              </div>

              <!-- Problem -->
              <div class="project-data">
                <span class="num-rect">3</span><span class="ques">
                  {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.PROBLEM.LABEL' | translate }}
                </span>

                <div *ngIf="!canEdit" class="pd-input">
                  <div [innerHtml]="innovationCards.problem"></div>
                </div>

                <div *ngIf="adminSide && project.innovationCards?.length > 1" class="pd-input">
                  <button
                    class="btn btn-sm ghost-primary"
                    [disabled]="innovationCards.problem"
                    [ngClass]="{'disabled': innovationCards.problem}"
                    (click)="importTranslation($event, 'problem')">
                    {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.IMPORT_TRANSLATION' | translate }}
                  </button>
                </div>

                <div *ngIf="canEdit" class="form-group pd-input">
                  <app-text-zone
                    [data]="innovationCards.problem"
                    [elementId]="'problem'+innovationCards.lang"
                    (onTextChange)="updateData($event)">
                  </app-text-zone>
                  <!-- todo: add placeholders
                    [attr.placeholder]="'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.PROBLEM.PLACEHOLDER' | translate"
                  -->
                  <div class="charRemaining">
                  <span [ngStyle]="{'color': getColor(innovationCards.problem?.length | characterCountdown:1000)}">
                    {{ innovationCards.problem?.length | characterCountdown:1000 }}
                  </span>
                  </div>
                  <div class="form-error" *ngIf="showProblemError">
                    <span>{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.PROBLEM.ERROR' | translate }}</span>
                  </div>
                </div>

              </div>

              <!-- Solution -->
              <div class="project-data">
                <span class="num-rect">4</span><span class="ques">
                  {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.SOLUTION.LABEL' | translate }}
                </span>

                <div *ngIf="!canEdit" class="pd-input">
                  <div [innerHtml]="innovationCards.solution"></div>
                </div>

                <div *ngIf="adminSide && project.innovationCards?.length > 1" class="pd-input">
                  <button
                    class="btn btn-sm ghost-primary"
                    [disabled]="innovationCards.solution"
                    [ngClass]="{'disabled': innovationCards.solution}"
                    (click)="importTranslation($event, 'solution')">
                    {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.IMPORT_TRANSLATION' | translate }}
                  </button>
                </div>

                <div *ngIf="canEdit" class="form-group pd-input">
                  <app-text-zone
                    [data]="innovationCards.solution"
                    [elementId]="'solution'+innovationCards.lang"
                    (onTextChange)="updateData($event)">
                  </app-text-zone>
                  <!-- todo: add placeholders
                    [placeholder]="'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.SOLUTION.PLACEHOLDER' | translate"
                   -->
                  <div class="charRemaining">
                  <span [ngStyle]="{'color': getColor(innovationCards.solution?.length | characterCountdown:1000)}">
                    {{ innovationCards.solution?.length | characterCountdown:1000 }}
                  </span>
                  </div>
                  <div class="form-error" *ngIf="showSolutionError">
                    <span>{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.SOLUTION.ERROR' | translate }}</span>
                  </div>
                </div>

              </div>

              <!-- Advantages -->
              <div class="project-data">
                <span class="num-rect">5</span><span class="ques">
                  {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.ADVANTAGES.LABEL' | translate }}
              </span>

                <div *ngIf="!canEdit" class="pd-input">
                  <div *ngFor="let advantage of innovationCards.advantages; let i = index;" class="answer-wrapper adv-padding">
                    {{ advantage.text }}
                  </div>
                </div>

                <div *ngIf="adminSide && project.innovationCards?.length > 1" class="pd-input">
                  <button
                    class="btn btn-sm ghost-primary"
                    [disabled]="innovationCards.advantages?.length"
                    [ngClass]="{'disabled': innovationCards.advantages?.length}"
                    (click)="importTranslation($event, 'advantages')">
                    {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.IMPORT_TRANSLATION' | translate }}
                  </button>
                </div>

                <div *ngIf="canEdit" class="pd-input">
                  <app-input-list
                    (update)="addAdvantageToInventionCard($event, i)"
                    [config]="getConfig('advantages')">
                  </app-input-list>
                </div>
                <div class="form-error" *ngIf="showAdvantageError">
                  <span>{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.ADVANTAGES.ERROR' | translate }}</span>
                </div>

              </div>

            </div>
          </div>

          <!-- Project stage -->
          <div [ngStyle]="{ 'padding-top': canEdit ? '3.15rem' : '2.187rem' }">
            <span class="num-rect">6</span><span class="ques">{{ 'PROJECT_MODULE.SETUP.PITCH.STAGE' | translate }}</span>

            <div *ngIf="!canEdit" class="pd-input">
              <p *ngIf="project.projectStatus === 0">{{ 'COMMON.PROJECT_STATUS.0' | translate }}</p>
              <p *ngIf="project.projectStatus === 1">{{ 'COMMON.PROJECT_STATUS.1' | translate }}</p>
              <p *ngIf="project.projectStatus === 2">{{ 'COMMON.PROJECT_STATUS.2' | translate }}</p>
            </div>

            <div *ngIf="canEdit" class="form-group pd-input">
              <label class="form-radio">
                <input
                  type="radio"
                  name="projectStatus"
                  [(ngModel)]="project.projectStatus"
                  [value]="0"
                  (ngModelChange)="notifyModelChanges($event)">
                <i class="form-icon"></i>{{ 'COMMON.PROJECT_STATUS.0' | translate }}
              </label>
              <label class="form-radio">
                <input
                  type="radio"
                  name="projectStatus"
                  [(ngModel)]="project.projectStatus"
                  [value]="1"
                  (ngModelChange)="notifyModelChanges($event)">
                <i class="form-icon"></i>{{ 'COMMON.PROJECT_STATUS.1' | translate }}
              </label>
              <label class="form-radio">
                <input
                  type="radio"
                  name="projectStatus"
                  [(ngModel)]="project.projectStatus"
                  [value]="2"
                  (ngModelChange)="notifyModelChanges($event)">
                <i class="form-icon"></i>{{ 'COMMON.PROJECT_STATUS.2' | translate }}
              </label>
            </div>

          </div>

          <!-- Project protected -->
          <div class="project-data">
            <span class="num-rect">7</span><span class="ques">{{ 'PROJECT_MODULE.SETUP.PITCH.PATENTED.LABEL' | translate }}</span>

            <div *ngIf="!canEdit" class="pd-input">
              <p *ngIf="project.patented === false">{{ 'COMMON.NO' | translate }}</p>
              <p *ngIf="project.patented === true">{{ 'COMMON.YES' | translate }}</p>
            </div>

            <div *ngIf="canEdit" class="form-group pd-input">
              <label class="form-radio">
                <input
                  type="radio"
                  name="patented"
                  [(ngModel)]="project.patented"
                  [value]="false"
                  (ngModelChange)="notifyModelChanges($event)">
                <i class="form-icon"></i>{{ 'COMMON.NO' | translate }}
              </label>
              <label class="form-radio">
                <input
                  type="radio"
                  name="patented"
                  [(ngModel)]="project.patented"
                  [value]="true"
                  (ngModelChange)="notifyModelChanges($event)">
                <i class="form-icon"></i>{{ 'COMMON.YES' | translate }}
              </label>
              <div class="form-error" *ngIf="showPatentError">
                <span>{{ 'PROJECT_MODULE.SETUP.PITCH.PATENTED.ERROR' | translate }}</span>
              </div>
            </div>

          </div>

          <!-- Diffusion -->
          <div class="project-data">
            <span class="num-rect">8</span>
            <span class="ques">
              {{ 'PROJECT_MODULE.SETUP.PITCH.EXTERNAL_DIFFUSION.A' | translate }}
              {{ companyName }}
              {{ 'PROJECT_MODULE.SETUP.PITCH.EXTERNAL_DIFFUSION.B' | translate }}
            </span>

            <div *ngIf="!canEdit" class="pd-input">
              <p *ngIf="project.external_diffusion === false">{{ 'COMMON.NO' | translate }}</p>
              <p *ngIf="project.external_diffusion === true">{{ 'COMMON.YES' | translate }}</p>
            </div>

            <div *ngIf="canEdit" class="form-group pd-input">
              <label class="form-radio">
                <input
                  type="radio"
                  name="external_diffusion"
                  [(ngModel)]="project.external_diffusion"
                  [value]="false"
                  (ngModelChange)="notifyModelChanges($event)">
                <i class="form-icon"></i>{{ 'COMMON.NO' | translate }}
              </label>
              <label class="form-radio">
                <input
                  type="radio"
                  name="external_diffusion"
                  [(ngModel)]="project.external_diffusion"
                  [value]="true"
                  (ngModelChange)="notifyModelChanges()">
                <i class="form-icon"></i>{{ 'COMMON.YES' | translate }}
              </label>
              <div class="form-error" *ngIf="showDiffusionError">
                <span>{{ 'PROJECT_MODULE.SETUP.PITCH.EXTERNAL_DIFFUSION.ERROR' | translate }}</span>
              </div>
            </div>

          </div>

        </div>
        <!-- /Ques -->

        <!-- Help -->
        <div *ngIf="!adminSide" class="column col-6 col-mx-auto hide-md help-wrapper">
          <div class="bot-wrapper text-center">
            <span class="bot-rect">{{ 'PROJECT_MODULE.SETUP.PITCH.BOT.HELP' | translate }}</span>
            <br>
            <img
              src="https://res.cloudinary.com/umi/image/upload/v1528795403/app/default-images/bot-triangle.svg"
              class="bot-trian">
            <div>
              <img
                src="https://res.cloudinary.com/umi/image/upload/v1533567512/app/default-images/info-bot.svg"
                alt="Bot"
                class="bot-image">
            </div>
          </div>
        </div>

      </div>
      <!-- /Ques and help section -->

      <!-- Project medias -->
      <div *ngFor="let innovationItem of project.innovationCards; let i = index">
        <div *ngIf="innovationCardEditingIndex === i">

          <div class="project-data">
            <span class="num-rect">9</span>
            <span class="ques">{{ 'PROJECT_MODULE.SETUP.PITCH.MEDIA.LABEL' | translate }}</span>

            <div class="pd-input">

              <!-- Media display -->
              <ng-container *ngIf="innovationItem.media?.length > 0">
                <div class="columns col-gapless">

                  <!-- Main media -->
                  <div class="column col-md-12 col-lg-4 col-3 col-mr-auto text-center" [ngStyle]="{ 'padding-bottom': '1.2rem' }">
                    <p class="ques" [ngStyle]=" { 'font-size': '1rem' , 'padding-bottom': '.6rem', 'color': '#97A4B1' }">
                      {{ 'PROJECT_MODULE.SETUP.PITCH.MEDIA.MAIN' | translate }}
                    </p>
                    <div *ngIf="innovationItem.principalMedia?.type === 'PHOTO'">
                      <img
                        [src]="innovationItem.principalMedia.url"
                        [alt]="'COMMON.MEDIA_NOT_AVAILABLE' | translate"
                        height="146" width="220px">
                    </div>
                    <div *ngIf="innovationItem.principalMedia?.type === 'VIDEO'">
                      <iframe
                        [src]="domSanitizer.bypassSecurityTrustResourceUrl(innovationItem.principalMedia.video.embeddableUrl)"
                        height="148" width="220px">
                      </iframe>
                    </div>
                    <div *ngIf="canEdit">
                      <a class="text-link delete-link" (click)="deleteMedia($event, innovationItem.principalMedia, i)">
                        {{ 'COMMON.DELETE' | translate }}
                      </a>
                    </div>
                  </div>

                  <!-- Secondary medias -->
                  <div class="column col-md-12 col-lg-8 col-9 col-mx-auto text-center" [ngStyle]="{ 'padding-bottom': '1.2rem' }">
                    <p class="ques" [ngStyle]=" { 'font-size': '1rem' , 'padding-bottom': '.6rem', 'color': '#97A4B1' }">
                      {{ 'PROJECT_MODULE.SETUP.PITCH.MEDIA.SECONDARY' | translate }}
                    </p>
                    <span *ngFor="let media of innovationItem.media" class="media-content text-center">
                      <div *ngIf="innovationItem.principalMedia?._id !== media._id" class="media">
                        <img
                          *ngIf="media.type === 'PHOTO'"
                          [src]="'https://res.cloudinary.com/umi/image/upload/' + (media.cloudinary ? media.cloudinary.public_id : 'app/no-image.png')"
                          [alt]="'COMMON.MEDIA_NOT_AVAILABLE' | translate"
                          height="146" width="220px">
                        <iframe
                          *ngIf="media.type === 'VIDEO'"
                          [src]="domSanitizer.bypassSecurityTrustResourceUrl(media.video.embeddableUrl)"
                          width="220" height="148">
                        </iframe>
                        <div
                          *ngIf="canEdit && media._id !== innovationItem.principalMedia?._id"
                          class="media-action text-center">
                            <a class="text-link" (click)="setMediaAsPrimary($event, media, i)">
                              {{ 'PROJECT_MODULE.SETUP.PITCH.MEDIA.MAKE_MAIN' | translate }}
                            </a>
                        </div>
                        <div *ngIf="canEdit" [ngStyle]=" { 'padding-bottom': '1.2rem' }">
                          <a class="text-link delete-link" (click)="deleteMedia($event, media, i)">
                            {{ 'COMMON.DELETE' | translate }}
                          </a>
                        </div>
                      </div>
                    </span>
                  </div>

                </div>
              </ng-container>
              <!-- /Media display -->

              <!-- Uploading center -->
              <div *ngIf="canEdit" class="upload-wrapper">
                <div class="image-upload-wrapper">
                  <app-shared-upload-zone-photo
                    [uri]="'/innovation/'+project._id+'/innovationCard/'+innovationItem._id+'/media/image'"
                    (cbFn)="imageUploaded($event, i)">
                  </app-shared-upload-zone-photo>
                </div>
                <div class="or-wrapper">
                  <span class="para">{{ 'COMMON.OR' | translate }}</span>
                </div>
                <div class="video-upload-wrapper">
                  <app-shared-upload-zone-video
                    (cbFn)="newOnlineVideoToAdd($event)">
                  </app-shared-upload-zone-video>
                </div>
              </div>
              <!-- /Uploading center -->

            </div>
          </div>
        </div>
      </div>
      <!-- /Project medias -->

      <!-- Delete language button -->
      <div *ngIf="project.innovationCards?.length > 1 && canEdit" class="project-data">
        <button
          class="btn btn-sm ghost-delete"
          (click)="deleteModal(project.innovationCards[innovationCardEditingIndex]._id, project.innovationCards[innovationCardEditingIndex].lang)">
          {{ 'PROJECT_MODULE.SETUP.PITCH.DELETE_LANGUAGE' | translate }}
        </button>
      </div>

    </div>
  </form>
</section>

<!-- Modal to ask user to sure about deleting the innov card the project -->
<div class="modal" [ngClass]="{ 'active': showDeleteModal }">
  <div class="modal-overlay" (click)="closeModal($event)"></div>
  <div class="modal-container">
    <div class="modal-header">
      <button class="btn btn-clear float-right" (click)="closeModal($event)"></button>
      <div class="modal-title">{{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.MODAL_DELETE.TITLE' | translate }}</div>
    </div>
    <div class="modal-body">
      <div class="content">
        {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.MODAL_DELETE.CONTENT.A' | translate }}
        {{ 'COMMON.LANG.' + langDelete | uppercase | translate }}
        {{ 'PROJECT_MODULE.SETUP.PITCH.DESCRIPTION.MODAL_DELETE.CONTENT.B' | translate }}
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-sm btn-primary" (click)="deleteInnovCard($event)">
        {{ 'COMMON.SUBMIT' | translate }}
      </button>
    </div>
  </div>
</div>

