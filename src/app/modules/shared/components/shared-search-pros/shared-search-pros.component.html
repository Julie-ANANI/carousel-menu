<div id="shared-search-pros" class="w-full">

  <!-- search wrapper -->
  <div *ngIf="canAccess(['launch', 'cat'])" class="search-wrapper">

    <!-- heading -->
    <div class="heading-wrapper">

      <h2 class="title-secondary">Rocket Testing</h2>

      <span class="text-link text-sm" (click)="onReset()">Reset</span>

      <span class="line">|</span>

      <div class="popover is-bottom">
        <span class="text-help">Help</span>
        <div class="popover-container">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-center">
                <div class="shape is-circled is-xs bg-success"></div>
                <span>Relevant</span>
              </div>
              <div class="d-flex align-center">
                <div class="shape is-circled is-xs bg-progress"></div>
                <span>Average</span>
              </div>
              <div class="d-flex align-center">
                <div class="shape is-circled is-xs bg-alert"></div>
                <span>Overused</span>
              </div>
              <div class="d-flex align-center">
                <div class="icons icons-delete"><i class="fas fa-exclamation-triangle"></i></div>
                <span>Too much pros duplicated</span>
              </div>
              <hr class="hr m-top-10 m-bottom-10">
              <ul>
                <li>No capital letters or "s".</li>
                <li>Numbers can't be processed.</li>
                <li>Please enter at least 2 requests.</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    </div>
    <!-- /heading -->

    <!-- request -->
    <div class="">

    </div>
    <!-- /request -->

    <!-- input -->
    <div class="input-wrapper">

      <div class="form-group">
        <label>
            <textarea
              [(ngModel)]="params['catKeywords']"
              class="form-input"
              name="cat-keywords"
              placeholder="Search here using Computer Aided Targeting. One request per line."
              rows="5"
              type="text">
            </textarea>
        </label>
        <span
          (click)="onClickSearchCat($event)"
          *ngIf="params['catKeywords']"
          [attr.data-tooltip]="'Search'"
          class="search-button-wrapper tooltip">
              <i class="fas fa-search"></i>
            </span>
      </div>

      <div class="remaining-wrapper">
        <div class="d-flex align-center">
          <span [ngClass]="getCatCircleClass()" class="shape is-circled is-xs"></span>
          <span>Search Requests</span>
        </div>
        <div>Remaining for today: {{ catQuota }}</div>
      </div>

    </div>
    <!-- /input -->

    <!-- loader -->
    <div *ngIf="displayLoader" class="loader-wrapper">
      <div class="loading is-primary is-lg"></div>
    </div>
    <!-- /loader -->

    <!-- display cat result -->
    <div *ngIf="catProcessDone && !displayLoader">

      <!-- analysis -->
      <div class="analysis-wrapper">

        <div class="heading-wrapper">
          <h2 class="title-secondary">Analysis</h2>
          <div
            *ngIf="catResult && catResult['duplicate_status'] && catResult['duplicate_status'] !== 'ok'"
            class="icon is-delete">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
        </div>

        <div class="analysis-content">
          <ul>
            <li *ngFor="let suggestion of suggestions">
              <div class="d-flex"><span class="text-pros">
                  {{ suggestion.expected_result }} pros</span>
                <div [innerHTML]="suggestion.search_keywords"></div>
              </div>
              <div
                (click)="onClickPlus(suggestion.keywords)"
                [ngStyle]="{ 'visibility':  checkKeywords(suggestion.keywords) }">
                <i class="fas fa-plus-circle"></i>
              </div>
            </li>
          </ul>
        </div>

      </div>
      <!-- /analysis -->

      <!-- suggested -->
      <div class="suggested-wrapper">

        <div class="heading-wrapper">
          <h2 class="title-secondary">Suggested Keywords</h2>
        </div>

        <div class="suggested-content">
          <ul>
            <li *ngFor="let keyword of catResult['new_keywords']">
              {{ keyword }}
            </li>
          </ul>
        </div>

      </div>
      <!-- /suggested -->

      <!-- star profiles -->
      <div class="profile-wrapper">

        <div class="heading-wrapper">
          <h2 class="title-secondary">4 Star Profiles</h2>
        </div>

        <div class="profile-content">
          <ul>
            <li *ngFor="let profile of catResult.profile | keyvalue">
              <div class="popover">
                <a [href]="profile.key" target="_blank">
                  <span class="text-title">{{ profile.value.title }}</span>
                </a>
                <div class="popover-container">
                  <div class="card">
                    <div class="card-body">
                        <span *ngIf="profile.value && profile.value['snippet']">
                          {{ profile.value['snippet'] }}
                        </span>
                    </div>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </div>

      </div>
      <!-- /star profiles -->

    </div>
    <!-- /display cat result -->

  </div>
  <!-- /search wrapper -->

  <!-- search wrapper -->
  <div *ngIf="canAccess(['launch', 'search'])" class="search-wrapper">

    <!-- requests -->
    <div class="w-full d-flex align-center m-top-20">
      <span class="text-pre text-15 text-bold">Requests</span>
      <div class="line m-left-4"></div>
    </div>
    <!-- /requests -->

    <!-- input -->
    <div class="input-wrapper w-half">

      <div class="form-group">
        <label>
            <textarea
              (ngModelChange)="estimateNumberOfGoogleRequests()"
              [(ngModel)]="params['keywords']"
              class="form-input"
              name="keywords"
              placeholder="Search here like 'Google'. One request per line."
              rows="5"
              type="text">
            </textarea>
        </label>
      </div>

      <div class="remaining-wrapper">
        <div class="d-flex align-center">
          <span [ngClass]="getCircleClass()" class="shape is-circled is-xs"></span>
          <span>Remaining requests: {{ googleQuota }}</span>
        </div>
      </div>

    </div>
    <!-- /input -->

    <!-- settings -->
    <div class="w-full d-flex align-center m-top-20"
         *ngIf="canAccess(['view', 'settings']) || canAccess(['edit', 'settings'])">
      <span class="text-pre text-15 text-bold">Settings</span>
      <div class="line m-left-4"></div>
    </div>
    <!-- /settings -->

    <div class="settings w-full">
      <app-shared-search-settings
        (paramsChange)="updateSettings($event)"
        [isEditable]="canAccess(['edit', 'settings'])"
        [params]="params">
      </app-shared-search-settings>
    </div>

    <!-- geographic targeting -->
    <div class="w-full d-flex align-center m-top-20"
         *ngIf="canAccess(['view', 'settings']) || canAccess(['edit', 'settings'])">
      <span class="text-pre text-15 text-bold">Geographic targeting</span>
      <div class="line m-left-4"></div>
    </div>
    <!-- /geographic targeting  -->

    <div class="geographic-targeting w-full">
      <!-- targeting countries -->
      <div class="p-30">
        <app-shared-targeting-world
          [(geography)]="geography"
          [isShowSearch]="true"
          [isEditable]="canAccess(['edit', 'settings'])">
        </app-shared-targeting-world>
      </div>
      <!-- /targeting countries-->
    </div>

    <!-- professional targeting -->
    <div class="w-full d-flex align-center m-top-20">
      <span class="text-pre text-15 text-bold">Professional targeting</span>
      <div class="line m-left-4"></div>
    </div>

    <div class="w-full">
      <!--       Professional targeting - buttons  -->
      <div class="button-group d-flex justify-center align-center m-auto m-top-4">

        <!-- Saved targetedPro  -->
        <div class="text-center">
          <button
            class="button is-outlined is-sm br-6 m-10 badge badge-icon tooltip is-multiline is-bottom" type="button"
            [attr.data-tooltip] = "'Allow to save the state of all tags and the choice of the logical operator in order to keep this professional targeting for next requests.'"
            (click)="saveProTargeting()"
            [ngClass]="{'badge-active': toSave}">
            <i class="fas fa-save" *ngIf="toSave"></i>
            Save
          </button>
        </div>
        <!-- /Saved targetedPro  -->

        <!-- Preview saved targetedPro  -->
        <button class="button br-6 is-sm is-outlined m-10 tooltip is-multiline is-right"
                [attr.data-tooltip] = "'Allow to preview the saved professional targeting without changing your current.'"
                (click)="previewSearchConfig()">
          Preview
        </button>
        <!-- /Preview saved targetedPro  -->

        <!-- Reset targetedPro  -->
        <button class="button br-6 is-sm is-outlined m-10 tooltip is-multiline is-right"
                [attr.data-tooltip] = "'Allow to replace your current professional targeting with the saved one.'"
                (click)="resetTargetedPros()">
          Apply
        </button>
        <!-- /Reset targetedPro  -->

        <button class="button is-link how-it-works text-underline tooltip is-multiline is-left"
                [attr.data-tooltip]="'1. A SL tag has 2 different states : include and exclude.\n' +
    ' - Click on a tag to change its state by the other state\n' +
    '2. A TJ tag has 3 different states : include, exclude and neutral\n' +
    ' - Click on a tag to change its state according to the following cycle : ' +
    'Neutral -> Include -> Exclude ->Neutral -> ...'">
          How it works?
        </button>

      </div>
      <!-- /Professional targeting - buttons  -->

      <app-shared-professional-targeting *ngIf="canAccess(['edit', 'targetPros'])">
      </app-shared-professional-targeting>

    </div>
    <!-- /professional targeting  -->

    <div class="m-top-3 text-center">
      <span class="text-alert text-sm">
        <span *ngIf="errorMessageLaunch"> {{ errorMessageLaunch }} </span>
      </span>
    </div>

    <div class="form-group m-top-20 d-flex"
         (click)="onClickSearch($event)">
      <button class="button is-primary is-lg m-auto" [disabled]="errorMessageLaunch || !params['keywords']">Launch</button>
    </div>

  </div>
  <!-- /search wrapper -->

</div>

<!-- MODAL : preview saved targetedPro -->
<umius-modal
  [(showModal)]="isPreview"
  [maxWidth]="'90%'"
  [title]="'Preview - Professional targeting'">

  <section class="modal-body" *ngIf="canAccess(['edit', 'targetPros'])">
    <app-shared-professional-targeting
      [isPreview]="true"
      [targetedProsToUpdate]="initialTargetedPro">
    </app-shared-professional-targeting>
  </section>

  <footer class="modal-footer">
    <button class="button modal-cancel" (close)="closePreview()">Close</button>
  </footer>

</umius-modal>
<!-- /MODAL : preview saved targetedPro -->

<!-- MODAL : save/apply -->
<umius-modal
  [(showModal)]="isShowModal">
  <header class="p-top-20 text-center text-dark text-bold bg-white">
    {{saveApplyModalTitle}}
  </header>

  <section class="modal-body text-center">
    {{saveApplyModalContext}}
  </section>

  <footer class="modal-footer d-flex justify-center">
    <button class="button modal-cancel p-10" (click)="cancelSaveReset()">Cancel</button>
    <button class="button  p-10" (click)="confirmSaveReset()">Confirm</button>
  </footer>

</umius-modal>
<!-- MODAL : save/apply -->


