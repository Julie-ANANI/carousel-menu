<shared-answer-modal [(modalAnswer)]="modalAnswer" [innoid]="innoid"></shared-answer-modal>
<div class="market-report" *ngIf="canShow()">

  <h1 id="title">{{infographics.title}}</h1>
  <p class="subtitle">{{ 'MARKET_REPORT.TITLE' | translate }}</p>
  <div *ngIf="authService.adminLevel > 2" class="admin-buttons">
    <button type="button"
            class="btn btn-lg btn-primary"
            (click)="recalculateSynthesis()"
            [disabled]="calculating"
            [ngClass]="{'loading': calculating, '': !calculating}"
    >
      {{'MARKET_REPORT.BTN_RECOMPUTE' | translate}}
      <i class="fa fa-refresh" aria-hidden="true"></i>
    </button>
    <button type="button" class="btn btn-lg btn-primary"
            (click)="toggleEditionMode()">
      {{(editionMode ? 'MARKET_REPORT.BTN_VIEW_MODE' : 'MARKET_REPORT.BTN_EDITION_MODE') | translate}}
      <i class="fa" aria-hidden="true"
         [ngClass]="{'fa-eye': editionMode, 'fa-edit': !editionMode}"></i>
    </button>
  </div>
  <div class="admin-buttons">
    <pdf-generator class="btn btn-lg btn-primary" [model]="getModel()" style="margin:10px;">
    </pdf-generator>
  </div>

  <!-- *********************************************************
        Sidebar
  ************************************************************** -->

  <div class="sidebar sidebarIsSticky">
    <div (click)="toggleDetails()" class="toggle-sections">
      {{ (showDetails ? 'MARKET_REPORT.COLLAPSE' : 'MARKET_REPORT.EXPAND') | translate}}
      <i class="fa float-right" aria-hidden="true"
         [ngClass]="{'fa-plus-square-o': !showDetails, 'fa-minus-square-o': showDetails}"></i>
    </div>
    <ul>
      <li>
        <a pageScroll href="#professionals">
          {{ infographics.professionals.title[lang] }}
          <i class="fa fa-angle-right float-right" aria-hidden="true"></i>
        </a>
      </li>
      <li *ngFor="let question of infographics.questions">
        <a pageScroll [href]="'#' + question.id">
          {{ question.title[lang] }}
          <i class="fa fa-angle-right float-right" aria-hidden="true"></i>
        </a>
      </li>
    </ul>
  </div>

  <div class="flex-container">
    <div class="sidebar"></div>
    <div class="content">
      <!-- La carte du monde et la liste des pros -->
      <market-report-section
        [info]="infographics.professionals"
        [answers]="infographics.answers"
        [showDetails]="showDetails"
        [readonly]="!editionMode"
        (modalAnswerChange)="seeAnswer($event)">
      </market-report-section>

      <!-- Les autres questions -->
      <div *ngFor="let question of infographics.questions">
        <market-report-section
          [info]="question"
          [answers]="infographics.answers"
          [showDetails]="showDetails"
          [readonly]="!editionMode"
          (modalAnswerChange)="seeAnswer($event)">
        </market-report-section>
      </div>
  </div>
</div>
