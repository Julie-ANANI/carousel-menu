<section id={{id}}>
  <h2>{{ 'MARKET_REPORT.' + i18n + '.TITLE' | translate }}</h2>

  <div class="white-frame">
    <div class="flex-container">
      <!--======= Pie Chart =======-->
      <market-report-piechart
        *ngIf="type==='pie'"
        [pieChartData]="chartValues"
        [configuration]="configurations[id]"
        [percentage]="info.percentage"
      ></market-report-piechart>
      <!--======= ou Encadré Bleu =======-->
      <market-report-bluesquare
        *ngIf="type!='pie'"
        [numberFocus]="info.numberFocus"
        [i18n]="i18n"
        [percentage]="info.percentage"
        [type]="type"
      ></market-report-bluesquare>

      <!--======= Conclusion =======-->
      <div class="umi-synthesis flex-container">
        <p class="title">{{ 'MARKET_REPORT.' + i18n + '.QUESTION' | translate }}</p>
        <text-zone [elementId]="key"
                   [readonly]="readonly"
                   [data]="info.conclusion || ''"
                   (onEditorKeyup)="keyupHandlerFunction($event)"></text-zone>
      </div>
    </div>

    <!--======= Map du monde =======-->
    <div class="bloc" *ngIf="type === 'pros'">
      <div class="map centered" width="684" height="339">
        <world-map [countries]="info.data" [color]="'#0B90C6'"></world-map>
      </div>
    </div>

    <!--======= Scores =======-->
    <div class="bloc" *ngIf="type === 'score'">
      <div class="column-graph flex-container">
        <div *ngFor="let score of info.data; let i = index"
             class="vertical-bar number{{score.value}}">
          <div class="bar-fill" [style.height]="getFillPerc(score.count)" *ngIf="score.count"></div>
          <div class="bar-stats" *ngIf="score.count">{{score.count}}</div>
          <div class="bar-picture" *ngIf="score.count"></div>
          <div class="bar-score">{{score.value}}/10</div>
        </div>
      </div>
    </div>

    <!--======= Prix =======-->
    <div class="bloc" id="prices" *ngIf="info.priceverage && type === 'prices'">
      <app-shared-infographics-prices [rawData]="info.data"></app-shared-infographics-prices>

      <div class="average">Moyenne : {{info.priceverage}}€</div>
    </div>

    <!--======= Bouton plier/déplier =======-->
    <button type="button" class="market-report-btn centered"
            *ngIf="type!='score'"
            [ngClass]="{'active': showDetails}"
            (click)="toggleDetails()">
      {{(showDetails ? 'MARKET_REPORT.BTN_DETAILS_CLOSE' : 'MARKET_REPORT.BTN_DETAILS_OPEN') | translate}}
      <i class="fa" aria-hidden="true"
         [ngClass]="{'fa-angle-up': showDetails, 'fa-angle-down': !showDetails}"></i>
    </button>

    <!--************************************************
                    SECTION DETAILS
    **************************************************-->
    <div class="bloc details" *ngIf="showDetails">

      <!--======= Liste des pros =======-->
      <div *ngIf="type === 'pros'" class="prosList">
        <div *ngFor="let answer of answers" class="professional-item" [ngClass]="{'top-profil': answer.profileQuality === 2}">
          <img [src]="getFlag(answer.country.notation)"
               alt="" width="37" height="25" class="user-flag">

          <p class="user-name" *ngIf="answer.professional.profileUrl">
            <a target="_blank">
              {{answer.professional.firstName}} {{answer.professional.lastName}}
            </a>
          </p>
          <p class="user-name" *ngIf="!answer.professional.profileUrl">
            {{answer.professional.firstName}} {{answer.professional.lastName}}
            <img src="http://res.cloudinary.com/umi/image/upload/c_scale,h_15/app/star.svg" alt="" width="15" height="15" *ngIf="answer.follow" attr.tooltip-placement="top" attr.tooltip="{{ 'MARKET_REPORT.PROFESSIONAL.FOLLOW_PLURAL' | translate }}">
          </p>

          <p class="user-job"><i class="fa fa-user" aria-hidden="true"></i> {{answer.job}}</p>
          <p *ngIf="answer.professional.company" class="user-company"><i class="fa fa-building-o" aria-hidden="true"></i> {{answer.professional.company}}</p>

          <a href="" (click)="seeAnswer(answer)" class="see-answer">{{ 'MARKET_REPORT.SEE_ANSWERS' | translate }}</a><br>
          <a href="mailto: {{answer.professional.email}}">{{answer.professional.email}}</a>
        </div>
      </div>

      <!--======= Bar Chart =======-->
      <bar-chart
        *ngIf="type === 'pie'"
        [levels]="getLevels('en')"
        [stats]="info.pieChart"
        [number]="true">
      </bar-chart>

      <!--======= Concurrents =======-->
      <div class="flex-container" *ngIf="type === 'competitors'">
        <div class="column">
          <ul class="items">
            <li *ngFor="let competitor of competitors; let i = index"
                [hidden]="i >= competitors.length/2"
                [ngClass]="{'top-profil': competitor.quality === 2}">
              <market-item class="flex-container"
                           [answers]="getAnswers(competitor.answers)"
                           [value]="competitor.value"
                           [count]="competitor.count"
                           [url]="competitor.url"
                           [isNew]="false">
              </market-item>
            </li>
          </ul>
        </div>
        <div class="column">
          <ul class="items">
            <li *ngFor="let competitor of competitors; let i = index"
                [hidden]="i < competitors.length/2"
                [ngClass]="{'top-profil': competitor.quality === 2}">
              <market-item class="flex-container"
                           [answers]="getAnswers(competitor.answers)"
                           [value]="competitor.value"
                           [count]="competitor.count"
                           [url]="competitor.url"
                           [isNew]="false">
              </market-item>
            </li>
          </ul>
        </div>
      </div>

      <!--======= Applications =======-->
      <div class="flex-container" *ngIf="type === 'applications'">
        <div class="column">
          <ul class="items">
            <li *ngFor="let application of applications; let i = index"
                [hidden]="i >= applications.length/2"
                [ngClass]="{'top-profil': application.quality === 2}">
              <market-item class="flex-container"
                           [answers]="getAnswers(application.answers)"
                           [value]="application.value"
                           [count]="application.count"
                           [isNew]="false">
              </market-item>
            </li>
          </ul>
        </div>
        <div class="column">
          <ul class="items">
            <li *ngFor="let application of applications; let i = index"
                [hidden]="i < applications.length/2"
                [ngClass]="{'top-profil': application.quality === 2}">
              <market-item class="flex-container"
                           [answers]="getAnswers(application.answers)"
                           [value]="application.value"
                           [count]="application.count"
                           [isNew]="false">
              </market-item>
            </li>
          </ul>
        </div>
      </div>

      <!--======= Marques d'intérêt =======-->

      <div *ngIf="type === 'interest' && interestOfProfessionals.client.length">
        <p class="title-question">{{ 'MARKET_REPORT.EXPRESSION_OF_INTEREST.CLIENT' | translate }}</p>

        <div class="flex-container">
          <div class="column">
            <ul class="items">
              <li *ngFor="let client of interestOfProfessionals.client; let i = index"
                  [hidden]="i >= interestOfProfessionals.client.length/2"
                  [ngClass]="{'top-profil': client.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(client.answers)"
                             [value]="client.value"
                             [count]="client.count"
                             [url]="client.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
          <div class="column">
            <ul class="items">
              <li *ngFor="let client of interestOfProfessionals.client; let i = index"
                  [hidden]="i < interestOfProfessionals.client.length/2"
                  [ngClass]="{'top-profil': client.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(client.answers)"
                             [value]="client.value"
                             [count]="client.count"
                             [url]="client.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div *ngIf="type === 'interest' && interestOfProfessionals.develop.length">
        <p class="title-question">{{ 'MARKET_REPORT.EXPRESSION_OF_INTEREST.DEVELOP' | translate }}</p>

        <div class="flex-container">
          <div class="column">
            <ul class="items">
              <li *ngFor="let develop of interestOfProfessionals.develop; let i = index"
                  [hidden]="i >= interestOfProfessionals.develop.length/2"
                  [ngClass]="{'top-profil': develop.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(develop.answers)"
                             [value]="develop.value"
                             [count]="develop.count"
                             [url]="develop.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
          <div class="column">
            <ul class="items">
              <li *ngFor="let develop of interestOfProfessionals.develop; let i = index"
                  [hidden]="i < interestOfProfessionals.develop.length/2"
                  [ngClass]="{'top-profil': develop.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(develop.answers)"
                             [value]="develop.value"
                             [count]="develop.count"
                             [url]="develop.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div *ngIf="type === 'interest' && interestOfProfessionals.distributor.length">
        <p class="title-question">{{ 'MARKET_REPORT.EXPRESSION_OF_INTEREST.DISTRIBUTE' | translate }}</p>

        <div class="flex-container">
          <div class="column">
            <ul class="items">
              <li *ngFor="let distributor of interestOfProfessionals.distributor; let i = index"
                  [hidden]="i >= interestOfProfessionals.distributor.length/2"
                  [ngClass]="{'top-profil': distributor.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(distributor.answers)"
                             [value]="distributor.value"
                             [count]="distributor.count"
                             [url]="distributor.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
          <div class="column">
            <ul class="items">
              <li *ngFor="let distributor of interestOfProfessionals.distributor; let i = index"
                  [hidden]="i < interestOfProfessionals.distributor.length/2"
                  [ngClass]="{'top-profil': distributor.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(distributor.answers)"
                             [value]="distributor.value"
                             [count]="distributor.count"
                             [url]="distributor.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div *ngIf="type === 'interest' && interestOfProfessionals.invest.length">
        <p class="title-question">{{ 'MARKET_REPORT.EXPRESSION_OF_INTEREST.INVEST' | translate }}</p>

        <div class="flex-container">
          <div class="column">
            <ul class="items">
              <li *ngFor="let investor of interestOfProfessionals.invest; let i = index"
                  [hidden]="i >= interestOfProfessionals.invest.length/2"
                  [ngClass]="{'top-profil': investor.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(investor.answers)"
                             [value]="investor.value"
                             [count]="investor.count"
                             [url]="investor.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
          <div class="column">
            <ul class="items">
              <li *ngFor="let investor of interestOfProfessionals.invest; let i = index"
                  [hidden]="i < interestOfProfessionals.invest.length/2"
                  [ngClass]="{'top-profil': investor.quality === 2}">
                <market-item class="flex-container"
                             [answers]="getAnswers(investor.answers)"
                             [value]="investor.value"
                             [count]="investor.count"
                             [url]="investor.url"
                             [isNew]="false">
                </market-item>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!--======= Partenaires potentiels =======-->
      <div class="flex-container" *ngIf="type==='partners'">
        <div class="column">
          <ul class="items">
            <li *ngFor="let partner of partnersByProfessionals; let i = index"
                [hidden]="i >= partnersByProfessionals.length/2"
                [ngClass]="{'top-profil': partner.quality === 2}">
              <market-item class="flex-container"
                           [answers]="getAnswers(partner.answers)"
                           [value]="partner.value"
                           [count]="partner.count"
                           [url]="partner.url"
                           [isNew]="false">
              </market-item>
            </li>
          </ul>
        </div>
        <div class="column">
          <ul class="items">
            <li *ngFor="let partner of partnersByProfessionals; let i = index"
                [hidden]="i < partnersByProfessionals.length/2"
                [ngClass]="{'top-profil': partner.quality === 2}">
              <market-item class="flex-container"
                           [answers]="getAnswers(partner.answers)"
                           [value]="partner.value"
                           [count]="partner.count"
                           [url]="partner.url"
                           [isNew]="false">
              </market-item>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!--======= Liste de commentaires =======-->
    <div *ngIf="showDetails && comments && comments.length > 0">
      <p class="title-question">{{comments.length}} {{ 'MARKET_REPORT.COMMENTS' | translate }}</p>
      <ul class="comments">
        <li *ngFor="let comment of comments"
            [ngClass]="{'top-profil': comment.quality === 2}">
          <market-comment
            [job]="comment.job"
            [country]="comment.flag"
            [company]="comment.company"
            [comment]="comment.comment"
            [isNew]="false"
            [answers]="getAnswers([comment])">
          </market-comment>
        </li>
      </ul>
    </div>
  </div>
</section>
