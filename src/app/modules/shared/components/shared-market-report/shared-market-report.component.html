<ng-container *ngIf="innovation">
  <div id="market-report">


    <!-- project status not done at client side -->
    <ng-container *ngIf="innovation?.status !== 'DONE' && !adminSide && !previewMode">
      <section [ngStyle]="{ 'background-color': '#FFFFFF' }">
        <div class="section-light-pad rm-pad-bottom">
          <div class="column col-xs-12 col-11 col-mx-auto">

            <h1 class="title-primary">{{ 'MARKET_REPORT.TITLE'  | translate }}</h1>

            <div class="section-light-pad rm-pad-bottom">

              <app-message-template-1 [widthMax]="'337px'">
                <span>{{ getMessage() | translate }}</span>
              </app-message-template-1>

            </div>

          </div>
        </div>
      </section>
    </ng-container>
    <!-- /project status not done at client side -->


    <!-- project status not submitted admin side -->
    <ng-container *ngIf="innovation.status === 'EDITING' && adminSide">
      <section class="section-pad rm-pad-bottom">
        <div class="column col-xs-12 col-11 col-mx-auto">
          <app-message-template-1 [widthMax]="'337px'">
            <span>{{ 'MARKET_REPORT.MESSAGE_ADMIN.NOT_SUBMITTED' | translate }}</span>
          </app-message-template-1>
        </div>
      </section>
    </ng-container>
    <!-- /project status not submitted admin side -->


    <!-- project status done or preview mode or not editing -->
    <ng-container *ngIf="innovation.status === 'DONE' || previewMode || (innovation.status !== 'EDITING' && adminSide)" >
      <div [ngStyle]="{ 'background-color': '#F5F5F5', 'margin-bottom': adminSide ? '0' : '-2.5rem' }" id="market-report-container">
        <div class="restrict-width">
          <div class="columns col-gapless">


            <!-- filter sidebar -->
            <aside class="column col-xs-12 col-sm-12 col-lg-3 col-2 filter-wrapper">
              <app-market-report-sidebar
                [answers]="answers"
                [innovation]="innovation"
                [reportShared]="reportShared"
                [isAdmin]="adminMode"
                [isAdminSide]="adminSide"
                [isOwner]="isOwner"
                [questions]="questions">
              </app-market-report-sidebar>
            </aside>
            <!-- /filter sideBar -->


            <!-- answers section -->
            <section id="answer-wrapper" class="column col-xs-12 col-sm-11 col-8">


              <!-- main page goal -->
              <ng-container *ngIf="adminSide">
                <section class="section-pad" id="innovation-goal">
                  <div class="section-light-pad bg-white full-light">

                    <h2 class="title-primary">Objective</h2>

                    <div class="form-group relative">

                      <label for="market-report-objective"></label>

                      <textarea
                        (blur)="updateExecutiveReport($event)"
                        [(ngModel)]="innovation.executiveReport.objective"
                        placeholder="Describe the objective of this innovation within 120 words."
                        class="form-input"
                        id="market-report-objective"
                        maxlength="120"
                        rows="5">
                      </textarea>

                      <div class="char-remaining" [ngStyle]="{ 'color': getColor((innovation.executiveReport?.objective.length | characterCountdown:120), 120) }">
                        <span>{{ innovation.executiveReport?.objective.length | characterCountdown:120 }}</span>
                      </div>

                    </div>

                  </div>
                </section>
              </ng-container>
              <!-- /main page goal -->


              <!-- executive report generation -->
              <ng-container *ngIf="adminSide">
                <section class="section-pad" id="executive-generate">
                  <div class="section-pad full d-flex executive-generate-wrapper bg-white">

                    <h2 class="title-primary">Executive Report</h2>

                    <div class="template-outer-wrapper d-flex">
                      <div *ngFor="let template of executiveTemplates" class="card is-responsive">

                        <img [src]="template.imageSrc" alt=" ">

                        <div class="card-header text-center">
                          <div class="btn btn-radio" [ngClass]="{ 'active': numberOfSections === template.value }"
                               (click)="assignSectionValue($event, template.value)">
                            <span>•</span>
                          </div>
                        </div>

                      </div>
                    </div>

                    <div class="text-center" [ngStyle]="{ 'margin-top': '0.5rem' }">
                      <button class="btn ghost-primary btn-sm"
                              [disabled]="numberOfSections === 0 || innovation.executiveReport.totalSections > 0"
                              (click)="generateExecutiveTemplate($event)">
                        Valid template
                      </button>
                    </div>

                  </div>
                </section>
              </ng-container>
              <!-- /executive report generation -->


              <!-- main page -->
              <div id="main-page" class="d-none">
                <app-shared-main-page [project]="innovation"></app-shared-main-page>
              </div>
              <!-- /main page -->


              <!-- umi intro -->
              <div *ngIf="domainName === 'umi'" class="d-none" id="umi-intro">
                <img [src]="introSrc" alt="UMI">
              </div>
              <!-- /umi intro -->


              <!-- executive report -->
              <ng-container *ngIf="innovation.executiveReport && innovation.executiveReport.totalSections">
                <section *ngIf="innovation.executiveReport.totalSections > 0 && !reportShared" id="executive-report" class="section-light-pad">
                  <app-shared-executive-report [project]="innovation"></app-shared-executive-report>
                </section>
              </ng-container>
              <!-- /executive report -->


              <!-- key learning section -->
              <ng-container *ngIf="innovation.marketReport?.keyLearning?.conclusion.length > 0 || adminSide">
                <section class="section-pad" id="key-learnings" [ngClass]="{ 'rm-pad-top': reportShared }">
                  <div class="section-pad full key-learning-wrapper bg-white text">

                    <h2 class="title-primary" [innerText]="'MARKET_REPORT.KEY_LEARNING'" translate></h2>

                    <h6 *ngIf="mainDomain" class="op-text" [innerText]="'COMMON.UMI_WORD'" translate></h6>

                    <app-text-zone
                      [readonly]="!adminSide"
                      [data]="innovation.marketReport?.keyLearning?.conclusion"
                      (onTextChange)="saveOperatorComment($event, 'keyLearning')">
                    </app-text-zone>

                  </div>
                </section>
              </ng-container>
              <!-- /key learning section -->


              <!-- origin comment and professional responses -->
              <section class="section-pad" id="origin-responses" [ngClass]="{ 'rm-pad-top': reportShared && innovation.marketReport?.keyLearning?.conclusion.length === 0 }">
                <div class="origin-wrapper bg-white text">
                  <app-question-conclusion
                    [innovation]="innovation"
                    [question]="{ identifier: 'professionals',
                    subtitle: { en: 'professionals', fr: 'professionnels' },
                    title: { en: 'Origin of responses', fr: 'Origine des réponses' } }"
                    [readonly]="!adminSide"
                    [originAnswers]="answersOrigins"
                    [stats]="{ nbAnswers: answers.length, percentage: 0 }">
                  </app-question-conclusion>
                </div>
              </section>
              <!-- /origin comment and professional responses -->


              <!-- professional abstract -->
              <ng-container *ngIf="adminSide">
                <section class="abstract-wrapper">
                  <div class="section-light-pad full-light bg-white text">

                    <h2 class="title-primary">Professional Abstract</h2>

                    <div class="form-group relative">

                      <label for="market-report-professionals"></label>

                      <textarea
                        (blur)="updateExecutiveReport($event)"
                        [(ngModel)]="innovation.executiveReport.professionalAbstract"
                        placeholder="Describe the professional abstract of this innovation within 160 words."
                        class="form-input"
                        id="market-report-professionals"
                        maxlength="160"
                        rows="5">
                      </textarea>

                      <div class="char-remaining"
                           [ngStyle]="{ 'color': getColor((innovation.executiveReport?.professionalAbstract.length | characterCountdown:160), 160) }">
                        <span>{{ innovation.executiveReport?.professionalAbstract.length | characterCountdown:160 }}</span>
                      </div>

                    </div>

                  </div>
                </section>
              </ng-container>
              <!-- /professional abstract -->


              <!-- map -->
              <section class="section-light-pad" id="map">
                <div class="map-wrapper">
                  <app-shared-worldmap [countriesData]="answersByCountries"></app-shared-worldmap>
                </div>
              </section>
              <!-- /map -->


              <!-- professionals -->
              <section class="section-pad" id="professionals">

                <div class="text-center">
                  <button type="button" class="btn btn-primary" (click)="toggleProfessional = !toggleProfessional">
                    {{ (toggleProfessional ? 'MARKET_REPORT.BTN_PROFESSIONAL_CLOSE' : 'MARKET_REPORT.BTN_PROFESSIONAL_OPEN') | translate }}
                    <i class="fas" aria-hidden="true" [ngClass]="toggleProfessional ? 'fa-angle-down' : 'fa-angle-right'"></i>
                  </button>
                </div>

                <div class="professional-wrapper" [ngClass]=" toggleProfessional ? 'expand-wrapper' : 'collapse-wrapper' ">
                  <div class="card-wrapper d-flex section-light-pad rm-pad-bottom">
                    <div *ngFor="let answer of filteredAnswers" class="card is-card-3 relative">

                      <div class="icon is-delete tooltip is-right c-hand" [attr.data-tooltip]="'MARKET_REPORT.TOOLTIP_HIDE_PROFESSIONAL' | translate"
                           (click)="filterPro(answer, $event)">
                        <i class="fas fa-eye-slash" aria-hidden="true"></i>
                      </div>

                      <div class="card-body">
                        <app-pro-tag [answer]="answer" (modalAnswerChange)="seeAnswer($event)"></app-pro-tag>
                      </div>

                    </div>
                  </div>
                </div>

              </section>
              <!-- /professionals -->


              <!-- other question sections -->
              <section id="questions">
                <div *ngFor="let question of questions">
                  <app-question-section
                    [project]="innovation"
                    [question]="question"
                    [answers]="filteredAnswers"
                    [toggleAnswers]="toggleAnswers"
                    [readonly]="!adminSide"
                    (modalAnswerChange)="seeAnswer($event)">
                  </app-question-section>
                </div>
              </section>
              <!-- /other question sections -->


              <!-- conclusion -->
              <ng-container *ngIf="innovation.marketReport?.finalConclusion?.conclusion.length > 0 || adminSide">
                <section class="section-pad" id="conclusion">
                  <div class="section-pad full bg-white text conclusion-wrapper">

                    <h2 class="title-primary" [innerText]="'MARKET_REPORT.CONCLUSION'" translate></h2>

                    <h6 *ngIf="mainDomain" class="op-text" [innerText]="'COMMON.UMI_WORD'" translate></h6>

                    <app-text-zone
                      [readonly]="!adminSide"
                      [data]="innovation.marketReport?.finalConclusion?.conclusion"
                      (onTextChange)="saveOperatorComment($event, 'finalConclusion')">
                    </app-text-zone>

                  </div>
                </section>
              </ng-container>
              <!-- /conclusion -->


            </section>
            <!-- /answers section -->

          </div>
        </div>
      </div>
    </ng-container>
    <!-- /project status done or preview mode or not editing -->


    <!-- insight preview -->
    <app-sidebar [(template)]="sidebarTemplateValue">
      <app-user-answer
        [(userAnswer)]="modalAnswer"
        [adminMode]="adminMode"
        [projectId]="innovation._id"
        [questions]="questions">
      </app-user-answer>
    </app-sidebar>
    <!-- /insight preview -->


  </div>
</ng-container>


