<div class="shared-market-report" id="shared-market-report">

  <!-- project status not done at client side -->
  <section
    *ngIf="innovation.status !== 'DONE' && !adminSide && !previewMode"
    class="p-top-100 p-bottom-30 p-left-15 p-right-15">
    <message-template [widthMax]="'337px'">
      {{ 'MARKET_REPORT.MESSAGE.EDITING' | translate }}
    </message-template>
  </section>
  <!-- /project status not done at client side -->

  <!-- project status not submitted admin side -->
  <section *ngIf="innovation.status === 'EDITING' && adminSide" class="p-top-50 p-bottom-30 p-left-15 p-right-15">
    <message-template [widthMax]="'337px'">
      The client hasn't submitted the project yet. You will be able to edit the market report after
      he submits his project.
    </message-template>
  </section>
  <!-- /project status not submitted admin side -->

  <!-- project status done or preview mode or not editing -->
  <div
    *ngIf="innovation.status === 'DONE' || previewMode || (innovation.status !== 'EDITING' && adminSide)"
    [ngStyle]="{'background-color': '#F5F5F5'}">
    <div class="container fluid grid-2xl animate-fade is-5">
      <div class="pws-wrapper">

        <!-- sidebar -->
        <aside [ngStyle]="{'max-width': '297px'}" class="sidebar-wrapper">
          <app-sidebar-in-page [(sidebarTemplate)]="leftSidebarTemplateValue">
            <app-sidebar-filter-answers
              [innovation]="innovation"
              [templateType]="leftSidebarTemplateValue.type"
              [isViewsEditable]="canAccess(['edit', 'views'])"
              [questions]="questions"
              [answers]="answers"
              [isAdminSide]="adminSide"
              [isOwner]="isOwner">
            </app-sidebar-filter-answers>
          </app-sidebar-in-page>
        </aside>
        <!-- /sidebar -->

        <!-- answers section -->
        <div class="content-wrapper">

          <!-- key learning section -->
          <section
            *ngIf="innovation.marketReport?.keyLearning?.conclusion?.length > 0 || adminSide"
            [ngClass]="{ 'p-top-50': !reportShared }"
            class="p-bottom-50"
            id="key-learnings">
            <div class="box-style p-50">
              <h2 class="title is-main" [innerText]="'MARKET_REPORT.KEY_LEARNING'" translate></h2>
              <h6 *ngIf="isMainDomain" class="op-text" [innerText]="'COMMON.UMI_WORD'" translate></h6>
              <app-text-zone
                (onTextChange)="saveOperatorComment($event, 'keyLearning')"
                [data]="innovation.marketReport?.keyLearning?.conclusion"
                [readonly]="!canAccess(['edit', 'umiWord'])">
              </app-text-zone>
            </div>
          </section>
          <!-- /key learning section -->

          <!-- origin comment and professional responses -->
          <section
            [ngClass]="{ 'p-top-50': !innovation.marketReport?.keyLearning?.conclusion?.length }"
            class="p-bottom-30"
            id="origin-responses">
            <div class="box-style">
              <app-question-conclusion
                [innovation]="innovation"
                [originAnswers]="answersOrigins"
                [question]="{ identifier: 'professionals', subtitle: { en: 'professionals', fr: 'professionnels' },
                title: { en: 'Origin of responses', fr: 'Origine des rÃ©ponses' } }"
                [readonly]="!canAccess(['edit', 'umiWord'])"
                [stats]="{ nbAnswers: answers.length, percentage: 0 }">
              </app-question-conclusion>
            </div>
          </section>
          <!-- /origin comment and professional responses -->

          <!-- map -->
          <section class="p-top-15" id="map">
            <app-shared-worldmap [countriesData]="answersByCountries"></app-shared-worldmap>
          </section>
          <!-- /map -->

          <!-- professionals -->
          <section class="p-bottom-50" id="professionals">

            <div class="text-center p-top-25">
              <button
                (click)="toggleProfessional = !toggleProfessional"
                class="button is-community is-sm"
                type="button">
                {{ (toggleProfessional ? 'MARKET_REPORT.BTN_PROFESSIONAL_CLOSE'
                : 'MARKET_REPORT.BTN_PROFESSIONAL_OPEN') | translate }}
                <i class="icon" [ngClass]="toggleProfessional ? 'icon-arrow-down' : 'icon-arrow-up'"></i>
              </button>
            </div>

            <div class="professional-wrapper" [ngClass]=" toggleProfessional ? 'is-expand' : 'is-collapse' ">
              <div class="card-wrapper">
                <div *ngFor="let answer of filteredAnswers" class="card is-card-3 relative">
                  <div (click)="filterPro(answer, $event)" class="icon-container text-alert absolute">
                    <span class="tooltip" [attr.data-tooltip]="'MARKET_REPORT.TOOLTIP_HIDE_PROFESSIONAL' | translate">
                      <i class="fas fa-eye-slash" aria-hidden="true"></i>
                    </span>
                  </div>
                  <div class="card-body">
                    <app-pro-tag
                      (modalAnswerChange)="seeAnswer($event)"
                      [answer]="answer">
                    </app-pro-tag>
                  </div>
                </div>
              </div>
            </div>

          </section>
          <!-- /professionals -->

          <!-- other question sections -->
          <section *ngFor="let question of questions" class="p-bottom-50" id="questions">
            <app-question-section
              (modalAnswerChange)="seeAnswer($event)"
              [answers]="filteredAnswers"
              [canEditQuestionTags]="canAccess(['edit', 'questionTags'])"
              [innovation]="innovation"
              [questionReceived]="question"
              [readonly]="!canAccess(['edit', 'umiWord'])"
              [toggleAnswers]="toggleAnswers">
            </app-question-section>
          </section>
          <!-- /other question sections -->

          <!-- conclusion -->
          <section
            *ngIf="innovation.marketReport?.finalConclusion?.conclusion?.length > 0 || adminSide"
            class="p-bottom-50"
            id="conclusion">
            <div class="box-style p-50">
              <h2 class="title is-main" [innerText]="'MARKET_REPORT.CONCLUSION'" translate></h2>
              <h6 *ngIf="isMainDomain" class="op-text" [innerText]="'COMMON.UMI_WORD'" translate></h6>
              <app-text-zone
                (onTextChange)="saveOperatorComment($event, 'finalConclusion')"
                [data]="innovation.marketReport?.finalConclusion?.conclusion"
                [readonly]="!canAccess(['edit', 'umiWord'])">
              </app-text-zone>
            </div>
          </section>
          <!-- /conclusion -->

        </div>
        <!-- /answers section -->

      </div>
    </div>
  </div>
  <!-- /project status done or preview mode or not editing -->

</div>

<!-- save button -->
<div *ngIf="toBeSaved" class="save-wrapper">
  <button
    (click)="saveInnovation($event)"
    class="button is-primary animate-zoom is-3 is-rounded"
    type="button">
    Save
  </button>
</div>
<!-- /save button -->

<!-- sidebar insight preview -->
<app-sidebar *ngIf="innovation && innovation._id" [(template)]="sidebarTemplateValue">
  <app-sidebar-user-answer
    *ngIf="modalAnswer._id"
    [(userAnswer)]="modalAnswer"
    [adminMode]="canAccess(['edit', 'respondentProfile'])"
    [projectId]="innovation._id"
    [questions]="questions">
  </app-sidebar-user-answer>
</app-sidebar>
<!-- /sidebar insight preview-->
