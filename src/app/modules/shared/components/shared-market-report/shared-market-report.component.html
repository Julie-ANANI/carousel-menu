<div class="shared-market-report" id="shared-market-report">

  <!-- project status not done at client side -->
  <section
    *ngIf="innovation.status !== 'DONE' && !adminSide && !previewMode"
    class="p-top-100 p-bottom-30 p-left-15 p-right-15">
    <app-message-template [widthMax]="'337px'">
      {{ 'MARKET_REPORT.MESSAGE.EDITING' | translateIn: reportingLang }}
    </app-message-template>
  </section>
  <!-- /project status not done at client side -->

  <!-- project status not submitted admin side -->
  <section *ngIf="innovation.status === 'EDITING' && adminSide" class="p-top-50 p-bottom-30 p-left-15 p-right-15">
    <app-message-template [widthMax]="'337px'">
      The client hasn't submitted the project yet. You will be able to edit the market report after
      he submits his project.
    </app-message-template>
  </section>
  <!-- /project status not submitted admin side -->

  <!-- project status done or preview mode or not editing -->
  <div
    *ngIf="innovation.status === 'DONE' || previewMode || (innovation.status !== 'EDITING' && adminSide)"
    [ngStyle]="{'background-color': '#F5F5F5'}">
    <div class="container fluid grid-2xl animate-fade is-5">
      <div class="pws-wrapper">

        <!-- sidebar -->
        <aside [ngStyle]="{'max-width': '297px'}" class="sidebar-wrapper">
          <app-sidebar-in-page [(sidebarTemplate)]="leftSidebarTemplateValue">
            <app-sidebar-filter-answers *ngIf="displayFilters"
              [reportingLang]="reportingLang"
              [innovation]="innovation"
              [templateType]="leftSidebarTemplateValue.type"
              [isViewsEditable]="canAccess(['edit', 'views'])"
              [questions]="questions"
              [answers]="answers"
              [isAdminSide]="adminSide"
              [isOwner]="isOwner">
            </app-sidebar-filter-answers>
            <div *ngIf="!displayFilters" class="m-top-30 loading is-lg"></div>
          </app-sidebar-in-page>
        </aside>
        <!-- /sidebar -->

        <!-- answers section -->
        <div class="content-wrapper">

          <div *ngIf="areAnswersLoading" class="m-top-50 loading is-lg"></div>

          <!-- synthesis reporting lang -->
          <div *ngIf="!areAnswersLoading && adminSide"
               class="d-flex flex-d-row align-center justify-end dropdown w-full m-top-15 is-right">
            <span class="text-sm text-background m-right-4">{{ 'MARKET_REPORT.RESTITUTION_LANG' | translateIn: reportingLang }}</span>
            <a class="button dropdown-toggle is-info" tabindex="0">
              {{ 'COMMON.LANG.' + reportingLang | uppercase | translate }} <i class="icon icon-caret"></i>
            </a>
            <ul class="menu">
              <li (click)="setNewSelectedLang('fr')" *ngIf="reportingLang === 'en'" class="menu-item">
                {{ 'COMMON.LANG.FR' | translate }}
              </li>
              <li (click)="setNewSelectedLang('en')" *ngIf="reportingLang === 'fr'" class="menu-item">
                {{ 'COMMON.LANG.EN' | translate }}
              </li>
            </ul>
          </div>
          <!-- /synthesis reporting lang -->

          <!-- synthesis reporting lang  -->
          <section
            *ngIf="showSection(innovation.marketReport?.keyLearning?.conclusion)"
            [ngClass]="{ 'p-top-50': !reportShared }"
            id="key-learnings">
            <div class="box-style" *ngIf="!areAnswersLoading">
              <app-question-conclusion
                [reportingLang]="reportingLang"
                (questionChanged)="saveQuestion($event)"
                [innovation]="innovation"
                [question]="{ identifier: 'keyLearning', subtitle: { en: '', fr: '' },
                title: { en: 'Key learnings', fr: 'Connaissances clés' } }"
                [readonly]="!canAccess(['edit', 'umiWord'])">
              </app-question-conclusion>
            </div>
          </section>
          <!-- /key learning section -->

          <!-- origin comment and professional responses -->
          <section
            class="p-bottom-30 p-top-50"
            id="origin-responses">
            <div class="box-style" *ngIf="!areAnswersLoading">
              <app-question-conclusion
                [reportingLang]="reportingLang"
                (questionChanged)="saveQuestion($event)"
                [innovation]="innovation"
                [originAnswers]="answersOrigins"
                [question]="{ identifier: 'professionals', subtitle: { en: 'professionals', fr: 'professionnels' },
                title: { en: 'Origin of responses', fr: 'Origine des réponses' } }"
                [readonly]="!canAccess(['edit', 'umiWord'])"
                [stats]="{ nbAnswers: filteredAnswers.length, percentage: 0 }">
              </app-question-conclusion>
            </div>
          </section>
          <!-- /origin comment and professional responses -->

          <!-- map -->
          <section class="p-top-15" id="map" [hidden]="areAnswersLoading"> <!-- do not replace hidden with ngIf -->
            <app-shared-worldmap [countriesData]="answersByCountries"></app-shared-worldmap>
          </section>
          <!-- /map -->

          <!-- professionals -->
          <section class="p-bottom-50" id="professionals" *ngIf="!areAnswersLoading">

            <div class="text-center p-top-25">
              <button
                (click)="toggleProfessional = !toggleProfessional"
                class="button is-community is-sm"
                type="button">
                {{ (toggleProfessional ? 'MARKET_REPORT.BTN_PROFESSIONAL_CLOSE'
                : 'MARKET_REPORT.BTN_PROFESSIONAL_OPEN') | translateIn: reportingLang }}
                <i class="icon" [ngClass]="toggleProfessional ? 'icon-arrow-down' : 'icon-arrow-up'"></i>
              </button>
            </div>

            <div class="professional-wrapper" [ngClass]=" toggleProfessional ? 'is-expand' : 'is-collapse' ">
              <div class="card-wrapper">
                <div *ngFor="let answer of filteredAnswers" class="card is-card-3 relative">
                  <div (click)="filterPro(answer, $event)" class="icon-container text-alert absolute">
                    <span class="tooltip" [attr.data-tooltip]="'MARKET_REPORT.TOOLTIP_HIDE_PROFESSIONAL' | translate">
                      <i class="fas fa-eye-slash" aria-hidden="true"></i>
                    </span>
                  </div>
                  <div class="card-body">
                    <app-pro-tag
                      (modalAnswerChange)="seeAnswer($event)"
                      [answer]="answer">
                    </app-pro-tag>
                  </div>
                </div>
              </div>
            </div>

          </section>
          <!-- /professionals -->

          <!-- other question sections -->
          <section *ngFor="let question of questions" class="p-bottom-50" id="questions">
            <app-question-section
              [reportingLang]="reportingLang"
              (questionChanged)="saveQuestion($event)"
              *ngIf="!areAnswersLoading"
              (modalAnswerChange)="seeAnswer($event)"
              [answers]="filteredAnswers"
              [canEditQuestionTags]="canAccess(['edit', 'questionTags'])"
              [innovation]="innovation"
              [questionReceived]="question"
              [readonly]="!canAccess(['edit', 'umiWord'])"
              [toggleAnswers]="toggleAnswers"
              [hideAnswers]="hideQuestionAnswers(question)">
            </app-question-section>
          </section>
          <!-- /other question sections -->

          <!-- conclusion -->
          <section
            *ngIf="showSection(innovation.marketReport?.finalConclusion?.conclusion)"
            class="p-bottom-50"
            id="conclusion">
            <div class="box-style" *ngIf="!areAnswersLoading">
              <app-question-conclusion
                [reportingLang]="reportingLang"
                (questionChanged)="saveQuestion($event)"
                [innovation]="innovation"
                [question]="{ identifier: 'finalConclusion', subtitle: { en: '', fr: '' },
                title: { en: 'Final conclusion', fr: 'Conclusion finale' } }"
                [readonly]="!canAccess(['edit', 'umiWord'])">
              </app-question-conclusion>
            </div>
          </section>
          <!-- /conclusion -->

        </div>
        <!-- /answers section -->

      </div>
    </div>
  </div>
  <!-- /project status done or preview mode or not editing -->

</div>

<!-- save button -->
<div *ngIf="toBeSaved" class="save-wrapper">
  <button
    (click)="saveInnovation($event)"
    class="button is-primary animate-zoom is-3 is-rounded"
    type="button">
    Save
  </button>
</div>
<!-- /save button -->

<!-- sidebar insight preview -->
<app-sidebar *ngIf="innovation && innovation._id" [(template)]="sidebarTemplateValue">
  <app-sidebar-user-answer
    *ngIf="modalAnswer._id"
    [adminMode]="canAccess(['edit', 'respondentProfile'])"
    [projectId]="innovation._id"
    [questions]="questions"
    [sidebarState]="sidebarTemplateValue.animate_state"
    [userAnswer]="modalAnswer">
  </app-sidebar-user-answer>
</app-sidebar>
<!-- /sidebar insight preview-->
