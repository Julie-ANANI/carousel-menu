<shared-answer-modal [adminMode]="adminMode" [(modalAnswer)]="modalAnswer" [innoid]="innoid" [questions]="questions"></shared-answer-modal>
<div class="market-report" *ngIf="canShow()">

  <!-- *********************************************************
        Header
  ************************************************************** -->

  <h1 id="title">{{infographics.title}}</h1>
  <p class="subtitle">{{ 'MARKET_REPORT.TITLE' | translate }}</p>

  <div class="admin-buttons">
    <button type="button" *ngIf="adminMode"
            class="btn btn-lg btn-primary"
            (click)="recalculateSynthesis($event)"
            [disabled]="calculating"
            [ngClass]="{'loading': calculating, '': !calculating}"
    >
      {{'MARKET_REPORT.BTN_RECOMPUTE' | translate}}
      <i class="fa fa-refresh" aria-hidden="true"></i>
    </button>
    <pdf-generator class="btn btn-lg btn-primary" [model]="getModel()" style="margin:10px;">
    </pdf-generator>
  </div>

  <!-- *********************************************************
        Sidebar
  ************************************************************** -->
  <div class="d-flex">
    <div class="sidebar" *ngIf="!adminMode">
      <div class="sidebarIsSticky">
        <div (click)="toggleDetails($event)" class="toggle-sections">
          {{ (showDetails ? 'MARKET_REPORT.COLLAPSE' : 'MARKET_REPORT.EXPAND') | translate}}
          <i class="fa float-right" aria-hidden="true"
             [ngClass]="{'fa-plus-square-o': !showDetails, 'fa-minus-square-o': showDetails}"></i>
        </div>
        <ul>
          <li>
            <a pageScroll href="#professionals">
              {{ infographics.professionals.title[lang] }}
              <i class="fa fa-angle-right float-right" aria-hidden="true"></i>
            </a>
          </li>
          <li *ngFor="let question of infographics.questions">
            <a pageScroll [href]="'#' + question.id" [hidden]="!!question.hidden">
              {{ question.title[lang] }}
              <i class="fa fa-angle-right float-right" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- *********************************************************
          Synthesis
    ************************************************************** -->

    <div class="flex-container">
      <div class="content">

        <!-- *********************************************************
              World Map and professionals cards
        ************************************************************** -->
        <section id="professionals">
          <h2>{{ 'MARKET_REPORT.PROFESSIONAL.TITLE' | translate }}</h2>
          <div class="white-frame">

          <app-question-conclusion
            [info]="infographics.professionals"
            [innovationId]="project._id"
            [readonly]="!adminMode"
          ></app-question-conclusion>

            <div class="bloc">
              <div class="map centered" width="684" height="339">
                <world-map [countries]="countries" [color]="'#0B90C6'"></world-map>
              </div>
            </div>
            <div class="bloc details">
              <!--======= Liste des pros =======-->
              <div class="prosList">
                <div *ngFor="let answer of answers" class="professional-item" [ngClass]="{'top-profil': answer.profileQuality === 2}">
                  <country-flag [country]="answer.country" [width]="37" [height]="25" class="user-flag"></country-flag>

                  <p class="user-name">
                      {{answer.professional?.firstName}} {{answer.professional?.lastName}}
                  </p>

                  <p *ngIf="answer.job || answer.professional?.jobTitle" class="user-job">
                    <i class="fa fa-user" aria-hidden="true"></i>
                    {{answer.job || answer.professional?.jobTitle}}
                  </p>

                  <p *ngIf="answer.company?.name || answer.professional?.company" class="user-company">
                    <i class="fa fa-building-o" aria-hidden="true"></i>
                    {{answer.company?.name || answer.professional?.company}}
                  </p>

                  <span (click)="seeAnswer(answer) && $event.preventDefault()" class="see-answer">
                    {{ 'MARKET_REPORT.SEE_ANSWERS' | translate }}
                  </span>

                  <br>

                  <a *ngIf="answer.professional?.email" href="mailto:{{answer.professional.email}}">{{answer.professional.email}}</a>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Les autres questions -->
        <section *ngFor="let question of infographics.questions">
          <market-report-section
            [info]="question"
            [question]="question"
            [answers]="infographics.answers"
            [showDetails]="showDetails"
            [readonly]="!adminMode"
            (modalAnswerChange)="seeAnswer($event)">
          </market-report-section>
        </section>
      </div>
    </div>
  </div>
</div>
