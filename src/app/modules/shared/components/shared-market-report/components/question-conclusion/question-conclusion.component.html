<div class="content-body" id="question-conclusion">

  <div [hidden]="!!question.identifier" class="conclusion-wrapper">
    <h2 class="loading-content m-bottom-20"></h2>
    <p class="loading-content m-bottom-20"></p>
    <div class="card-header">
      <div class="card-title loading-content"></div>
    </div>
    <div class="card-body loading-content"></div>
    <div class="card-body loading-content"></div>
  </div>

  <!-- conclusion -->
  <div class="conclusion-wrapper" [hidden]="!question.identifier">

    <h3 [ngClass]="{'m-no-bottom': !questionLabel()}" class="title is-main d-flex align-center">
      <span *ngIf="!editTitle"> {{ questionTitle() }} </span>
      <input
        #title
        (change)="onChangeTitle(title.value)"
        (focusout)="editTitle = false"
        *ngIf="editTitle"
        [ngModel]="questionTitle()"
        class="form-input"
        type="text">
      <sub
        (click)="editTitle = !editTitle"
        *ngIf="!readonly"
        [attr.data-tooltip]="'Edit section title'"
        class="tooltip c-hand m-left-2">
        <img
          [src]="picto.edit.blue"
          alt="Edit"
          class="img-responsive">
      </sub>
    </h3>

    <h4 *ngIf="questionLabel()"  style="color: #484848" class="m-no-bottom text-lg">
      {{ displayedQuestionLabel() }}
    </h4>

    <!--TODO remove multiling-->
    <div *ngIf="tags && tags.length > 0" class="tags-wrapper">
      <ng-container *ngFor="let tag of tags">
        <ng-container *ngIf="tag.entry && tag.entry.length; else noQuesConclusionTag">
          <div class="label is-draft is-rounded">
            <i class="fas fa-tag icon-left"></i> {{ tag.entry | langEntry:'label':reportingLang:true }}
            <ng-container *ngIf="tag.count > 1">(x{{ tag.count }})</ng-container>
          </div>
        </ng-container>
        <ng-template #noQuesConclusionTag>
          <div class="label is-tag is-rounded">
            <i class="fas fa-tag icon-left"></i> {{ tag.label | multiling:reportingLang }}
            <ng-container *ngIf="tag.count > 1">(x{{ tag.count }})</ng-container>
          </div>
        </ng-template>
      </ng-container>
    </div>



    <div class="d-flex align-center">
      <h5 *ngIf="isMainDomain" class="op-text m-right-4">{{ 'COMMON.UMI_WORD' | translateIn: reportingLang }}</h5>
      <!-- Edit mode toggle -->
      <button
        *ngIf="!readonly"
        (click)="toggleEditor()"
        [attr.data-tooltip]="(showEditor)? 'Preview':'Edit'"
        [id]="'sharedPresetSection-btn-add-question'"
        class="button tooltip is-circled is-action is-outlined text-no-underline is-info is-xs text-sm op-text text-meta"
        type="button">
        <i *ngIf="!showEditor" class="fas fa-pencil-alt"></i>
        <i *ngIf="showEditor" class="fas fa-eye"></i>
      </button>
    </div>

    <app-shared-editors
      (textChange)="keyupHandlerFunction($event)"
      [text]="innovation.marketReport[question.identifier]?.conclusion || ''"
      [innovationId]="innovation._id"
      [elementId]="question.identifier"
      [isEditable]="!readonly && showEditor"
      [type]="'synthesis'">
    </app-shared-editors>

    <div *ngIf="originAnswers !== null" class="p-top-20">
      <h4 class="title is-5 m-bottom-15">{{'MARKET_REPORT.GEOGRAPHICAL_DISTRIBUTION' | translateIn: reportingLang }}:</h4>
      <div class="m-no-bottom">
        <div *ngFor="let continent of originAnswers | keyvalue | orderBy:'value'" [id]="continent.key" class="m-top-1">
          <app-shared-toggle-list>
            <div slot="header">
              <span class="text-bold"> {{ ('CONTINENTS.' + continent.key) | translateIn: reportingLang }}: {{ continent.value.count }} </span>
            </div>
            <div slot="body">
              <ul class="m-no-bottom">
                <li *ngFor="let country of continent.value.countries | keyvalue | orderBy:'value.count'" class="m-top-1">
                  {{ country.value.names | multiling:reportingLang }}: {{ country.value.count }}
                </li>
              </ul>
            </div>
          </app-shared-toggle-list>
        </div>
      </div>
    </div>

  </div>
  <!-- /conclusion -->

  <!-- stats -->
  <div *ngIf="question.controlType" [ngSwitch]="question.controlType" class="stats-wrapper relative">
    <!-- pie chart -->
    <ng-container *ngSwitchCase="'radio'">

      <app-bluesquare
        (subtitleChanged)="subtitleChange($event)"
        [readonly]="readonly"
        [percentage]="stats.percentage"
        [subtitle]="questionSubtitle()">
        <app-utility-piechart
          (positiveLabelChanged)="positiveAnswerLabelChanged($event)"
          (chartSectionColorChanged)="chartSectionColorChanged($event)"
          (chartSectionPositiveChanged)="positiveAnswerChange($event)"
          [pieChart]="pieChart"
          [readonly]="readonly"
          [reportingLang]="reportingLang"
          [showFavorable]="showPositiveAnswers"
          [positiveSections]="positivesAnswers"
          [favorableAnswersLabel]="positiveAnswerLabels()"
        ></app-utility-piechart>
      </app-bluesquare>
    </ng-container>
    <!-- /pie chart -->

    <!-- likert-scale chart -->
    <ng-container *ngSwitchCase="'likert-scale'">

      <app-bluesquare
        (subtitleChanged)="subtitleChange($event)"
        [readonly]="readonly"
        [percentage]="stats.percentage"
        [subtitle]="questionSubtitle()">
        <app-likert-scale-chart
          [reportingLang]="reportingLang"
          [question]="question"
        ></app-likert-scale-chart>
      </app-bluesquare>
    </ng-container>
    <!-- /likert-scale chart -->

    <!-- ranking chart -->
    <ng-container *ngSwitchCase="'ranking'">
      <app-bluesquare
        (subtitleChanged)="subtitleChange($event)"
        [readonly]="readonly"
        [percentage]="stats.percentage"
        [subtitle]="questionSubtitle()">
        <app-ranking-chart
          [reportingLang]="reportingLang"
          [question]="question"
        ></app-ranking-chart>
      </app-bluesquare>
    </ng-container>
    <!-- /ranking chart -->

    <!-- rectangle box -->
    <ng-container *ngSwitchDefault>
      <app-bluesquare
        (subtitleChanged)="subtitleChange($event)"
        [readonly]="readonly"
        [percentage]="stats.percentage"
        [subtitle]="(questionSubtitle()) || ('MARKET_REPORT.NUMBER_ANSWERS' | translateIn: reportingLang)">
        <div style="font-size: 100px">{{ stats.nbAnswers || 0 }}</div>
      </app-bluesquare>
    </ng-container>
    <!-- /rectangle box -->

  </div>
  <!-- /stats -->

</div>
