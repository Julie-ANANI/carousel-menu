<div id="app-market-report-sidebar">

  <ng-container *ngIf="isOwner">
    <button
      class="btn btn-primary gtm-export-synthesis"
      (click)="showExportModal = true">
      {{ 'MARKET_REPORT.MENU_BAR.BUTTON_EXPORT' | translate }}
    </button>
    <hr/>
  </ng-container>

  <ng-container *ngIf="isAdmin">
    <button
      class="btn btn-primary"
      (click)="showEndInnovationModal = true">
      {{ 'MARKET_REPORT.MENU_BAR.BUTTON_END' | translate }}
    </button>
    <hr/>
  </ng-container>

  <div class="views-wrapper">
    <p>{{ 'MARKET_REPORT.MENU_BAR.VIEWS' | translate }}</p>
    <ul>
      <li *ngFor="let filter of sharedFiltersList">
        <i class="fa fa-trash" aria-hidden="true" (click)="deleteCustomFilter(filter.name)"></i>
        <a [routerLink]="" [queryParams]="{filter: filter.name}"
           (click)="loadFilter(filter.name)" [innerHtml]="filter.name"></a>
      </li>
    </ul>
    <form #shareFilterForm="ngForm" (ngSubmit)="shareNewFilter($event)">
      <div class="form-group">
        <input type="text" class="form-control" [placeholder]="'MARKET_REPORT.MENU_BAR.PLACEHOLDER_VIEW' | translate"
               required [(ngModel)]="filterName" [ngModelOptions]="{standalone: true}" #name="ngModel">
      </div>
      <button class="btn ghost-primary" type="submit"
              [disabled]="!shareFilterForm.form.valid"
              [textContent]="'MARKET_REPORT.MENU_BAR.SUBMIT_VIEW'" translate></button>
    </form>
  </div>

  <hr/>

  <div class="menu-wrapper">
    <p *ngIf="filtersCount > 0" class="reset-filter">
      <span (click)="resetFilters($event)" [innerText]="'MARKET_REPORT.RESET_FILTERS'" translate></span>
    </p>
    <p>
      <a href="#professionals" pageScroll>
        {{ 'MARKET_REPORT.MAP.TITLE' | translate }}
        <i class="fas fa-angle-right" aria-hidden="true"></i>
      </a>
      <span *ngFor="let c of continentsList">
        <input type="checkbox" [name]="c" (change)="checkCountry($event)" [checked]="filteredContinents ? filteredContinents[c] : true">
        <label [for]="c">{{ ('CONTINENTS.' + c) | translate }}</label>
      </span>
    </p>
    <p>
      <a href="#professionals" pageScroll>
        {{ 'MARKET_REPORT.PROFESSIONAL.TITLE' | translate }}
        <i class="fas fa-angle-right" aria-hidden="true"></i>
      </a>
      <span *ngFor="let t of tagsList">
        <input type="checkbox" [name]="t._id" (change)="checkTag($event)" [checked]="selectedTags[t._id]">
        <label [for]="t._id">{{ t.label | multiling:lang }}</label>
      </span>
      <ng-container *ngIf="filters['professionals']">
        <span *ngFor="let a of filters['professionals'].value | keyvalue">
        <i class="fa fa-trash" aria-hidden="true" (click)="deleteProfessionalFilter($event, a.key)"></i>
        {{ a.value.professional.firstName }} {{ a.value.professional.lastName }}
      </span>
      </ng-container>
    </p>
    <p *ngFor="let question of questions">
      <a [href]="'#' + question.identifier | removespaces" pageScroll>
        {{ question.title | multiling:lang }}
        <i class="fas fa-angle-right" aria-hidden="true"></i>
      </a>
      <!-- Textarea filters -->
      <ng-container *ngIf="question.controlType === 'textarea'">
        <span *ngFor="let t of answersTagsLists[question.identifier]">
          <input type="checkbox" [name]="t._id" (change)="checkAnswerTag($event, question.identifier)"
                 [checked]="selectedAnswersTags[question.identifier][t._id]">
          <label [for]="t._id">{{ t.label | multiling:lang }}</label>
        </span>
      </ng-container>
      <!-- checkbox/radio filters -->
      <ng-container *ngIf="question.controlType === 'checkbox' || question.controlType === 'radio'">
        <span *ngFor="let o of question.options">
          <input type="checkbox" [name]="o.identifier" (change)="checkOption($event, question)"
                 [checked]="filters[question.identifier] ? filters[question.identifier].value[o.identifier] : true">
          <label [for]="o.identifier">{{ o.label | multiling:lang }}</label>
        </span>
      </ng-container>
    </p>
    <p>
      <a href="#conclusion" pageScroll>
        {{ 'MARKET_REPORT.CONCLUSION' | translate }}
        <i class="fas fa-angle-right" aria-hidden="true"></i>
      </a>
    </p>
  </div>
</div>

<app-market-report-export-modal
  *ngIf="isOwner"
  [innovation]="innovation"
  [(showModal)]="showExportModal">
</app-market-report-export-modal>

<!-- Modal to ask operator to sure about ending the project -->
<app-modal [modalTitle]="'MARKET_REPORT.MODAL.END_INNOVATION_TITLE'"  [(showModal)]="showEndInnovationModal">
  <div class="content">
    {{ 'MARKET_REPORT.MODAL.END_INNOVATION_CONTENT' | translate }}
  </div>
  <div class="modal-footer">
    <button
      class="btn btn-primary btn-sm"
      (click)="endInnovation($event)">
      {{ 'MARKET_REPORT.MODAL.BUTTON_CONFIRM' | translate }}
    </button>
  </div>
</app-modal>
<!-- /Modal to ask operator to sure about ending the project -->
