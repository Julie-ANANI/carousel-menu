<div [id]=domSectionId>
  <h2>{{ info.title | multiling:lang }}</h2>

  <div class="white-frame">

    <!--************************************************
               HEADER SECTION (UMI SYNTHESIS)
    **************************************************-->
    <app-question-conclusion
      [info]="info"
      [innovationId]="innoid"
      [readonly]="readonly"
    ></app-question-conclusion>

    <!--************************************************
                         ANSWERS
    **************************************************-->

    <!-- ========= SHOW ANSWERS BUTTON ==============-->
    <button type="button" class="market-report-btn centered"
            [ngClass]="{'active': showDetails}"
            (click)="showDetails = !showDetails; $event.preventDefault()">
      {{(showDetails ? 'MARKET_REPORT.BTN_ANSWERS_CLOSE' : 'MARKET_REPORT.BTN_ANSWERS_OPEN') | translate}}
      <i class="fa" aria-hidden="true"
         [ngClass]="showDetails ? 'fa-angle-up' : 'fa-angle-down'"></i>
    </button>

    <div *ngIf="showDetails" class="bloc">

      <!--======= Scores =======-->
      <div *ngIf="info.controlType === 'scale'">
        <div class="column-graph flex-container">
          <div *ngFor="let score of info.data; let i = index"
               class="vertical-bar number{{score.value}}">
            <div class="bar-fill" [style.height]="getFillPerc(score.count)" *ngIf="score.count"></div>
            <div class="bar-stats" *ngIf="score.count">{{score.count}}</div>
            <div class="bar-picture" *ngIf="score.count"></div>
            <div class="bar-score">{{score.value}}/10</div>
          </div>
        </div>
      </div>

      <!--======= Prix =======-->
      <div *ngIf="info.average && info.controlType === 'textbox'">
        <app-prices [rawData]="info.data"></app-prices>

        <div class="average">Moyenne : {{info.average}}€</div>
      </div>

      <!--======= Bar Chart =======-->
      <app-bar-chart *ngIf="info.controlType === 'checkbox' || info.controlType === 'radio'"
                     [answers]="answersToShow"
                     [question]="question"
                     (modalAnswerChange)="seeAnswer($event)">
      </app-bar-chart>

      <!--======= Avantages Clés =======-->
      <div *ngIf="info.controlType === 'stars'">
        <table>
          <tr *ngFor="let advantage of info.options; let i = index">
            <td>{{advantage.label | multiling:lang}}</td>
            <td>
              <app-stars [note]="info?.data[advantage.identifier]?.average"
                         [count]="info?.data[advantage.identifier]?.count"></app-stars>
            </td>
          </tr>
        </table>
      </div>

      <!--======= Liste d'items (applications, concurrents, partenaires potentiels) =======-->
      <market-item-list
        [answers]="answers"
        [list]="info.data"
        *ngIf="info.controlType === 'list' || info.controlType === 'clearbit'"
        (modalAnswerChange)="seeAnswer($event)">
      </market-item-list>

      <!--======= textarea =======-->
      <ul *ngIf="info.controlType === 'textarea'" class="comments">
        <li *ngFor="let answer of answersToShow">
          <market-comment
            [answer]="answer"
            [questionId]="info.id"
            (modalAnswerChange)="seeAnswer($event)">
          </market-comment>
        </li>
      </ul>

      <!--======= toggle =======-->
      <div *ngIf="info.controlType === 'toggle'" class="prosList">
        <div *ngFor="let answer of answersToShow" class="white-frame professional-item">
          <app-pro-tag
            [answer]="answer"
            (modalAnswerChange)="seeAnswer($event)">
          </app-pro-tag>
        </div>
      </div>

      <!--************************************************
                       COMMENTS SECTION
      **************************************************-->
      <ng-container *ngIf="answersWithComment.length > 0">

        <!-- ========= SHOW COMMENTS BUTTON ==============-->
        <button type="button" class="market-report-btn centered"
                [ngClass]="{'active': showComments}"
                (click)="showComments = !showComments; $event.preventDefault()">
          {{(showComments ? 'MARKET_REPORT.BTN_COMMENTS_CLOSE' : 'MARKET_REPORT.BTN_COMMENTS_OPEN') | translate:({length: answersWithComment.length})}}
          <i class="fa" aria-hidden="true"
             [ngClass]="showComments ? 'fa-angle-up' : 'fa-angle-down'"></i>
        </button>

        <!-- ================= COMMENTS ==================-->
        <div class="bloc" *ngIf="showComments">
          <ul class="comments">
            <li *ngFor="let answer of answersWithComment">
              <market-comment
                [answer]="answer"
                [questionId]="info.id+'Comment'"
                (modalAnswerChange)="seeAnswer($event)">
              </market-comment>
            </li>
          </ul>
        </div>

      </ng-container>

    </div>

  </div>
</div>
