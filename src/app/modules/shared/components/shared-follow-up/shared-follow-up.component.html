<div id="shared-follow-up">

  <!-- emails and finish button -->
  <section class="header-wrapper">

    <!-- emails -->
    <div [ngClass]="{'p-right-40': canAccess(['workflow', 'send'])}" class="email-wrapper">

      <!-- appointment -->
      <div class="email-content">
        <div [ngStyle]="{ 'line-height': '1' }" class="text-bold m-bottom-2">
          <span [ngStyle]="{ 'color': '#1E3147' }" class="text-sm m-right-2">
            {{ 'SHARED_FOLLOW_UP.INTERVIEW' | translate }}
          </span>
          <span
            (click)="onClickSee($event, 'interview')"
            *ngIf="canAccess(['workflow', 'view']) || canAccess(['workflow', 'edit'])"
            [ngStyle]="{ 'margin-top': '3px' }"
            class="text-link text-xs">
            {{ 'SHARED_FOLLOW_UP.BUTTON_SEE' | translate }}
          </span>
        </div>

        <div [ngStyle]="{ 'font-size': '13px', 'line-height': '1' }" class="text-notify text-medium">
          <span>{{ prosInterview.length }} {{ 'SHARED_FOLLOW_UP.CONTACTS_ADDED' | translate }} | </span>
          <span>{{ prosInterviewSent.length }} {{ 'SHARED_FOLLOW_UP.EMAILS_SENT' | translate }} </span>
        </div>
      </div>
      <!-- /appointment -->

      <div class="divider-vert is-lg"></div>

      <!-- open -->
      <div class="email-content">
        <div [ngStyle]="{ 'line-height': '1' }" class="text-bold m-bottom-2">
          <span [ngStyle]="{ 'color': '#1E3147' }" class="text-sm m-right-2">
            {{ 'SHARED_FOLLOW_UP.OPENING' | translate }}
          </span>
          <span
            (click)="onClickSee($event, 'opening')"
            *ngIf="canAccess(['workflow', 'view']) || canAccess(['workflow', 'edit'])"
            [ngStyle]="{ 'margin-top': '3px' }"
            class="text-link text-xs">
            {{ 'SHARED_FOLLOW_UP.BUTTON_SEE' | translate }}
          </span>
        </div>

        <div [ngStyle]="{ 'font-size': '13px', 'line-height': '1' }" class="text-notify text-medium">
          <span>{{ prosOpening.length }} {{ 'SHARED_FOLLOW_UP.CONTACTS_ADDED' | translate }} | </span>
          <span>{{ prosOpeningSent.length }} {{ 'SHARED_FOLLOW_UP.EMAILS_SENT' | translate }} </span>
        </div>
      </div>
      <!-- /open -->

      <div class="divider-vert is-lg"></div>

      <!-- thank -->
      <div class="email-content">
        <div [ngStyle]="{ 'line-height': '1' }" class="text-bold m-bottom-2">
          <span [ngStyle]="{ 'color': '#1E3147' }" class="text-sm m-right-2">
            {{ 'SHARED_FOLLOW_UP.NOFOLLOW' | translate }}
          </span>
          <span
            (click)="onClickSee($event, 'noFollow')"
            *ngIf="canAccess(['workflow', 'view']) || canAccess(['workflow', 'edit'])"
            [ngStyle]="{ 'margin-top': '3px' }"
            class="text-link text-xs">
            {{ 'SHARED_FOLLOW_UP.BUTTON_SEE' | translate }}
          </span>
        </div>

        <div [ngStyle]="{ 'font-size': '13px', 'line-height': '1' }" class="text-notify text-medium">
          <span>{{ prosNoFollow.length }} {{ 'SHARED_FOLLOW_UP.CONTACTS_ADDED' | translate }} | </span>
          <span>{{ prosNoFollowSent.length }} {{ 'SHARED_FOLLOW_UP.EMAILS_SENT' | translate }} </span>
        </div>
      </div>
      <!-- /thank -->

    </div>
    <!-- /emails -->

    <!-- button -->
    <div *ngIf="canAccess(['workflow', 'send'])" class="text-center">

      <button
        (click)="openModal($event)"
        class="button is-primary is-lg"
        id="btn-send-mail">
        {{ 'SHARED_FOLLOW_UP.BUTTON_DONE' | translate }}
      </button>

      <p class="text-notify m-top-2 m-no-bottom text-sm">
        {{ prosWithoutObjective.length }} {{ 'SHARED_FOLLOW_UP.CONTACT_WITHOUT_OBJECTIVE' | translate }}
      </p>

    </div>
    <!-- /button -->

  </section>
  <!-- /emails and finish button -->

  <!-- table -->
  <section class="p-top-30">

    <h6 class="text-sm text-notify m-bottom-10">
      <span class="text-background">{{ this.tableInfos._total === -1 ? 0 : this.tableInfos._total }}</span> contacts /
      <span class="text-background">{{ prosWithoutObjective.length }}</span>
      {{ 'SHARED_FOLLOW_UP.WITHOUT_OBJECTIVE' | translate }}
    </h6>

    <div>
      <app-shared-table
        (dropdownAction)="assignObjective($event)"
        (editRow)="seeAnswer($event)"
        (performAction)="performActions($event)"
        [(config)]="localConfig"
        [data]="tableInfos">
      </app-shared-table>
    </div>

  </section>
  <!-- /table -->

</div>


<!-- answer sidebar -->
<app-sidebar
  *ngIf="canAccess(['view', 'answer']) || canAccess(['edit', 'answer'])"
  [(template)]="sidebarAnswer">
  <app-sidebar-user-answer
    [adminMode]="canAccess(['edit', 'answer'])"
    [userAnswer]="modalAnswer"
    [projectId]="project._id"
    [questions]="questions">
  </app-sidebar-user-answer>
</app-sidebar>
<!-- /answer sidebar -->


<!-- filter sidebar -->
<sidebar-left *ngIf="canAccess()" [(sidebarTemplate)]="sidebarTemplate">
  <app-sidebar-filter-answers
    (closeSidebar)="closeSidebar()"
    [answers]="answers"
    [innovation]="project"
    [isViewsEditable]="canAccess(['edit', 'views'])"
    [questions]="questions"
    [templateType]="sidebarTemplate.type">
  </app-sidebar-filter-answers>
</sidebar-left>
<!-- /filter sidebar -->


<!-- modal for mails -->
<app-utility-modal
  *ngIf="emailsObject && showEmailsModal && canAccess(['workflow'])"
  [(showModal)]="showEmailsModal" [maxWidth]="'1080px'">
  <section class="modal-body p-top-30 p-bottom-30 p-left-50 p-right-50">

    <!-- heading -->
    <h5 class="title text-lg text-bold text-center">
      {{ 'SHARED_FOLLOW_UP.' + this.modalTemplateType.toUpperCase() | translate }}
    </h5>
    <!-- /heading -->

    <!-- close button -->
    <div [ngStyle]="{ 'right': '15px', 'top': '21px' }" class="absolute">
      <button (click)="closeModal($event)" class="close text-notify" type="button"></button>
    </div>
    <!-- /close button -->

    <!-- mail wrapper -->
    <div>
      <app-shared-mail-editor
        [isEditableMode]="canAccess(['workflow', 'edit'])"
        [canTestMails]="canAccess(['workflow', 'test'])"
        [templateType]="'FOLLOW-UP'"
        [professionals]="pros"
        [(ccEmail)]="ccEmail"
        [customFields]="customFields"
        (sendTestEmails)="sendTestEmails()"
        [(emailsObject)]="emailsObject">
      </app-shared-mail-editor>
    </div>
    <!-- /mail wrapper -->

    <!-- save button -->
    <div *ngIf="canAccess(['workflow', 'edit'])" class="text-center">
      <button
        (click)="saveProject()"
        [ngStyle]="{ 'min-width': '141px' }"
        class="button is-primary">
        {{ 'COMMON.BUTTON.SAVE' | translate }}
      </button>
    </div>
    <!-- /save button -->

  </section>
</app-utility-modal>
<!-- /modal for mails -->


<!-- modal for warning : objective already assigned -->
<app-utility-modal
  *ngIf="canAccess(['edit', 'objective'])"
  [(showModal)]="showWarningModal"
  [title]="'Objective Board'">

  <section class="modal-body">
    <p>{{ 'SHARED_FOLLOW_UP.MODAL.WARNING_1' | translate }}</p>
    <ul>
      <li *ngFor="let pro of pendingAction.assignedAnswers">
        {{ pro.name }}: {{ 'SHARED_FOLLOW_UP.BUTTON.' + pro.objective | translate }}
      </li>
    </ul>
    <p class="text-sm p-top-10 text-alert">{{ 'SHARED_FOLLOW_UP.MODAL.WARNING_2' | translate }}</p>
  </section>

  <footer class="modal-footer">
    <button class="button modal-cancel">Cancel</button>
    <button
      (click)="updateManyObjectives(pendingAction.answersIds, pendingAction.objective)"
      class="button is-primary">
      Confirm
    </button>
  </footer>

</app-utility-modal>
<!-- /modal for warning : objective already assigned -->


<!-- modal for sending emails : are you sure ? -->
<app-utility-modal *ngIf="showSendModal && canAccess(['workflow', 'send'])" [(showModal)]="showSendModal">
  <section class="modal-body p-top-30 p-bottom-30 p-left-50 p-right-50">

    <!-- heading -->
    <h5 class="title text-lg text-bold text-center">
      {{ prosInterview.length + prosOpening.length + prosNoFollow.length }}
      {{ 'SHARED_FOLLOW_UP.MODAL.EMAILS_READY' | translate }}
    </h5>
    <!-- /heading -->

    <!-- close button -->
    <div [ngStyle]="{ 'right': '15px', 'top': '21px' }" class="absolute">
      <button (click)="closeModal($event)" class="close text-notify" type="button"></button>
    </div>
    <!-- /close button -->

    <!-- content -->
    <div [ngStyle]="{ 'min-height': '150px' }" class="p-bottom-20">
      <div class="columns">

        <!-- image -->
        <div class="column col-sm-12 col-6 col-mx-auto">
          <div class="p-top-15">
            <img
              src="https://res.cloudinary.com/umi/image/upload/v1574086949/pictos/mix/email.svg"
              alt=" "
              class="img-responsive m-auto">
          </div>
        </div>
        <!-- /image -->

        <!-- emails -->
        <div class="column col-sm-12 col-6">
          <div class="d-flex justify-center flex-d-column p-top-40">

            <!-- appointment -->
            <div class="p-top-1 p-bottom-3">

              <div [ngStyle]="{ 'line-height': '1', 'color': '#1E3147' }" class="text-bold m-bottom-2 text-sm">
                {{ 'SHARED_FOLLOW_UP.INTERVIEW' | translate }}
              </div>

              <div [ngStyle]="{ 'font-size': '13px', 'line-height': '1' }" class="text-notify text-medium">
                {{ prosInterview.length }} {{ 'SHARED_FOLLOW_UP.CONTACTS_ADDED' | translate }}
              </div>

            </div>
            <!-- /appointment -->

            <div class="divider is-lg"></div>

            <!-- open -->
            <div class="p-top-2 p-bottom-3">

              <div [ngStyle]="{ 'line-height': '1', 'color': '#1E3147' }" class="text-bold m-bottom-2 text-sm">
                {{ 'SHARED_FOLLOW_UP.OPENING' | translate }}
              </div>

              <div [ngStyle]="{ 'font-size': '13px', 'line-height': '1' }" class="text-notify text-medium">
                {{ prosOpening.length }} {{ 'SHARED_FOLLOW_UP.CONTACTS_ADDED' | translate }}
              </div>

            </div>
            <!-- /open -->

            <div class="divider is-lg"></div>

            <!-- thank -->
            <div class="p-top-2 p-bottom-3">

              <div [ngStyle]="{ 'line-height': '1', 'color': '#1E3147' }" class="text-bold m-bottom-2 text-sm">
                {{ 'SHARED_FOLLOW_UP.NOFOLLOW' | translate }}
              </div>

              <div [ngStyle]="{ 'font-size': '13px', 'line-height': '1' }" class="text-notify text-medium">
                {{ prosNoFollow.length }} {{ 'SHARED_FOLLOW_UP.CONTACTS_ADDED' | translate }}
              </div>

            </div>
            <!-- /thank -->

          </div>
        </div>
        <!-- /emails -->

      </div>
    </div>
    <!-- /content -->

    <!-- button -->
    <div class="text-center">
      <button
        (click)="onClickConfirm($event)"
        [disabled]="loadingButton"
        class="button is-lg is-primary">
        {{ 'SHARED_FOLLOW_UP.BUTTON.INFORM_UMI' | translate }}
      </button>
    </div>
    <!-- /button -->

  </section>
</app-utility-modal>
<!-- /modal for sending emails : are you sure ? -->
