<div id="table-wrapper">

  <!-- section title and search -->
  <ng-container *ngIf="table._isTitle || table._isSearchable">
    <div class="flex-wrap p-bottom-10 flex-start">

      <!-- number of results and title -->
      <ng-container *ngIf="table._isTitle">
        <div class="text-notify text-sm m-right-20 m-bottom-20">
          <span>{{ table._total === -1 ? 0 : table._total }} {{ table._title | translate }}</span>
        </div>
      </ng-container>


      <!-- want to search by columns -->
      <ng-container *ngIf="table._isSearchable">
        <app-shared-search-filter
          [(searchConfig)]="searchConfig"
          [props]="table._columns"
          [tableView]="true">
        </app-shared-search-filter>
      </ng-container>

    </div>
  </ng-container>
  <!-- /section title and search -->


  <!-- when fetching or initializing -->
  <ng-container *ngIf="table._total === -1">
    <div class="section-light-pad">
      <app-message-template-1 [srcImage]="'https://res.cloudinary.com/umi/image/upload/v1541660257/app/default-images/bot/table_bot.svg'">
        <div class="flex-centered">
          <div class="loading is-white" style="margin-right: 0.8rem"></div>
          <span [innerText]="'TABLE.MESSAGES.FETCHING'" translate></span>
        </div>
      </app-message-template-1>
    </div>
  </ng-container>
  <!-- /when fetching or initializing -->


  <!-- when no result -->
  <ng-container *ngIf="table._total === 0 || isSearching">
    <div class="section-light-pad">
      <app-message-template-1
        [srcImage]="'https://res.cloudinary.com/umi/image/upload/v1541660257/app/default-images/bot/table_bot.svg'"
        [widthMax]="isSearching ? '362px' : '273px'">
        <span [innerText]="isSearching ? 'TABLE.MESSAGES.NO_RESULT_SEARCHING' : 'TABLE.MESSAGES.NO_RESULT'" translate></span>
      </app-message-template-1>
    </div>
  </ng-container>
  <!-- /when no result -->


  <!-- when result -->
  <div *ngIf="table._total > 0" [ngStyle]="{ 'min-height': table._isNoMinHeight ? 'unset' : '500px' }">
    <div class="table-responsive is-max-height relative" [ngClass]="{ 'scroll-no': isLoadingData }">

      <!-- loading style -->
      <ng-container *ngIf="isLoadingData">
        <div class="absolute table-loading-wrapper flex-centered">
          <div class="loading is-lg"></div>
        </div>
      </ng-container>

      <table class="table">

        <!-- head -->
        <thead>
          <tr>

            <!-- if we have selectable -->
            <ng-container *ngIf="table._isSelectable">
              <th class="th-checkbox">
                <label class="flex-centered" [ngClass]="{ 'active': massSelection }">
                  <input type="checkbox" (change)="selectAll($event)">
                  <i *ngIf="selectedRows === table._content.length" class="icon icon-check"></i>
                  <span *ngIf="selectedRows < table._content.length && selectedRows > 0" class="icon icon-minus text-primary"></span>
                </label>
              </th>
            </ng-container>
            <!-- /if we have selectable -->


            <!-- rest columns -->
            <ng-container *ngIf="!massSelection && selectedRows === 0">
              <th
                *ngFor="let column of visibleColumns; let i = index;"
                (click)="selectColumn(getName(column))"
                [ngClass]="{ 'is-active': column._isSelected, 'max-width': table._columns.length <= 6 }"
                [ngStyle]="{ 'width': column._width, 'min-width': column._width ? 'unset' : '150px' }"
                class="text-ellipsis">

                <ng-container *ngIf="!isSortable(column)">
                  <span class="th-name">{{ getName(column) | translate }}</span>
                </ng-container>

                <ng-container *ngIf="isSortable(column)">
                  <app-shared-sort
                    [(sortConfig)]="sortConfig"
                    [properties]="getAttrs(column)"
                    [label]="getName(column) | translate">
                  </app-shared-sort>
                </ng-container>

              </th>
            </ng-container>
            <!-- /rest columns -->


            <!-- actions -->
            <ng-container *ngIf="selectedRows > 0">
              <th [colSpan]="table._columns.length" class="th-action">
                <div class="d-flex align-center">

                  <div class="d-inline-flex m-right-25">
                    <span>{{ selectedRows }} {{ 'TABLE.SELECTED_ROWS' | translate }}</span>
                  </div>

                  <ng-container *ngIf="table?._buttons?.length > 0">
                    <div *ngFor="let button of table._buttons" class="d-inline-flex m-right-25">
                      <button
                        (click)="onActionClick(button._label)"
                        class="button p-no text-sm is-sm"
                        type="button">
                        <i *ngIf="button._icon" [ngClass]="button._icon" class="icon-left"></i>
                        <span>{{ button._label | translate }}</span>
                      </button>
                    </div>
                  </ng-container>

                  <div *ngIf="table._isDeletable" class="d-inline-flex">
                    <button
                      (click)="removeSelectedRows()"
                      class="button p-no text-sm is-sm text-alert"
                      type="button">
                      <i class="icon-left icon text-sm icon-delete"></i>
                      <span>{{ 'COMMON.BUTTON.DELETE' | translate }}</span>
                    </button>
                  </div>

                </div>
              </th>
            </ng-container>
            <!-- /actions -->

          </tr>
        </thead>
        <!-- /head -->


        <!-- body -->
        <tbody>
          <tr *ngFor="let row of getRowsKeys(); let rowIndex = index;" [ngClass]="{ 'active': table._content[row]?._isSelected, 'disabled': disabledRow(row) }">

            <!-- if we have selectable -->
            <ng-container *ngIf="table._isSelectable">
              <td class="th-checkbox">
                <label class="flex-centered" [ngClass]="{ 'active': table._content[row]?._isSelected, 'disabled': disabledRow(row) }">
                  <input type="checkbox" (click)="selectRow(row);" [disabled]=disabledRow(row)>
                  <i class="icon icon-check"></i>
                </label>
              </td>
            </ng-container>
            <!-- /if we have selectable -->


            <!-- rest columns -->
            <td *ngFor="let column of visibleColumns; let i = index"
                [ngClass]="{ 'max-width': table._columns.length <= 6 }"
                [ngStyle]="{ 'width': column._width, 'min-width': column._width ? 'unset' : '150px' }">

              <div class="tbody-td-data d-flex relative"
                   [ngClass]="{ 'td-type-image': getType(column) === 'COUNTRY' || getType(column) === 'PICTURE' }">

                <div
                [ngClass]="{ 'td-type-image': getType(column) === 'COUNTRY' || getType(column) === 'PICTURE',
                'enable-tooltip': column._enableTooltip || getType(column) === 'COUNTRY' || getType(column) === 'DROPDOWN',
                'td-type-tag': getType(column) === 'TAG-LIST' }"
                [ngSwitch]="getType(column)"
                class="tbody-td-content text-ellipsis">

                  <!-- if type is Date -->
                  <ng-container *ngSwitchCase="'DATE'">
                    <span>{{ (getContentValue(row, getAttrs(column)[0])?.toString() | date:dateFormat) }}</span>
                  </ng-container>
                  <!-- /if type is Date -->


                  <!-- if type is Country -->
                  <ng-container *ngSwitchCase="'COUNTRY'">
                    <span>
                      <app-country-flag [country]="(getContentValue(row, getAttrs(column)[0]) || '')"></app-country-flag>
                    </span>
                  </ng-container>
                  <!-- /if type is Country -->


                  <!-- if type is country name -->
                  <ng-container *ngSwitchCase="'COUNTRY-NAME'">
                    <span>{{ getCountryName(getContentValue(row, getAttrs(column)[0]) || '') }}</span>
                  </ng-container>
                  <!-- /if type is country name -->


                  <!-- if type is array -->
                  <ng-container *ngSwitchCase="'ARRAY'">
                    <span>{{ (getContentValue(row, getAttrs(column)[0]) || []).length.toString() }}</span>
                  </ng-container>
                  <!-- /if type is array -->


                  <!-- if type is image -->
                  <ng-container *ngSwitchCase="'PICTURE'">
                    <span>
                      <img [src]="getContentValue(row, getAttrs(column)[0]) || ''" class="img-responsive" height="27" alt=" ">
                    </span>
                  </ng-container>
                  <!-- /if type is image -->


                  <!-- if type is progress -->
                  <ng-container *ngSwitchCase="'PROGRESS'">
                    <span>
                      <app-progress-bar
                        [enableTooltip]="true"
                        [height]="'8px'"
                        [backgroundColor]="getColor(getContentValue(row, getAttrs(column)[0]) || 0)"
                        [width]="(getContentValue(row, getAttrs(column)[0]) || 0) +'%'">
                      </app-progress-bar>
                    </span>
                  </ng-container>
                  <!-- /if type is progress -->


                  <!-- if type is check -->
                  <ng-container *ngSwitchCase="'CHECK'">
                    <span>
                      <i *ngIf="getContentValue(row, getAttrs(column)[0]) == 0" class="icon icon-cross text-alert"></i>
                      <i *ngIf="getContentValue(row, getAttrs(column)[0]) == 1" class="icon icon-check text-success"></i>
                    </span>
                  </ng-container>
                  <!-- /if type is check -->


                  <!-- if type is multi-label -->
                  <ng-container *ngSwitchCase="'MULTI-LABEL'">
                    <span
                      *ngFor="let attr of getAttrs(column)"
                      [class]="getMultiLabelClass(getMultiLabel(column, attr)) || ''"
                      class="tbody-td-multiLabel"
                      [ngClass]="{ 'td-type-left-label': getAttrIndex(column, attr) === 0 && getAttrs(column).length !== 1,
                      'td-type-right-label' : getAttrIndex(column, attr) === getAttrs(column).length - 1 && getAttrs(column).length !== 1,
                      'td-type-middle-label' : getAttrIndex(column, attr) !== 0
                      && getAttrIndex(column, attr) !== getAttrs(column).length-1}">
                      {{ (getContentValue(row, attr) || " - ").toString() }}
                    </span>
                  </ng-container>
                  <!-- /if type is multi-label -->


                  <!-- if type is multiling -->
                  <ng-container *ngSwitchCase="'MULTILING'">
                    <span>{{ getContentValue(row, getAttrs(column)[0]) | multiling:userLang }}</span>
                  </ng-container>
                  <!-- /if type is multiling -->


                  <!-- if type is tags -->
                  <ng-container *ngSwitchCase="'TAG-LIST'">
                    <span class="d-flex">
                      <span *ngFor="let tag of getContentValue(row, getAttrs(column)[0]) | slice:0:2"
                            class="label is-sm is-tag is-rounded">
                        {{ tag.label | multiling:userLang }}
                      </span>
                      <span *ngIf="getContentValue(row, getAttrs(column)[0]).length > 2">...</span>
                    </span>
                  </ng-container>
                  <!-- /if type is tags -->


                  <!-- if type is multi-choices -->
                  <ng-container *ngSwitchCase="'MULTI-CHOICES'">
                    <span class="d-flex">
                      <span
                        [ngClass]="getChoiceClass(getChoice(column, (getContentValue(row, getAttrs(column)[0]))))"
                        class="tbody-td-multi-choice-label text-xs text-ellipsis d-block">
                        {{ (getChoiceAlias(getChoice(column, getContentValue(row, getAttrs(column)[0])|| " - "))) | translate }}
                      </span>
                    </span>
                  </ng-container>
                  <!-- /if type is multi-choices -->


                  <!-- if type is a dropdown -->
                  <ng-container *ngSwitchCase="'DROPDOWN'">
                    <span class="dropdown is-right">

                      <button
                        [ngClass]="getChoiceClass(getChoice(column, (getContentValue(row, getAttrs(column)[0]))))
                        ? getChoiceClass(getChoice(column, (getContentValue(row, getAttrs(column)[0])))) : 'button is-info is-link'"
                        [disabled]="disabledRow(row)"
                        class="button-dropdown dropdown-toggle"
                        tabindex="0">

                        <ng-container *ngIf="!(getChoiceAlias(getChoice(column, getContentValue(row, getAttrs(column)[0]))))">
                          {{ 'TABLE.CHOOSE' | translate }} <i class="icon icon-right icon-arrow-down text-primary"></i>
                        </ng-container>

                        <ng-container *ngIf="(getChoiceAlias(getChoice(column, getContentValue(row, getAttrs(column)[0]))))">
                          {{ (getChoiceAlias(getChoice(column, getContentValue(row, getAttrs(column)[0])))) | translate }}
                          <i class="icon icon-right icon-arrow-down"></i>
                        </ng-container>

                      </button>

                      <ul class="menu">
                        <li
                          (click)="table._isLocal ? onClickDropdownItem(filteredContent[row], item)
                          : onClickDropdownItem(table._content[row], item)"
                          *ngFor="let item of this.getChoices(column)"
                          class="menu-item">
                          {{ item._alias | translate }}
                        </li>
                      </ul>

                    </span>
                  </ng-container>
                  <!-- /if type is a dropdown -->


                  <!-- if type is multi-image-choices -->
                  <ng-container *ngSwitchCase="'MULTI-IMAGE-CHOICES'">
                    <span>
                      <img
                        *ngIf="getUrl(getChoice(column, getContentValue(row, getAttrs(column)[0]).toString()))"
                        [ngStyle]="{ 'height': column._imgHeight }"
                        [src]="getUrl(getChoice(column, getContentValue(row, getAttrs(column)[0]).toString() || ''))"
                        alt=" "
                        class="img-responsive"
                        height="27">
                    </span>
                  </ng-container>
                  <!-- /if type is multi-image-choices -->


                  <!-- if type is length -->
                  <ng-container *ngSwitchCase="'LENGTH'">
                    <span>{{ getLength(getContentValue(row, getAttrs(column)[0])) }}</span>
                  </ng-container>
                  <!-- /if type is length -->


                  <!-- if type is a countdown -->
                  <ng-container *ngSwitchCase="'DAYS-TO'">
                    <span>{{ countDaysTo(row, getAttrs(column)[0])}}</span>
                  </ng-container>
                  <!-- /if type is a countdown -->


                  <!-- if type is text -->
                  <ng-container *ngSwitchDefault>

                    <!-- text not clickable -->
                    <ng-container *ngIf="i !== table._clickIndex - 1">
                      <span *ngFor="let attr of getAttrs(column)">
                      {{ (getContentValue(row, attr)|| " - ").toString() | FormatText:true }}
                    </span>
                    </ng-container>
                    <!-- /text not clickable -->


                    <!-- text clickable -->
                    <ng-container *ngIf="i === table._clickIndex - 1">
                      <span
                        (click)="table._isLocal ? edit(filteredContent[row], rowIndex) : edit(table._content[row], rowIndex)"
                        *ngFor="let attr of getAttrs(column)"
                        [ngClass]="{ 'text-primary': rowIndex === this.selectedIndex }"
                        class="c-hand">
                      {{ (getContentValue(row, attr)|| " - ").toString() | FormatText:true }}
                    </span>
                    </ng-container>
                    <!-- /text clickable -->

                  </ng-container>
                  <!-- /if type is text -->

                </div>

              </div>
            </td>
            <!-- rest columns -->

          </tr>
        </tbody>
        <!-- /body -->

      </table>

    </div>
  </div>
  <!-- /when result -->


  <!-- when pagination is required -->
  <ng-container *ngIf="table._total > 10 && table._isPaginable">
    <div class="flex-centered p-top-25">
      <app-pagination-2
        [(pagination)]="pagination"
        [totalCount]="table._total"
        style="width: 100%">
      </app-pagination-2>
    </div>
  </ng-container>
  <!-- /when pagination is required -->

</div>
